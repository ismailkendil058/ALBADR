import{j as e}from"./ui-vendor-CbTtZHsW.js";import{a as s}from"./react-vendor-1XlI0agO.js";import{S as a}from"./skeleton-BZOrIP_J.js";import{a as t,C as r}from"./card-PHeom2L9.js";import{B as l}from"./button-D-ffmNcE.js";import{I as i}from"./input-m9ePOgnC.js";import{L as d}from"./label-Cu_4ZZv9.js";import{u as n,C as c,S as o}from"./use-debounce-BKdP7V3a.js";import{S as m,a as h,b as x,c as p,d as u}from"./select-Bo_HCkAS.js";import{D as j,a as f,b as g,c as y}from"./dialog-DGWZHKxT.js";import{P as N,a as v,b,c as w,d as C,e as _}from"./pagination-DkFlfrEC.js";import{D as S,p as k}from"./date-range-picker-DBY0j15P.js";import{b as D,L as A,X as O}from"./index-BWpasF73.js";import{f as M,g as T,h as L,k as P}from"./useOrders-Bo6usLWA.js";import{u as $,F as E,a as Q,O as I,E as Z,C as F}from"./CreateOrderDialog-CEzicvl8.js";import{S as V}from"./search-BmT2NVnk.js";import{P as z}from"./plus-CCAUwyXe.js";import{P as B}from"./package-BcJpjHfu.js";import{T as U}from"./truck-B8PAd3Dr.js";import{B as q}from"./building-2-CAmmrv1O.js";import{S as R}from"./useTariffs-C3-GvtHI.js";import{S as H}from"./square-pen-D0A0ftR3.js";import{P as W}from"./phone-CN7aDeEm.js";import{M as G}from"./map-pin-FfxozQRU.js";import{f as J}from"./format-v08Horlk.js";import"./index-CmHjCS6i.js";import"./chevron-down-B5LJPQC6.js";import"./chevron-left-CZa2LEKQ.js";import"./chevron-right-DqnxfF0a.js";import"./query-vendor-DL9dZapS.js";import"./badge-Db9_b52h.js";import"./save-DkoGca0f.js";import"./useProducts-Dd0Ob86o.js";import"./trash-2-B78Q9GXL.js";const K={new:"New",confirmed:"Confirmed",delivered:"Delivered",canceled:"Canceled",returned:"Returned"},Y={new:"bg-amber-100 text-amber-800",confirmed:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",canceled:"bg-red-100 text-red-800",returned:"bg-purple-100 text-purple-800"},X={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},ee=()=>{const[ee,se]=s.useState(1),[ae,te]=s.useState({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),[re,le]=s.useState(void 0),ie=n(ae.searchQuery,500),{data:de,isLoading:ne}=M({page:ee,pageSize:20,searchQuery:ie,status:ae.status,deliveryType:ae.deliveryType,store:ae.store,fromDate:re?.from?J(re.from,"yyyy-MM-dd"):void 0,toDate:re?.to?J(re.to,"yyyy-MM-dd"):void 0}),{data:ce=[],count:oe=0}=de||{},me=$(),he=T(),xe=L(),{toast:pe}=D(),[ue,je]=s.useState(null),[fe,ge]=s.useState(null),[ye,Ne]=s.useState(!1),[ve,be]=s.useState(!1),[we,Ce]=s.useState(!1),[_e,Se]=s.useState([]),[ke,De]=s.useState(""),[Ae,Oe]=s.useState(!1),{refetch:Me}=P({searchQuery:ie,status:ae.status,deliveryType:ae.deliveryType,store:ae.store,fromDate:re?.from?J(re.from,"yyyy-MM-dd"):void 0,toDate:re?.to?J(re.to,"yyyy-MM-dd"):void 0}),Te=(e,s)=>{te(a=>({...a,[e]:s}))},Le=s.useMemo(()=>{const e={...ae};return delete e.searchQuery,Object.values(e).some(e=>"all"!==e&&""!==e)||re?.from||re?.to},[ae,re]);s.useEffect(()=>{se(1)},[ie,ae.status,ae.deliveryType,ae.store,re]);const Pe=e=>{Se(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},$e=(e,s)=>{he.mutateAsync({id:e,status:s}),pe({title:"Updated",description:`Order status changed to ${K[s]}.`})},Ee=Math.ceil(oe/20);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders (Employee)"}),e.jsxs("p",{className:"text-muted-foreground",children:["Manage and track all ",oe," orders"]})]}),_e.length>0&&e.jsx(t,{className:"border-primary",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"font-medium",children:[_e.length," orders selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{value:ke,onValueChange:De,children:[e.jsx(h,{className:"w-full sm:w-[180px]",children:e.jsx(x,{placeholder:"Change status..."})}),e.jsx(p,{children:Object.keys(K).map(s=>e.jsx(u,{value:s,children:K[s]},s))})]}),ke&&e.jsx(l,{onClick:()=>(async e=>{await xe.mutateAsync({ids:_e,status:e}),pe({title:"Updated",description:`${_e.length} orders updated.`}),Se([]),De("")})(ke),disabled:xe.isPending,children:xe.isPending?e.jsx(A,{className:"w-4 h-4 animate-spin"}):"Apply"}),e.jsx(l,{variant:"ghost",onClick:()=>Se([]),children:e.jsx(O,{className:"w-4 h-4"})})]})]})})}),e.jsx(t,{children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search by order ID, customer name, or phone...",value:ae.searchQuery,onChange:e=>Te("searchQuery",e.target.value),className:"pl-10"})]}),e.jsxs(l,{variant:we?"secondary":"outline",onClick:()=>Ce(!we),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Filters",Le&&e.jsx("span",{className:"ml-2 w-2 h-2 bg-primary rounded-full"})]}),e.jsxs(l,{variant:"default",className:"bg-green-500 text-white hover:bg-green-600",onClick:async()=>{Oe(!0);try{const{data:e}=await Me();if(!e||0===e.length)return void pe({title:"Export Failed",description:"No orders to export.",variant:"destructive"});let s=0;e.forEach(e=>{e.items&&e.items.length>s&&(s=e.items.length)});const a=["Order Number","Customer Name","Customer Phone","Wilaya","Address","Delivery Type","Store","Subtotal","Notes",...Array.from({length:s},(e,s)=>`Item ${s+1}`)],t=e.map(e=>{const a=[e.order_number,`"${e.customer_name}"`,e.customer_phone,e.wilaya_name,`"${e.address||""}"`,X[e.delivery_type],e.send_from_store,e.subtotal,`"${e.notes||""}"`],t=(e.items||[]).map(e=>`"${e.product_name_fr||e.product_name_ar} (Qty: ${e.quantity}, Price: ${e.unit_price}, Weight: ${e.weight||"N/A"})"`);for(;t.length<s;)t.push("");return[...a,...t].join(",")}),r="\ufeff"+[a.join(","),...t].join("\n"),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),d=URL.createObjectURL(l);i.setAttribute("href",d),i.setAttribute("download",`orders_export_${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),pe({title:"Export Successful",description:`${e.length} orders have been exported.`})}catch(e){pe({title:"Export Failed",description:"An error occurred while exporting orders.",variant:"destructive"})}finally{Oe(!1)}},disabled:Ae,children:[Ae?e.jsx(A,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(l,{variant:"default",onClick:()=>be(!0),children:[e.jsx(z,{className:"w-4 h-4 mr-2"})," Create Order"]})]}),we&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium mb-1.5 block",children:"Status"}),e.jsxs(m,{value:ae.status,onValueChange:e=>Te("status",e),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(p,{children:[e.jsx(u,{value:"all",children:"All"}),Object.keys(K).map(s=>e.jsx(u,{value:s,children:K[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium mb-1.5 block",children:"Delivery"}),e.jsxs(m,{value:ae.deliveryType,onValueChange:e=>Te("deliveryType",e),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(p,{children:[e.jsx(u,{value:"all",children:"All"}),Object.keys(X).map(s=>e.jsx(u,{value:s,children:X[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium mb-1.5 block",children:"Store"}),e.jsxs(m,{value:ae.store,onValueChange:e=>Te("store",e),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(p,{children:[e.jsx(u,{value:"all",children:"All"}),e.jsx(u,{value:"laghouat",children:"Laghouat"}),e.jsx(u,{value:"aflou",children:"Aflou"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(d,{className:"text-sm font-medium mb-1.5 block",children:"Date Range"}),e.jsx(S,{date:re,onSelect:e=>{le(e)}})]})]}),Le&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>{te({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),le(void 0)},children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Clear Filters"]})})]})]})}),me?e.jsxs("div",{className:"space-y-4",children:[ne?Array.from({length:10}).map((s,l)=>e.jsx(t,{children:e.jsx(r,{className:"p-4",children:e.jsx(a,{className:"h-32 w-full"})})},l)):ce.map(s=>e.jsx(I,{order:s,isSelected:_e.includes(s.id),onSelect:Pe,onViewDetails:je,onStatusChange:$e,statusLabels:K,statusColors:Y,deliveryLabels:X},s.id)),0===ce.length&&!ne&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]}):e.jsx(t,{children:e.jsxs(r,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50 text-left",children:[e.jsx("th",{className:"p-3",children:e.jsx(c,{checked:_e.length===ce.length&&ce.length>0,onCheckedChange:()=>{_e.length===ce.length?Se([]):Se(ce.map(e=>e.id))}})}),e.jsx("th",{className:"p-3 font-medium",children:"Order #"}),e.jsx("th",{className:"p-3 font-medium",children:"Customer"}),e.jsx("th",{className:"p-3 font-medium",children:"Delivery"}),e.jsx("th",{className:"p-3 font-medium",children:"Store"}),e.jsx("th",{className:"p-3 font-medium",children:"Total"}),e.jsx("th",{className:"p-3 font-medium",children:"Status"}),e.jsx("th",{className:"p-3 font-medium",children:"Date"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:ne?Array.from({length:10}).map((s,t)=>e.jsx("tr",{className:"border-b",children:e.jsx("td",{colSpan:10,className:"p-4",children:e.jsx(a,{className:"h-6 w-full"})})},t)):ce.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/30 cursor-pointer "+(s.is_manual?"bg-red-800/30":""),onClick:()=>je(s),children:[e.jsx("td",{className:"p-3",onClick:e=>e.stopPropagation(),children:e.jsx(c,{checked:_e.includes(s.id),onCheckedChange:()=>Pe(s.id)})}),e.jsx("td",{className:"p-3 font-mono text-xs",children:s.order_number}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.customer_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.customer_phone})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:["home"===s.delivery_type&&e.jsx(U,{className:"w-4 h-4"}),"bureau"===s.delivery_type&&e.jsx(q,{className:"w-4 h-4"}),"pickup"===s.delivery_type&&e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:X[s.delivery_type]})]})}),e.jsx("td",{className:"p-3 capitalize",children:s.send_from_store}),e.jsxs("td",{className:"p-3 font-semibold",children:[s.total.toLocaleString()," DZD"]}),e.jsx("td",{className:"p-3",children:e.jsx("div",{onClick:e=>e.stopPropagation(),children:e.jsxs(m,{value:s.status,onValueChange:e=>$e(s.id,e),children:[e.jsx(h,{className:`w-[120px] h-8 text-xs border-0 ${Y[s.status]}`,children:e.jsx(x,{})}),e.jsx(p,{children:Object.keys(K).map(s=>e.jsx(u,{value:s,children:K[s]},s))})]})})}),e.jsx("td",{className:"p-3 text-xs",children:J(k(s.created_at),"dd/MM/yyyy HH:mm")}),e.jsx("td",{className:"p-3",onClick:e=>e.stopPropagation(),children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{ge(s),Ne(!0)},children:e.jsx(H,{className:"w-4 h-4"})})})]},s.id))})]})}),0===ce.length&&!ne&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]})}),Ee>1&&e.jsx(N,{children:e.jsxs(v,{className:"flex-wrap",children:[e.jsx(b,{children:e.jsx(w,{href:"#",onClick:e=>{e.preventDefault(),se(e=>Math.max(1,e-1))},className:1===ee?"pointer-events-none opacity-50":""})}),e.jsx("div",{className:"hidden sm:flex",children:[...Array(Ee)].map((s,a)=>e.jsx(b,{children:e.jsx(C,{href:"#",onClick:e=>{e.preventDefault(),se(a+1)},isActive:ee===a+1,children:a+1})},a))}),e.jsx(b,{children:e.jsx(_,{href:"#",onClick:e=>{e.preventDefault(),se(e=>Math.min(Ee,e+1))},className:ee===Ee?"pointer-events-none opacity-50":""})})]})}),e.jsx(j,{open:!!ue,onOpenChange:()=>je(null),children:e.jsx(f,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:ue&&e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(y,{children:["Order Details - ",ue.order_number]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Customer Information"]}),e.jsx("p",{children:ue.customer_name}),e.jsx("p",{className:"text-muted-foreground",children:ue.customer_phone}),ue.customer_email&&e.jsx("p",{className:"text-muted-foreground",children:ue.customer_email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Delivery Information"]}),e.jsx("p",{children:ue.wilaya_name}),ue.address&&e.jsx("p",{className:"text-muted-foreground",children:ue.address}),e.jsxs("p",{className:"text-sm",children:["Type: ",X[ue.delivery_type]]}),e.jsxs("p",{className:"text-sm",children:["Store: ",ue.send_from_store.charAt(0).toUpperCase()+ue.send_from_store.slice(1)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:ue.items.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg",children:["                      ",e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product_name_ar||s.product_name_fr||"No Product Name Available"}),s.weight&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(o,{className:"w-3 h-3"})," ",s.weight]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[s.total_price.toLocaleString()," DZD"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity," Ã— ",s.unit_price.toLocaleString()," DZD"]})]})]},a))})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[ue.subtotal.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery"}),e.jsxs("span",{children:[ue.delivery_price.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:[ue.total.toLocaleString()," DZD"]})]})]}),ue.notes&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm",children:ue.notes})]})]})]})})}),e.jsx(Z,{order:fe,isOpen:ye,onClose:()=>{Ne(!1),ge(null)}}),ve&&e.jsx(F,{isOpen:ve,onClose:()=>be(!1)})]})};export{ee as default};
