import{b as e,u as r,c as t}from"./query-vendor-DL9dZapS.js";import{s as o}from"./index-D1_jVxz0.js";function n({page:r=1,pageSize:t=12,searchQuery:n}={}){return e({queryKey:["products",{page:r,pageSize:t,searchQuery:n}],queryFn:async()=>{const e=(r-1)*t,i=e+t-1;let a=o.from("products").select("\n          *,\n          category:categories(*),\n          weights:product_weights(*)\n        ",{count:"exact"});n&&(a=a.or(`name_fr.ilike.%${n}%,name_ar.ilike.%${n}%`));const{data:s,error:c,count:u}=await a.order("created_at",{ascending:!1}).range(e,i);if(c)throw c;return{data:s,count:u}}})}function i(r){return e({queryKey:["product",r],queryFn:async()=>{if(!r)return null;const{data:e,error:t}=await o.from("products").select("\n          name_ar,\n          name_fr,\n          *,\n          category:categories(*),\n          weights:product_weights(*)\n        ").eq("id",r).maybeSingle();if(t)throw t;return e},enabled:!!r})}function a({categoryId:r,page:t,pageSize:n=12}){return e({queryKey:["products","category",r,{page:t,pageSize:n}],queryFn:async()=>{if(!r)return{data:[],count:0};const e=(t-1)*n,i=e+n-1,{data:a,error:s,count:c}=await o.from("products").select("\n          *,\n          category:categories(*),\n          weights:product_weights(*)\n        ",{count:"exact"}).eq("category_id",r).order("created_at",{ascending:!1}).range(e,i);if(s)throw s;return{data:a,count:c}},enabled:!!r})}function s(){return e({queryKey:["products","featured"],queryFn:async()=>{const{data:e,error:r}=await o.from("products").select("\n          *,\n          category:categories(*),\n          weights:product_weights(*)\n        ").eq("is_featured",!0).limit(8);if(r)throw r;return e},staleTime:3e5,gcTime:6e5})}function c(){return e({queryKey:["products","bestseller"],queryFn:async()=>{const{data:e,error:r}=await o.from("products").select("\n          *,\n          category:categories(*),\n          weights:product_weights(*)\n        ").eq("is_best_seller",!0).limit(8);if(r)throw r;return e},staleTime:3e5,gcTime:6e5})}function u(){const e=r();return t({mutationFn:async e=>{const{data:r,error:t}=await o.from("products").insert(e.product).select().single();if(t)throw t;if(e.weights&&e.weights.length>0){const t=e.weights.map((e,t)=>({product_id:r.id,weight:e.weight,price:e.price,sort_order:e.sort_order??t})),{error:n}=await o.from("product_weights").insert(t);if(n)throw n}return r},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]})}})}function d(){const e=r();return t({mutationFn:async e=>{const{error:r}=await o.from("products").update(e.product).eq("id",e.id);if(r)throw r;if(void 0!==e.weights&&(await o.from("product_weights").delete().eq("product_id",e.id),e.weights.length>0)){const r=e.weights.map((r,t)=>({product_id:e.id,weight:r.weight,price:r.price,sort_order:r.sort_order??t})),{error:t}=await o.from("product_weights").insert(r);if(t)throw t}return e.id},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]})}})}function g(){const e=r();return t({mutationFn:async e=>{const{error:r}=await o.from("products").delete().eq("id",e);if(r)throw r;return e},onSuccess:()=>{e.invalidateQueries({queryKey:["products"]})}})}function p(){return e({queryKey:["products","promo"],queryFn:async()=>{const{data:e,error:r}=await o.from("products").select("\n          *,\n          category:categories(*),\n          weights:product_weights(*)\n        ").eq("is_promo",!0).limit(8);if(r)throw r;return e},staleTime:3e5,gcTime:6e5})}export{c as a,p as b,i as c,n as d,a as e,u as f,d as g,g as h,s as u};
