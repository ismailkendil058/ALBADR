import{r as i,e as be,j as e,a as Y,X as ee}from"./index-DJa8JmTm.js";import{S as se}from"./skeleton-DUhNiQSq.js";import{a as O,C as P}from"./card-3nGiqXgO.js";import{B as h}from"./button-DQkp_F6k.js";import{I as Se}from"./input-CNvN4VzI.js";import{L as A}from"./label-CkhIcTXw.js";import{u as Ce,C as te,S as we}from"./use-debounce-D8fGzHVw.js";import{S as y,a as N,b as v,c as b,d as c}from"./select-B8B0hAyU.js";import{D as De,a as _e,b as ke,c as Oe}from"./dialog-CnD21xAc.js";import{P as Pe,a as Ae,b as Q,c as Ee,d as Me,e as Te}from"./pagination-BSI4Flxg.js";import{D as Fe,p as Le}from"./date-range-picker-Cif2RVIH.js";import{f as $e,g as Ie,h as Qe,k as Be}from"./useOrders-4OmE96zU.js";import{u as Re,F as Ue,a as He,O as Ve,E as Ze,C as ze}from"./CreateOrderDialog-_njDyvy8.js";import{S as qe}from"./search-CWP1OLDI.js";import{P as We}from"./plus-BDCGZCab.js";import{P as ae}from"./package-B7xOaovl.js";import{T as Ge}from"./truck-2G314Y2O.js";import{B as Xe}from"./building-2-CwKry2ya.js";import{S as Je}from"./useTariffs-2yaO5S4w.js";import{S as Ke}from"./square-pen-DucBXbdO.js";import{P as Ye}from"./phone-BCYrnSCU.js";import{M as es}from"./map-pin-DSo7UTKA.js";import{f as S}from"./format-CuvDg6tx.js";import"./Combination-D-uuNelE.js";import"./chevron-down-Dn-4MBn6.js";import"./chevron-left-Bv7kFfeV.js";import"./chevron-right-7HFw8PeQ.js";import"./useMutation-wRGvQ37d.js";import"./badge-783OJbhB.js";import"./save-BtmLQnuv.js";import"./useProducts-T2pr3msx.js";import"./trash-2-DCfUe7bk.js";const le=20,m={new:"New",confirmed:"Confirmed",delivered:"Delivered",canceled:"Canceled",returned:"Returned"},re={new:"bg-amber-100 text-amber-800",confirmed:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",canceled:"bg-red-100 text-red-800",returned:"bg-purple-100 text-purple-800"},u={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},Ms=()=>{const[C,w]=i.useState(1),[l,B]=i.useState({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),[n,R]=i.useState(void 0),E=Ce(l.searchQuery,500),{data:ne,isLoading:D}=$e({page:C,pageSize:le,searchQuery:E,status:l.status,deliveryType:l.deliveryType,store:l.store,fromDate:n?.from?S(n.from,"yyyy-MM-dd"):void 0,toDate:n?.to?S(n.to,"yyyy-MM-dd"):void 0}),{data:o=[],count:U=0}=ne||{},ie=Re(),ce=Ie(),M=Qe(),{toast:p}=be(),[a,T]=i.useState(null),[oe,H]=i.useState(null),[de,V]=i.useState(!1),[Z,z]=i.useState(!1),[F,me]=i.useState(!1),[d,j]=i.useState([]),[L,q]=i.useState(""),[W,G]=i.useState(!1),{refetch:he}=Be({searchQuery:E,status:l.status,deliveryType:l.deliveryType,store:l.store,fromDate:n?.from?S(n.from,"yyyy-MM-dd"):void 0,toDate:n?.to?S(n.to,"yyyy-MM-dd"):void 0}),_=(s,t)=>{B(x=>({...x,[s]:t}))},X=i.useMemo(()=>{const s={...l};return delete s.searchQuery,Object.values(s).some(t=>t!=="all"&&t!=="")||n?.from||n?.to},[l,n]);i.useEffect(()=>{w(1)},[E,l.status,l.deliveryType,l.store,n]);const J=s=>{j(t=>t.includes(s)?t.filter(x=>x!==s):[...t,s])},xe=()=>{d.length===o.length?j([]):j(o.map(s=>s.id))},ue=async s=>{await M.mutateAsync({ids:d,status:s}),p({title:"Updated",description:`${d.length} orders updated.`}),j([]),q("")},K=(s,t)=>{ce.mutateAsync({id:s,status:t}),p({title:"Updated",description:`Order status changed to ${m[t]}.`})},pe=()=>{B({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),R(void 0)},je=async()=>{G(!0);try{const{data:s}=await he();if(!s||s.length===0){p({title:"Export Failed",description:"No orders to export.",variant:"destructive"});return}let t=0;s.forEach(r=>{r.items&&r.items.length>t&&(t=r.items.length)});const fe=["Order Number","Customer Name","Customer Phone","Wilaya","Address","Delivery Type","Store","Subtotal","Notes",...Array.from({length:t},(r,$)=>`Item ${$+1}`)],ge=s.map(r=>{const $=[r.order_number,`"${r.customer_name}"`,r.customer_phone,r.wilaya_name,`"${r.address||""}"`,u[r.delivery_type],r.send_from_store,r.subtotal,`"${r.notes||""}"`],I=(r.items||[]).map(g=>`"${g.product_name_fr||g.product_name_ar} (Qty: ${g.quantity}, Price: ${g.unit_price}, Weight: ${g.weight||"N/A"})"`);for(;I.length<t;)I.push("");return[...$,...I].join(",")}),ye="\uFEFF"+[fe.join(","),...ge].join(`
`),Ne=new Blob([ye],{type:"text/csv;charset=utf-8;"}),f=document.createElement("a"),ve=URL.createObjectURL(Ne);f.setAttribute("href",ve),f.setAttribute("download",`orders_export_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(f),f.click(),document.body.removeChild(f),p({title:"Export Successful",description:`${s.length} orders have been exported.`})}catch(s){console.error("Export failed:",s),p({title:"Export Failed",description:"An error occurred while exporting orders.",variant:"destructive"})}finally{G(!1)}},k=Math.ceil(U/le);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders (Employee)"}),e.jsxs("p",{className:"text-muted-foreground",children:["Manage and track all ",U," orders"]})]}),d.length>0&&e.jsx(O,{className:"border-primary",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"font-medium",children:[d.length," orders selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{value:L,onValueChange:q,children:[e.jsx(N,{className:"w-full sm:w-[180px]",children:e.jsx(v,{placeholder:"Change status..."})}),e.jsx(b,{children:Object.keys(m).map(s=>e.jsx(c,{value:s,children:m[s]},s))})]}),L&&e.jsx(h,{onClick:()=>ue(L),disabled:M.isPending,children:M.isPending?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Apply"}),e.jsx(h,{variant:"ghost",onClick:()=>j([]),children:e.jsx(ee,{className:"w-4 h-4"})})]})]})})}),e.jsx(O,{children:e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Se,{placeholder:"Search by order ID, customer name, or phone...",value:l.searchQuery,onChange:s=>_("searchQuery",s.target.value),className:"pl-10"})]}),e.jsxs(h,{variant:F?"secondary":"outline",onClick:()=>me(!F),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Filters",X&&e.jsx("span",{className:"ml-2 w-2 h-2 bg-primary rounded-full"})]}),e.jsxs(h,{variant:"default",className:"bg-green-500 text-white hover:bg-green-600",onClick:je,disabled:W,children:[W?e.jsx(Y,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(He,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(h,{variant:"default",onClick:()=>z(!0),children:[e.jsx(We,{className:"w-4 h-4 mr-2"})," Create Order"]})]}),F&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium mb-1.5 block",children:"Status"}),e.jsxs(y,{value:l.status,onValueChange:s=>_("status",s),children:[e.jsx(N,{children:e.jsx(v,{})}),e.jsxs(b,{children:[e.jsx(c,{value:"all",children:"All"}),Object.keys(m).map(s=>e.jsx(c,{value:s,children:m[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium mb-1.5 block",children:"Delivery"}),e.jsxs(y,{value:l.deliveryType,onValueChange:s=>_("deliveryType",s),children:[e.jsx(N,{children:e.jsx(v,{})}),e.jsxs(b,{children:[e.jsx(c,{value:"all",children:"All"}),Object.keys(u).map(s=>e.jsx(c,{value:s,children:u[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(A,{className:"text-sm font-medium mb-1.5 block",children:"Store"}),e.jsxs(y,{value:l.store,onValueChange:s=>_("store",s),children:[e.jsx(N,{children:e.jsx(v,{})}),e.jsxs(b,{children:[e.jsx(c,{value:"all",children:"All"}),e.jsx(c,{value:"laghouat",children:"Laghouat"}),e.jsx(c,{value:"aflou",children:"Aflou"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(A,{className:"text-sm font-medium mb-1.5 block",children:"Date Range"}),e.jsx(Fe,{date:n,onSelect:s=>{R(s)}})]})]}),X&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{variant:"ghost",size:"sm",onClick:pe,children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Clear Filters"]})})]})]})}),ie?e.jsxs("div",{className:"space-y-4",children:[D?Array.from({length:10}).map((s,t)=>e.jsx(O,{children:e.jsx(P,{className:"p-4",children:e.jsx(se,{className:"h-32 w-full"})})},t)):o.map(s=>e.jsx(Ve,{order:s,isSelected:d.includes(s.id),onSelect:J,onViewDetails:T,onStatusChange:K,statusLabels:m,statusColors:re,deliveryLabels:u},s.id)),o.length===0&&!D&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]}):e.jsx(O,{children:e.jsxs(P,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50 text-left",children:[e.jsx("th",{className:"p-3",children:e.jsx(te,{checked:d.length===o.length&&o.length>0,onCheckedChange:xe})}),e.jsx("th",{className:"p-3 font-medium",children:"Order #"}),e.jsx("th",{className:"p-3 font-medium",children:"Customer"}),e.jsx("th",{className:"p-3 font-medium",children:"Delivery"}),e.jsx("th",{className:"p-3 font-medium",children:"Store"}),e.jsx("th",{className:"p-3 font-medium",children:"Total"}),e.jsx("th",{className:"p-3 font-medium",children:"Status"}),e.jsx("th",{className:"p-3 font-medium",children:"Date"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:D?Array.from({length:10}).map((s,t)=>e.jsx("tr",{className:"border-b",children:e.jsx("td",{colSpan:10,className:"p-4",children:e.jsx(se,{className:"h-6 w-full"})})},t)):o.map(s=>e.jsxs("tr",{className:`border-b hover:bg-muted/30 cursor-pointer ${s.is_manual?"bg-red-800/30":""}`,onClick:()=>T(s),children:[e.jsx("td",{className:"p-3",onClick:t=>t.stopPropagation(),children:e.jsx(te,{checked:d.includes(s.id),onCheckedChange:()=>J(s.id)})}),e.jsx("td",{className:"p-3 font-mono text-xs",children:s.order_number}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.customer_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.customer_phone})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[s.delivery_type==="home"&&e.jsx(Ge,{className:"w-4 h-4"}),s.delivery_type==="bureau"&&e.jsx(Xe,{className:"w-4 h-4"}),s.delivery_type==="pickup"&&e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:u[s.delivery_type]})]})}),e.jsx("td",{className:"p-3 capitalize",children:s.send_from_store}),e.jsxs("td",{className:"p-3 font-semibold",children:[s.total.toLocaleString()," DZD"]}),e.jsx("td",{className:"p-3",children:e.jsx("div",{onClick:t=>t.stopPropagation(),children:e.jsxs(y,{value:s.status,onValueChange:t=>K(s.id,t),children:[e.jsx(N,{className:`w-[120px] h-8 text-xs border-0 ${re[s.status]}`,children:e.jsx(v,{})}),e.jsx(b,{children:Object.keys(m).map(t=>e.jsx(c,{value:t,children:m[t]},t))})]})})}),e.jsx("td",{className:"p-3 text-xs",children:S(Le(s.created_at),"dd/MM/yyyy HH:mm")}),e.jsx("td",{className:"p-3",onClick:t=>t.stopPropagation(),children:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{H(s),V(!0)},children:e.jsx(Ke,{className:"w-4 h-4"})})})]},s.id))})]})}),o.length===0&&!D&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]})}),k>1&&e.jsx(Pe,{children:e.jsxs(Ae,{className:"flex-wrap",children:[e.jsx(Q,{children:e.jsx(Ee,{href:"#",onClick:s=>{s.preventDefault(),w(t=>Math.max(1,t-1))},className:C===1?"pointer-events-none opacity-50":""})}),e.jsx("div",{className:"hidden sm:flex",children:[...Array(k)].map((s,t)=>e.jsx(Q,{children:e.jsx(Me,{href:"#",onClick:x=>{x.preventDefault(),w(t+1)},isActive:C===t+1,children:t+1})},t))}),e.jsx(Q,{children:e.jsx(Te,{href:"#",onClick:s=>{s.preventDefault(),w(t=>Math.min(k,t+1))},className:C===k?"pointer-events-none opacity-50":""})})]})}),e.jsx(De,{open:!!a,onOpenChange:()=>T(null),children:e.jsx(_e,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{children:e.jsxs(Oe,{children:["Order Details - ",a.order_number]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Customer Information"]}),e.jsx("p",{children:a.customer_name}),e.jsx("p",{className:"text-muted-foreground",children:a.customer_phone}),a.customer_email&&e.jsx("p",{className:"text-muted-foreground",children:a.customer_email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Delivery Information"]}),e.jsx("p",{children:a.wilaya_name}),a.address&&e.jsx("p",{className:"text-muted-foreground",children:a.address}),e.jsxs("p",{className:"text-sm",children:["Type: ",u[a.delivery_type]]}),e.jsxs("p",{className:"text-sm",children:["Store: ",a.send_from_store.charAt(0).toUpperCase()+a.send_from_store.slice(1)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:a.items.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg",children:["                      ",e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product_name_ar||s.product_name_fr||"No Product Name Available"}),s.weight&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(we,{className:"w-3 h-3"})," ",s.weight]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[s.total_price.toLocaleString()," DZD"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity," Ã— ",s.unit_price.toLocaleString()," DZD"]})]})]},t))})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[a.subtotal.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery"}),e.jsxs("span",{children:[a.delivery_price.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:[a.total.toLocaleString()," DZD"]})]})]}),a.notes&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]})]})]})})}),e.jsx(Ze,{order:oe,isOpen:de,onClose:()=>{V(!1),H(null)}}),Z&&e.jsx(ze,{isOpen:Z,onClose:()=>z(!1)})]})};export{Ms as default};
