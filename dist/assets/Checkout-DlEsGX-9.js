import{j as e}from"./ui-vendor-CbTtZHsW.js";import{k as s,a as r,L as t}from"./react-vendor-1XlI0agO.js";import{T as a,H as l,F as i}from"./Footer-Byqae03W.js";import{B as d}from"./button-D-ffmNcE.js";import{I as o}from"./input-m9ePOgnC.js";import{u as n,P as c,a as m,b as x,C as p}from"./useOrders-Bo6usLWA.js";import{S as h,a as u,b as j,c as f,d as y}from"./select-Bo_HCkAS.js";import{c as b,b as N,a as v}from"./index-BWpasF73.js";import{S as g}from"./skeleton-BZOrIP_J.js";import{u as w,a as k,S as M}from"./useTariffs-C3-GvtHI.js";import{C as S}from"./chevron-left-CZa2LEKQ.js";import{T as _}from"./truck-B8PAd3Dr.js";import{B as C}from"./building-2-CAmmrv1O.js";import{M as A}from"./map-pin-FfxozQRU.js";import{P}from"./package-BcJpjHfu.js";import{P as D}from"./phone-CN7aDeEm.js";import{a as q}from"./ar-DZ-DN8Lq_Uj.js";import{s as $,f as L}from"./format-v08Horlk.js";import"./instagram-DzHnDay_.js";import"./useCategories-CVN9Txt_.js";import"./query-vendor-DL9dZapS.js";import"./trash-2-B78Q9GXL.js";import"./plus-CCAUwyXe.js";import"./search-BmT2NVnk.js";import"./shopping-cart-D1jdCj2s.js";import"./menu-CfYcmfj3.js";import"./chevron-down-B5LJPQC6.js";import"./mail-Bi5-Lunt.js";import"./chevron-right-DqnxfF0a.js";import"./index-CmHjCS6i.js";const F=b("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),B=b("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),I=[{id:"laghouat",name:"Laghouat",nameAr:"الأغواط",wilaya:"الأغواط",phone:"0555 123 456",address:"شارع الأمير عبد القادر، الأغواط"},{id:"aflou",name:"Aflou",nameAr:"أفلو",wilaya:"الأغواط",phone:"0555 789 012",address:"حي النصر، أفلو"}],z=()=>{const b=s(),{toast:z}=N(),{items:R,totalPrice:T,clearCart:W,isLoading:H}=v(),[O,U]=r.useState(!1),[V,Z]=r.useState(!1),[E,G]=r.useState(null),J=n(),[K,Q]=r.useState({firstName:"",phone:"",wilaya:"",deliveryMethod:"home",address:"",selectedStore:"",pickupDate:void 0}),{data:Y,isLoading:X}=w(),ee=K.wilaya?parseInt(K.wilaya.split(" - ")[0],10):void 0,{data:se,isLoading:re,isError:te}=k(ee),ae=r.useMemo(()=>{if(!se)return{home:null,bureau:null,homeStore:"laghouat",bureauStore:"laghouat"};const e=se.map(e=>({price:e.home_price,store:e.store})).filter(e=>null!==e.price),s=se.map(e=>({price:e.bureau_price,store:e.store})).filter(e=>null!==e.price),r=e.length>0?e.reduce((e,s)=>e.price<s.price?e:s):null,t=s.length>0?s.reduce((e,s)=>e.price<s.price?e:s):null;return{home:r?.price||null,bureau:t?.price||null,homeStore:r?.store||"laghouat",bureauStore:t?.store||"laghouat"}},[se]),le=r.useMemo(()=>"pickup"===K.deliveryMethod||re?0:"home"===K.deliveryMethod?ae.home??0:"bureau"===K.deliveryMethod?ae.bureau??0:0,[K.deliveryMethod,ae,re]),ie=T+le,de=I.find(e=>e.id===K.selectedStore),oe=r.useMemo(()=>$(new Date),[]);return H?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(a,{}),e.jsx(l,{}),e.jsx("main",{className:"flex-1 container py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(g,{className:"h-48 w-full"}),e.jsx(g,{className:"h-32 w-full"}),e.jsx(g,{className:"h-64 w-full"}),e.jsx(g,{className:"h-12 w-full"})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(g,{className:"h-96 w-full"})})]})}),e.jsx(i,{})]}):0!==R.length||V?V?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(a,{}),e.jsx(l,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(B,{className:"w-10 h-10 text-green-600"})}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-arabic-display font-bold text-secondary mb-4",children:["تم تأكيد طلبك بنجاح! ",E&&`(رقم الطلب: ${E})`]}),e.jsxs("p",{className:"text-muted-foreground font-body mb-6",children:["شكراً لك على طلبك ",K.wilaya&&`لولاية ${K.wilaya.split(" - ")[1]}`,". سنتواصل معك قريباً لتأكيد التفاصيل.",E&&` رقم طلبك هو: ${E}.`]}),e.jsx(d,{onClick:()=>b("/"),className:"font-body",children:"العودة للرئيسية"})]})}),e.jsx(i,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(a,{}),e.jsx(l,{}),e.jsxs("main",{className:"flex-1",children:[e.jsx("div",{className:"bg-muted/50 py-3",children:e.jsx("div",{className:"container",children:e.jsxs("nav",{className:"flex items-center gap-2 text-sm font-body text-muted-foreground",children:[e.jsx(t,{to:"/",className:"hover:text-primary transition-colors",children:"الرئيسية"}),e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"text-foreground",children:"تأكيد الطلب"})]})})}),e.jsx("section",{className:"py-8 md:py-12",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-arabic-display font-bold text-secondary mb-8",children:"تأكيد الطلب"}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!K.firstName||!K.phone)return void z({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});if(/^\d+$/.test(K.phone))if("pickup"===K.deliveryMethod||K.wilaya)if("home"!==K.deliveryMethod||K.address)if("pickup"!==K.deliveryMethod||K.selectedStore)if("pickup"!==K.deliveryMethod||K.pickupDate)if("pickup"===K.deliveryMethod||!re&&!te){U(!0);try{let e,s=null,r=null;if("pickup"===K.deliveryMethod&&de){const e=Y?.find(e=>e.includes(de.wilaya));e&&(s=parseInt(e.split(" - ")[0],10),r=e.split(" - ")[1])}else K.wilaya&&(s=parseInt(K.wilaya.split(" - ")[0],10),r=K.wilaya.split(" - ")[1]);if(null===s||null===r)return z({title:"خطأ",description:"تعذر تحديد معلومات الولاية. يرجى التحقق من تحديد الولاية أو المتجر بشكل صحيح.",variant:"destructive"}),void U(!1);e="pickup"===K.deliveryMethod?K.selectedStore:"home"===K.deliveryMethod?ae.homeStore:ae.bureauStore;const t={customer_name:K.firstName,customer_phone:K.phone,wilaya_code:s,wilaya_name:r,address:"home"===K.deliveryMethod?K.address:null,delivery_type:K.deliveryMethod,delivery_price:le,subtotal:T,total:ie,status:"new",send_from_store:e,notes:"pickup"===K.deliveryMethod&&K.pickupDate?`تاريخ الاستلام: ${L(K.pickupDate,"yyyy-MM-dd")}`:null},a=R.map(e=>({product_id:e.product.id,product_name_ar:e.product.nameAr||e.product.nameFr||"Unnamed Product (AR)",product_name_fr:e.product.nameFr||e.product.nameAr||"Unnamed Product (FR)",quantity:e.quantity,unit_price:e.product.price,weight:e.selectedWeight?.weight||null,total_price:e.product.price*e.quantity})),l=await J.mutateAsync({...t,items:a});Z(!0),G(l.order_number),W(),z({title:"نجاح",description:"تم تأكيد طلبك بنجاح!",variant:"success"})}catch(s){z({title:"خطأ",description:`فشل تأكيد الطلب: ${s.message||"حدث خطأ غير معروف"}`,variant:"destructive"})}finally{U(!1)}}else z({title:"خطأ",description:"جاري حساب سعر التوصيل. يرجى المحاولة مرة أخرى.",variant:"destructive"});else z({title:"خطأ",description:"يرجى اختيار تاريخ الاستلام",variant:"destructive"});else z({title:"خطأ",description:"يرجى اختيار المتجر",variant:"destructive"});else z({title:"خطأ",description:"يرجى إدخال عنوان التوصيل",variant:"destructive"});else z({title:"خطأ",description:"يرجى اختيار الولاية",variant:"destructive"});else z({title:"خطأ",description:"رقم الهاتف يجب أن يحتوي على أرقام فقط",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border",children:[e.jsx("h2",{className:"text-xl font-arabic font-semibold mb-4",children:"معلومات الزبون"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["الاسم ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsx(o,{type:"text",value:K.firstName,onChange:e=>Q({...K,firstName:e.target.value}),placeholder:"أدخل اسمك",required:!0,className:"font-body"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["رقم الهاتف ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsx(o,{type:"tel",value:K.phone,onChange:e=>Q({...K,phone:e.target.value}),placeholder:"0555 123 456",required:!0,className:"font-body",dir:"ltr"})]})]})]}),"pickup"!==K.deliveryMethod&&e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border",children:[e.jsxs("h2",{className:"text-xl font-arabic font-semibold mb-4",children:["الولاية ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsxs(h,{value:K.wilaya,onValueChange:e=>Q({...K,wilaya:e}),disabled:X,children:[e.jsx(u,{className:"w-full font-body",children:e.jsx(j,{placeholder:X?"جاري تحميل الولايات...":"اختر الولاية"})}),e.jsx(f,{className:"max-h-[300px]",children:Y?.map(s=>e.jsx(y,{value:s,className:"font-body",children:s},s))})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border",children:[e.jsx("h2",{className:"text-xl font-arabic font-semibold mb-4",children:"طريقة التوصيل"}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>Q({...K,deliveryMethod:"home",selectedStore:""}),className:"p-4 rounded-lg border-2 transition-all text-right "+("home"===K.deliveryMethod?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[e.jsx(_,{className:"w-8 h-8 mb-2 "+("home"===K.deliveryMethod?"text-primary":"text-muted-foreground")}),e.jsx("h3",{className:"font-arabic font-semibold",children:"توصيل للمنزل"}),e.jsx("p",{className:"text-sm text-muted-foreground font-body",children:"Livraison à domicile"}),K.wilaya&&null!==ae.home&&!re?e.jsxs("p",{className:"text-primary font-bold mt-2",dir:"ltr",children:[ae.home," د.ج ",e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",I.find(e=>e.id===ae.homeStore)?.nameAr,")"]})]}):e.jsx("p",{className:"text-muted-foreground font-body mt-2",children:re?"جاري الحساب...":"اختر الولاية"})]}),e.jsxs("button",{type:"button",onClick:()=>Q({...K,deliveryMethod:"bureau",address:"",selectedStore:""}),className:"p-4 rounded-lg border-2 transition-all text-right "+("bureau"===K.deliveryMethod?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[e.jsx(C,{className:"w-8 h-8 mb-2 "+("bureau"===K.deliveryMethod?"text-primary":"text-muted-foreground")}),e.jsx("h3",{className:"font-arabic font-semibold",children:"مكتب التوصيل"}),e.jsx("p",{className:"text-sm text-muted-foreground font-body",children:"Bureau"}),K.wilaya&&null!==ae.bureau&&!re?e.jsxs("p",{className:"text-primary font-bold mt-2",dir:"ltr",children:[ae.bureau," د.ج ",e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",I.find(e=>e.id===ae.bureauStore)?.nameAr,")"]})]}):e.jsx("p",{className:"text-muted-foreground font-body mt-2",children:re?"جاري الحساب...":"اختر الولاية"})]}),e.jsxs("button",{type:"button",onClick:()=>Q({...K,deliveryMethod:"pickup",address:"",wilaya:""}),className:"p-4 rounded-lg border-2 transition-all text-right "+("pickup"===K.deliveryMethod?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[e.jsx(M,{className:"w-8 h-8 mb-2 "+("pickup"===K.deliveryMethod?"text-primary":"text-muted-foreground")}),e.jsx("h3",{className:"font-arabic font-semibold",children:"استلام من المتجر"}),e.jsx("p",{className:"text-sm text-muted-foreground font-body",children:"Retrait en magasin"}),e.jsx("p",{className:"text-green-600 font-bold mt-2",children:"مجاني"})]})]}),"home"===K.deliveryMethod&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["العنوان الكامل ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsx(o,{type:"text",value:K.address,onChange:e=>Q({...K,address:e.target.value}),placeholder:"الحي، الشارع، رقم المنزل...",required:!0,className:"font-body"})]}),"pickup"===K.deliveryMethod&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["اختر المتجر ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsxs(h,{value:K.selectedStore,onValueChange:e=>Q({...K,selectedStore:e}),children:[e.jsx(u,{className:"w-full font-body",children:e.jsx(j,{placeholder:"اختر المتجر"})}),e.jsx(f,{children:I.map(s=>e.jsxs(y,{value:s.id,className:"font-body",children:[s.name," - ",s.nameAr]},s.id))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["تاريخ الاستلام ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsxs(c,{children:[e.jsx(m,{asChild:!0,children:e.jsxs(d,{type:"button",variant:"outline",className:"w-full justify-between font-body "+(K.pickupDate?"":"text-muted-foreground"),children:[e.jsx("span",{children:K.pickupDate?L(K.pickupDate,"PPP",{locale:q}):"اختر تاريخ الاستلام"}),e.jsx(F,{className:"h-4 w-4 opacity-50"})]})}),e.jsx(x,{className:"w-auto p-0",align:"start",children:e.jsx(p,{mode:"single",selected:K.pickupDate,onSelect:e=>Q({...K,pickupDate:e}),disabled:e=>e<oe,initialFocus:!0,className:"p-3 pointer-events-auto"})})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground font-body",children:"يمكنك اختيار تاريخ الاستلام المناسب لك."})]}),de&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h4",{className:"font-arabic font-semibold text-secondary",children:"معلومات المتجر"}),e.jsx("span",{className:"bg-green-100 text-green-700 text-xs font-body px-2 py-1 rounded-full",children:"بدون مصاريف توصيل"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-body",children:de.nameAr})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{className:"font-body text-muted-foreground",children:["ولاية ",de.wilaya]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-body text-muted-foreground",dir:"ltr",children:de.phone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-body text-muted-foreground",children:"استلام شخصي من المتجر"})]})]})]})]})]}),e.jsx(d,{type:"submit",size:"lg",className:"w-full font-body text-lg",disabled:O||J.isPending,children:O||J.isPending?"جاري تأكيد الطلب...":"تأكيد الطلب"})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border sticky top-24",children:[e.jsx("h2",{className:"text-xl font-arabic font-semibold mb-4",children:"ملخص الطلب"}),e.jsx("div",{className:"space-y-4 mb-6",children:R.map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:s.product.image,alt:s.product.nameAr,className:"w-16 h-16 rounded-lg object-cover",decoding:"async"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-arabic text-sm font-medium line-clamp-1",children:s.product.nameAr}),e.jsxs("p",{className:"text-xs text-muted-foreground font-body",children:["الكمية: ",s.quantity]}),e.jsxs("p",{className:"text-primary font-semibold text-sm",dir:"ltr",children:[s.product.price*s.quantity," د.ج"]})]})]},s.selectedWeight?`${s.product.id}-${s.selectedWeight.id}`:s.product.id))}),e.jsxs("div",{className:"border-t border-border pt-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:["home"===K.deliveryMethod&&e.jsx(_,{className:"w-4 h-4 text-primary"}),"bureau"===K.deliveryMethod&&e.jsx(C,{className:"w-4 h-4 text-primary"}),"pickup"===K.deliveryMethod&&e.jsx(M,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-body text-sm",children:["home"===K.deliveryMethod&&"توصيل للمنزل","bureau"===K.deliveryMethod&&"مكتب التوصيل","pickup"===K.deliveryMethod&&"استلام من المتجر"]})]}),"pickup"===K.deliveryMethod?e.jsxs("div",{className:"mr-6 space-y-1",children:[de&&e.jsx("p",{className:"text-xs text-muted-foreground font-body",children:de.nameAr}),K.pickupDate&&e.jsxs("p",{className:"text-xs text-muted-foreground font-body",children:["تاريخ الاستلام: ",L(K.pickupDate,"PPP",{locale:q})]})]}):K.wilaya&&e.jsx("div",{className:"mr-6 space-y-1",children:e.jsxs("p",{className:"text-xs text-muted-foreground font-body",children:["الولاية: ",K.wilaya.split(" - ")[1]]})})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between font-body",children:[e.jsx("span",{className:"text-muted-foreground",children:"المجموع الفرعي"}),e.jsxs("span",{dir:"ltr",children:[T," د.ج"]})]}),e.jsxs("div",{className:"flex justify-between font-body",children:[e.jsx("span",{className:"text-muted-foreground",children:"التوصيل"}),"pickup"===K.deliveryMethod?e.jsx("span",{className:"text-green-600 font-semibold",children:"مجاني"}):e.jsxs("span",{dir:"ltr",children:[le," د.ج"]})]}),e.jsxs("div",{className:"flex justify-between font-arabic font-bold text-lg pt-2 border-t border-border",children:[e.jsx("span",{children:"المجموع الكلي"}),e.jsxs("span",{className:"text-primary",dir:"ltr",children:[ie," د.ج"]})]})]})]})})]})]})})]}),e.jsx(i,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(a,{}),e.jsx(l,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-arabic-display mb-4",children:"سلة التسوق فارغة"}),e.jsx(t,{to:"/",className:"text-primary hover:underline font-body",children:"العودة للتسوق"})]})}),e.jsx(i,{})]})};export{z as default};
