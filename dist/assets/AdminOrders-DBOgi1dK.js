import{r as n,e as we,j as e,a as R,X as ae}from"./index-DJa8JmTm.js";import{S as le}from"./skeleton-DUhNiQSq.js";import{a as P,C as T}from"./card-3nGiqXgO.js";import{B as m}from"./button-DQkp_F6k.js";import{I as _e}from"./input-CNvN4VzI.js";import{L as E}from"./label-CkhIcTXw.js";import{u as ke,C as re,S as Oe}from"./use-debounce-D8fGzHVw.js";import{S as y,a as v,b,c as C,d as o}from"./select-B8B0hAyU.js";import{D as Ae,a as Pe,b as Te,c as Ee}from"./dialog-CnD21xAc.js";import{A as Me,a as Fe,b as Le,c as $e,d as Ie,e as Be,f as Qe,g as Re}from"./alert-dialog-D3DNJpgx.js";import{P as He,a as Ue,b as H,c as Ve,d as Ze,e as ze}from"./pagination-BSI4Flxg.js";import{D as qe,p as We}from"./date-range-picker-Cif2RVIH.js";import{f as Ge,g as Xe,h as Je,j as Ke,k as Ye}from"./useOrders-4OmE96zU.js";import{u as es,F as ss,a as ts,O as as,E as ls,C as rs}from"./CreateOrderDialog-_njDyvy8.js";import{T as ns}from"./trash-2-DCfUe7bk.js";import{S as is}from"./search-CWP1OLDI.js";import{P as cs}from"./plus-BDCGZCab.js";import{P as ne}from"./package-B7xOaovl.js";import{T as os}from"./truck-2G314Y2O.js";import{B as ds}from"./building-2-CwKry2ya.js";import{S as ms}from"./useTariffs-2yaO5S4w.js";import{S as hs}from"./square-pen-DucBXbdO.js";import{P as xs}from"./phone-BCYrnSCU.js";import{M as us}from"./map-pin-DSo7UTKA.js";import{f as S}from"./format-CuvDg6tx.js";import"./Combination-D-uuNelE.js";import"./chevron-down-Dn-4MBn6.js";import"./chevron-left-Bv7kFfeV.js";import"./chevron-right-7HFw8PeQ.js";import"./useMutation-wRGvQ37d.js";import"./badge-783OJbhB.js";import"./save-BtmLQnuv.js";import"./useProducts-T2pr3msx.js";const ie=20,h={new:"New",confirmed:"Confirmed",delivered:"Delivered",canceled:"Canceled",returned:"Returned"},ce={new:"bg-amber-100 text-amber-800",confirmed:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",canceled:"bg-red-100 text-red-800",returned:"bg-purple-100 text-purple-800"},j={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},Ws=()=>{const[D,w]=n.useState(1),[l,U]=n.useState({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),[i,V]=n.useState(void 0),M=ke(l.searchQuery,500),{data:oe,isLoading:_}=Ge({page:D,pageSize:ie,searchQuery:M,status:l.status,deliveryType:l.deliveryType,store:l.store,fromDate:i?.from?S(i.from,"yyyy-MM-dd"):void 0,toDate:i?.to?S(i.to,"yyyy-MM-dd"):void 0}),{data:d=[],count:Z=0}=oe||{},de=es(),me=Xe(),F=Je(),z=Ke(),{toast:x}=we(),[a,L]=n.useState(null),[he,q]=n.useState(null),[xe,W]=n.useState(!1),[G,X]=n.useState(!1),[f,ue]=n.useState(!1),[c,u]=n.useState([]),[pe,$]=n.useState(!1),[I,J]=n.useState(""),[K,Y]=n.useState(!1),{refetch:je}=Ye({searchQuery:M,status:l.status,deliveryType:l.deliveryType,store:l.store,fromDate:i?.from?S(i.from,"yyyy-MM-dd"):void 0,toDate:i?.to?S(i.to,"yyyy-MM-dd"):void 0}),k=(s,t)=>{U(p=>({...p,[s]:t}))},O=n.useMemo(()=>{const s={...l};return delete s.searchQuery,Object.values(s).some(t=>t!=="all"&&t!=="")||i?.from||i?.to},[l,i]);n.useEffect(()=>{w(1)},[M,l.status,l.deliveryType,l.store,i]),n.useEffect(()=>{!f&&O&&te()},[f,O]);const ee=s=>{u(t=>t.includes(s)?t.filter(p=>p!==s):[...t,s])},fe=()=>{c.length===d.length?u([]):u(d.map(s=>s.id))},ge=async s=>{await F.mutateAsync({ids:c,status:s}),x({title:"Updated",description:`${c.length} orders updated.`}),u([]),J("")},Ne=async()=>{await z.mutateAsync(c),x({title:"Deleted",description:`${c.length} orders deleted.`}),u([]),$(!1)},se=(s,t)=>{me.mutateAsync({id:s,status:t}),x({title:"Updated",description:`Order status changed to ${h[t]}.`})},te=()=>{U({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),V(void 0)},ye=async()=>{Y(!0);try{const{data:s}=await je();if(!s||s.length===0){x({title:"Export Failed",description:"No orders to export.",variant:"destructive"});return}let t=0;s.forEach(r=>{r.items&&r.items.length>t&&(t=r.items.length)});const ve=["Order Number","Customer Name","Customer Phone","Wilaya","Address","Delivery Type","Store","Subtotal","Notes",...Array.from({length:t},(r,B)=>`Item ${B+1}`)],be=s.map(r=>{const B=[r.order_number,`"${r.customer_name}"`,r.customer_phone,r.wilaya_name,`"${r.address||""}"`,j[r.delivery_type],r.send_from_store,r.subtotal,`"${r.notes||""}"`],Q=(r.items||[]).map(N=>`"${N.product_name_fr||N.product_name_ar} (Qty: ${N.quantity}, Price: ${N.unit_price}, Weight: ${N.weight||"N/A"})"`);for(;Q.length<t;)Q.push("");return[...B,...Q].join(",")}),Ce="\uFEFF"+[ve.join(","),...be].join(`
`),Se=new Blob([Ce],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a"),De=URL.createObjectURL(Se);g.setAttribute("href",De),g.setAttribute("download",`orders_export_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(g),g.click(),document.body.removeChild(g),x({title:"Export Successful",description:`${s.length} orders have been exported.`})}catch(s){console.error("Export failed:",s),x({title:"Export Failed",description:"An error occurred while exporting orders.",variant:"destructive"})}finally{Y(!1)}},A=Math.ceil(Z/ie);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("p",{className:"text-muted-foreground",children:["Manage and track all ",Z," orders"]})]}),c.length>0&&e.jsx(P,{className:"border-primary",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"font-medium",children:[c.length," orders selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{value:I,onValueChange:J,children:[e.jsx(v,{className:"w-full sm:w-[180px]",children:e.jsx(b,{placeholder:"Change status..."})}),e.jsx(C,{children:Object.keys(h).map(s=>e.jsx(o,{value:s,children:h[s]},s))})]}),I&&e.jsx(m,{onClick:()=>ge(I),disabled:F.isPending,children:F.isPending?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Apply"}),e.jsxs(m,{variant:"destructive",onClick:()=>$(!0),children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"Delete"]}),e.jsx(m,{variant:"ghost",onClick:()=>u([]),children:e.jsx(ae,{className:"w-4 h-4"})})]})]})})}),e.jsx(P,{children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(_e,{placeholder:"Search by order ID, customer name, or phone...",value:l.searchQuery,onChange:s=>k("searchQuery",s.target.value),className:"pl-10"})]}),e.jsxs(m,{variant:f?"secondary":"outline",onClick:()=>ue(!f),children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Filters",O&&e.jsx("span",{className:"ml-2 w-2 h-2 bg-primary rounded-full"})]}),e.jsxs(m,{variant:"default",className:"bg-green-500 text-white hover:bg-green-600",onClick:ye,disabled:K,children:[K?e.jsx(R,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(m,{variant:"default",onClick:()=>X(!0),children:[e.jsx(cs,{className:"w-4 h-4 mr-2"})," Create Order"]})]}),f&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium mb-1.5 block",children:"Status"}),e.jsxs(y,{value:l.status,onValueChange:s=>k("status",s),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(o,{value:"all",children:"All"}),Object.keys(h).map(s=>e.jsx(o,{value:s,children:h[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium mb-1.5 block",children:"Delivery"}),e.jsxs(y,{value:l.deliveryType,onValueChange:s=>k("deliveryType",s),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(o,{value:"all",children:"All"}),Object.keys(j).map(s=>e.jsx(o,{value:s,children:j[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium mb-1.5 block",children:"Store"}),e.jsxs(y,{value:l.store,onValueChange:s=>k("store",s),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(o,{value:"all",children:"All"}),e.jsx(o,{value:"laghouat",children:"Laghouat"}),e.jsx(o,{value:"aflou",children:"Aflou"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[" ",e.jsx(E,{className:"text-sm font-medium mb-1.5 block",children:"Date Range"}),e.jsx(qe,{date:i,onSelect:s=>{V(s)}})]})]}),O&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:te,children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Clear Filters"]})})]})]})}),de?e.jsxs("div",{className:"space-y-4",children:[_?Array.from({length:10}).map((s,t)=>e.jsx(P,{children:e.jsx(T,{className:"p-4",children:e.jsx(le,{className:"h-32 w-full"})})},t)):d.map(s=>e.jsx(as,{order:s,isSelected:c.includes(s.id),onSelect:ee,onViewDetails:L,onStatusChange:se,statusLabels:h,statusColors:ce,deliveryLabels:j},s.id)),d.length===0&&!_&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]}):e.jsx(P,{children:e.jsxs(T,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50 text-left",children:[e.jsx("th",{className:"p-3",children:e.jsx(re,{checked:c.length===d.length&&d.length>0,onCheckedChange:fe})}),e.jsx("th",{className:"p-3 font-medium",children:"Order #"}),e.jsx("th",{className:"p-3 font-medium",children:"Customer"}),e.jsx("th",{className:"p-3 font-medium",children:"Delivery"}),e.jsx("th",{className:"p-3 font-medium",children:"Store"}),e.jsx("th",{className:"p-3 font-medium",children:"Total"}),e.jsx("th",{className:"p-3 font-medium",children:"Status"}),e.jsx("th",{className:"p-3 font-medium",children:"Date"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:_?Array.from({length:10}).map((s,t)=>e.jsx("tr",{className:"border-b",children:e.jsx("td",{colSpan:10,className:"p-4",children:e.jsx(le,{className:"h-6 w-full"})})},t)):d.map(s=>e.jsxs("tr",{className:`border-b hover:bg-muted/30 cursor-pointer ${s.is_manual?"bg-red-800/30":""}`,onClick:()=>L(s),children:[e.jsx("td",{className:"p-3",onClick:t=>t.stopPropagation(),children:e.jsx(re,{checked:c.includes(s.id),onCheckedChange:()=>ee(s.id)})}),e.jsx("td",{className:"p-3 font-mono text-xs",children:s.order_number}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.customer_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.customer_phone})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[s.delivery_type==="home"&&e.jsx(os,{className:"w-4 h-4"}),s.delivery_type==="bureau"&&e.jsx(ds,{className:"w-4 h-4"}),s.delivery_type==="pickup"&&e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:j[s.delivery_type]})]})}),e.jsx("td",{className:"p-3 capitalize",children:s.send_from_store}),e.jsxs("td",{className:"p-3 font-semibold",children:[s.total.toLocaleString()," DZD"]}),e.jsx("td",{className:"p-3",children:e.jsxs(y,{value:s.status,onValueChange:t=>se(s.id,t),onClick:t=>t.stopPropagation(),children:[e.jsx(v,{className:`w-[120px] h-8 text-xs border-0 ${ce[s.status]}`,children:e.jsx(b,{})}),e.jsx(C,{children:Object.keys(h).map(t=>e.jsx(o,{value:t,children:h[t]},t))})]})}),e.jsx("td",{className:"p-3 text-xs",children:S(We(s.created_at),"dd/MM/yyyy HH:mm")}),e.jsx("td",{className:"p-3",onClick:t=>t.stopPropagation(),children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{q(s),W(!0)},children:e.jsx(hs,{className:"w-4 h-4"})})})]},s.id))})]})}),d.length===0&&!_&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]})}),A>1&&e.jsx(He,{children:e.jsxs(Ue,{className:"flex-wrap",children:[e.jsx(H,{children:e.jsx(Ve,{href:"#",onClick:s=>{s.preventDefault(),w(t=>Math.max(1,t-1))},className:D===1?"pointer-events-none opacity-50":""})}),e.jsx("div",{className:"hidden sm:flex",children:[...Array(A)].map((s,t)=>e.jsx(H,{children:e.jsx(Ze,{href:"#",onClick:p=>{p.preventDefault(),w(t+1)},isActive:D===t+1,children:t+1})},t))}),e.jsx(H,{children:e.jsx(ze,{href:"#",onClick:s=>{s.preventDefault(),w(t=>Math.min(A,t+1))},className:D===A?"pointer-events-none opacity-50":""})})]})}),e.jsx(Ae,{open:!!a,onOpenChange:()=>L(null),children:e.jsx(Pe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:e.jsxs(Ee,{children:["Order Details - ",a.order_number]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(xs,{className:"w-4 h-4"}),"Customer Information"]}),e.jsx("p",{children:a.customer_name}),e.jsx("p",{className:"text-muted-foreground",children:a.customer_phone}),a.customer_email&&e.jsx("p",{className:"text-muted-foreground",children:a.customer_email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4"}),"Delivery Information"]}),e.jsx("p",{children:a.wilaya_name}),a.address&&e.jsx("p",{className:"text-muted-foreground",children:a.address}),e.jsxs("p",{className:"text-sm",children:["Type: ",j[a.delivery_type]]}),e.jsxs("p",{className:"text-sm",children:["Store: ",a.send_from_store.charAt(0).toUpperCase()+a.send_from_store.slice(1)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:a.items.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg",children:["                      ",e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product_name_ar||s.product_name_fr||"No Product Name Available"}),s.weight&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Oe,{className:"w-3 h-3"})," ",s.weight]}),s.product_name_ar&&s.product_name_fr&&s.product_name_ar!==s.product_name_fr&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.product_name_fr})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[s.total_price.toLocaleString()," DZD"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity," Ã— ",s.unit_price.toLocaleString()," DZD"]})]})]},t))})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[a.subtotal.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery"}),e.jsxs("span",{children:[a.delivery_price.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:[a.total.toLocaleString()," DZD"]})]})]}),a.notes&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]})]})]})})}),e.jsx(Me,{open:pe,onOpenChange:$,children:e.jsxs(Fe,{children:[e.jsxs(Le,{children:[e.jsx($e,{children:"Delete Orders"}),e.jsxs(Ie,{children:["Are you sure you want to delete ",c.length," order(s)? This action cannot be undone."]})]}),e.jsxs(Be,{children:[e.jsx(Qe,{children:"Cancel"}),e.jsx(Re,{onClick:Ne,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:z.isPending?e.jsx(R,{className:"w-4 h-4 animate-spin"}):"Delete"})]})]})}),e.jsx(ls,{order:he,isOpen:xe,onClose:()=>{W(!1),q(null)}}),G&&e.jsx(rs,{isOpen:G,onClose:()=>X(!1)})]})};export{Ws as default};
