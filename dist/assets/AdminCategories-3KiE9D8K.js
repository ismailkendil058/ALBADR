import{r as i,e as H,j as e,a as q,X as W,s as k}from"./index-CzubCIAQ.js";import{a as I,C as P}from"./card-laboSzSy.js";import{B as l}from"./button-mNsHMIkq.js";import{I as S}from"./input-ahHenGQ4.js";import{L as C}from"./label-DyR_ZUp8.js";import{D as X,a as G,b as J,c as K,d as Q}from"./dialog-DaqzuSbj.js";import{A as V,a as Y,b as Z,c as ee,d as te,e as se,f as ae,g as re}from"./alert-dialog-BdudfyX6.js";import{u as ie}from"./useCategories-Cm_Vywgk.js";import{P as U}from"./plus-BzMTRC6J.js";import{S as le}from"./square-pen-DU_zNNOu.js";import{T as oe}from"./trash-2-CCtYTIZv.js";import{P as ce}from"./package-B-BPs0An.js";import{F as ne}from"./folder-tree-B9O96c7E.js";import{I as de}from"./image-HriddqiJ.js";import{U as me}from"./upload-BD50tocH.js";import"./Combination-Cz0VTwcJ.js";import"./useMutation-CjuJ8xHN.js";const Pe=()=>{const{categories:c,isLoading:x,error:d,addCategory:E,updateCategory:_,deleteCategory:T}=ie(),[M,n]=i.useState(!1),[m,b]=i.useState(null),[a,u]=i.useState(null),[f,j]=i.useState(""),[v,N]=i.useState(""),[g,p]=i.useState(null),[h,w]=i.useState(!1),r=i.useRef(null),{toast:s}=H(),A=()=>{b(null),j(""),N(""),p(null),n(!0),r.current&&(r.current.value="")},z=t=>{b(t),j(t.name_fr),N(t.name_ar),p(t.image),n(!0),r.current&&(r.current.value="")},$=async t=>{const o=t.target.files?.[0];if(o){if(!o.type.startsWith("image/")){s({title:"Invalid file",description:"Please select an image.",variant:"destructive"});return}if(o.size>5*1024*1024){s({title:"File too large",description:"Image must be less than 5MB.",variant:"destructive"});return}w(!0);try{const y=o.name.split(".").pop(),D=`categories/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${y}`}`,{error:F}=await k.storage.from("catig").upload(D,o,{upsert:!0});if(F)throw F;const{data:{publicUrl:B}}=k.storage.from("catig").getPublicUrl(D);p(B),s({title:"Uploaded",description:"Image uploaded successfully."})}catch(y){s({title:"Upload failed",description:y.message,variant:"destructive"})}finally{w(!1)}}},L=()=>{p(null),r.current&&(r.current.value="")},O=async()=>{if(!f.trim()||!v.trim()){s({title:"Error",description:"Please enter both French and Arabic category names",variant:"destructive"});return}try{const t={name_fr:f.trim(),name_ar:v.trim(),image:g};m?(await _({id:m.id,updatedFields:t}),s({title:"Updated",description:"Category updated successfully"})):(await E({...t,is_special:!1}),s({title:"Added",description:"Category added successfully"})),n(!1)}catch(t){s({title:"Error",description:t.message||"Failed to save category",variant:"destructive"})}},R=async()=>{if(a){if((a.products[0]?.count||0)>0){s({title:"Cannot Delete",description:"This category contains products. Please move products first.",variant:"destructive"}),u(null);return}try{await T(a.id),s({title:"Deleted",description:"Category deleted successfully"})}catch(o){s({title:"Error",description:o.message||"Failed to delete category",variant:"destructive"})}u(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Categories"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage product categories"})]}),e.jsxs(l,{onClick:A,children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Add Category"]})]}),x&&e.jsx("p",{children:"Loading categories..."}),d&&e.jsxs("p",{className:"text-destructive",children:["Error: ",d.message]}),!x&&!d&&c&&c.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.map(t=>e.jsxs(I,{className:"overflow-hidden group",children:[e.jsxs("div",{className:"aspect-video relative bg-muted",children:[e.jsx("img",{loading:"lazy",src:t.image||"/placeholder.svg",alt:t.name_fr,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(l,{variant:"outline",size:"icon",className:"bg-background/80 hover:bg-background",onClick:()=>z(t),children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx(l,{variant:"outline",size:"icon",className:"bg-background/80 hover:bg-background text-destructive hover:text-destructive",onClick:()=>u(t),children:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-bold",children:t.name_fr}),e.jsx("h3",{className:"font-bold text-right",dir:"rtl",children:t.name_ar}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),t.products[0]?.count||0," products"]})]})]},t.id))}),!x&&!d&&(!c||c.length===0)&&e.jsx(I,{children:e.jsxs(P,{className:"py-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No categories yet"}),e.jsxs(l,{onClick:A,className:"mt-4",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Add First Category"]})]})}),e.jsx(X,{open:M,onOpenChange:n,children:e.jsxs(G,{className:"max-w-md",children:[e.jsx(J,{children:e.jsx(K,{children:m?"Edit Category":"Add New Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"categoryNameFr",children:"Category Name (French)"}),e.jsx(S,{id:"categoryNameFr",value:f,onChange:t=>j(t.target.value),placeholder:"e.g., Spices"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"categoryNameAr",children:"Category Name (Arabic)"}),e.jsx(S,{id:"categoryNameAr",value:v,onChange:t=>N(t.target.value),placeholder:"e.g., بهارات",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{children:"Category Image"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-32 h-32 border-2 border-dashed rounded-lg flex items-center justify-center bg-muted/50 overflow-hidden",children:g?e.jsx("img",{src:g,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(de,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[e.jsx("input",{ref:r,type:"file",accept:"image/*",onChange:$,className:"hidden"}),e.jsxs(l,{type:"button",variant:"outline",size:"sm",onClick:()=>r.current?.click(),disabled:h,children:[h?e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(me,{className:"w-4 h-4 mr-2"}),h?"Uploading...":"Upload"]}),g&&e.jsxs(l,{type:"button",variant:"ghost",size:"sm",onClick:L,className:"text-destructive hover:text-destructive",children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Remove"]})]})]})]})]}),e.jsxs(Q,{className:"gap-2 sm:gap-0",children:[e.jsx(l,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(l,{onClick:O,disabled:h,children:m?"Save Changes":"Add Category"})]})]})}),e.jsx(V,{open:!!a,onOpenChange:()=>u(null),children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Delete Category"}),e.jsx(te,{children:(a?.products[0]?.count||0)>0?`Cannot delete this category because it contains ${a?.products[0].count} products. Please move or delete them first.`:`Are you sure you want to delete "${a?.name_fr}"? This action cannot be undone.`})]}),e.jsxs(se,{className:"gap-2 sm:gap-0",children:[e.jsx(ae,{children:"Cancel"}),(a?.products[0]?.count||0)===0&&e.jsx(re,{onClick:R,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{Pe as default};
