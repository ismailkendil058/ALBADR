import{c as e,b as t,L as a,e as r}from"./index-BWpasF73.js";import{a as s}from"./react-vendor-1XlI0agO.js";import{j as n,w as l,P as i,z as d,E as c,F as o,G as u,H as m}from"./ui-vendor-CbTtZHsW.js";import{a as h,C as p}from"./card-PHeom2L9.js";import{C as f,u as x}from"./use-debounce-BKdP7V3a.js";import{S as v,a as g,b as j,c as y,d as w}from"./select-Bo_HCkAS.js";import{B as _}from"./badge-Db9_b52h.js";import{L as N}from"./label-Cu_4ZZv9.js";import{T as b}from"./truck-B8PAd3Dr.js";import{B as C}from"./building-2-CAmmrv1O.js";import{S as k,u as S,e as E}from"./useTariffs-C3-GvtHI.js";import{f as A}from"./format-v08Horlk.js";import{p as I}from"./date-range-picker-DBY0j15P.js";import{D,a as F,b as R,c as P,f as L,d as M,e as O}from"./dialog-DGWZHKxT.js";import{B as V}from"./button-D-ffmNcE.js";import{I as $}from"./input-m9ePOgnC.js";import{l as q,u as W}from"./useOrders-Bo6usLWA.js";import{S as z}from"./save-DkoGca0f.js";import{S as B}from"./search-BmT2NVnk.js";import{d as H}from"./useProducts-Dd0Ob86o.js";import{T as K}from"./trash-2-B78Q9GXL.js";const Z=e("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),T=e("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),G=e("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function U(){const[e,t]=s.useState(void 0);return s.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),a=()=>{t(window.innerWidth<768)};return e.addEventListener("change",a),t(window.innerWidth<768),()=>e.removeEventListener("change",a)},[]),!!e}const Q=({order:e,isSelected:t,onSelect:a,onViewDetails:r,onStatusChange:s,statusLabels:l,statusColors:i,deliveryLabels:d})=>n.jsx(h,{className:"mb-4 "+(e.is_manual?"bg-red-50/50":""),children:n.jsxs(p,{className:"p-4 space-y-3 cursor-pointer",onClick:()=>r(e),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[n.jsx(f,{checked:t,onCheckedChange:()=>a(e.id)}),n.jsxs("span",{className:"font-mono text-sm font-semibold",children:["#",e.order_number]})]}),n.jsx(_,{className:`text-xs ${i[e.status]}`,children:l[e.status]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-y-2 text-sm",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(N,{className:"text-muted-foreground",children:"Customer"}),n.jsx("p",{className:"font-medium",children:e.customer_name}),n.jsx("p",{className:"text-xs text-muted-foreground",children:e.customer_phone})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(N,{className:"text-muted-foreground",children:"Total"}),n.jsxs("p",{className:"font-semibold",children:[e.total.toLocaleString()," DZD"]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(N,{className:"text-muted-foreground",children:"Delivery"}),n.jsxs("div",{className:"flex items-center gap-1",children:["home"===e.delivery_type&&n.jsx(b,{className:"w-4 h-4"}),"bureau"===e.delivery_type&&n.jsx(C,{className:"w-4 h-4"}),"pickup"===e.delivery_type&&n.jsx(k,{className:"w-4 h-4"}),n.jsx("span",{children:d[e.delivery_type]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(N,{className:"text-muted-foreground",children:"Store"}),n.jsx("p",{className:"capitalize",children:e.send_from_store})]}),n.jsxs("div",{className:"space-y-1 col-span-2",children:[n.jsx(N,{className:"text-muted-foreground",children:"Date"}),n.jsx("p",{className:"text-xs",children:A(I(e.created_at),"dd/MM/yyyy HH:mm")})]})]}),n.jsx("div",{className:"flex justify-between items-center pt-3 border-t",children:n.jsxs(v,{value:e.status,onValueChange:t=>s(e.id,t),onClick:e=>e.stopPropagation(),children:[n.jsx(g,{className:`w-[120px] h-8 text-xs border ${i[e.status]}`,children:n.jsx(j,{})}),n.jsx(y,{children:Object.keys(l).map(e=>n.jsx(w,{value:e,children:l[e]},e))})]})})]})}),J=[{code:1,name:"أدرار"},{code:2,name:"الشلف"},{code:3,name:"الأغواط"},{code:4,name:"أم البواقي"},{code:5,name:"باتنة"},{code:6,name:"بجاية"},{code:7,name:"بسكرة"},{code:8,name:"بشار"},{code:9,name:"البليدة"},{code:10,name:"البويرة"},{code:11,name:"تمنراست"},{code:12,name:"تبسة"},{code:13,name:"تلمسان"},{code:14,name:"تيارت"},{code:15,name:"تيزي وزو"},{code:16,name:"الجزائر"},{code:17,name:"الجلفة"},{code:18,name:"جيجل"},{code:19,name:"سطيف"},{code:20,name:"سعيدة"},{code:21,name:"سكيكدة"},{code:22,name:"سيدي بلعباس"},{code:23,name:"عنابة"},{code:24,name:"قالمة"},{code:25,name:"قسنطينة"},{code:26,name:"المدية"},{code:27,name:"مستغانم"},{code:28,name:"المسيلة"},{code:29,name:"معسكر"},{code:30,name:"ورقلة"},{code:31,name:"وهران"},{code:32,name:"البيض"},{code:33,name:"إليزي"},{code:34,name:"برج بوعريريج"},{code:35,name:"بومرداس"},{code:36,name:"الطارف"},{code:37,name:"تندوف"},{code:38,name:"تيسمسيلت"},{code:39,name:"الوادي"},{code:40,name:"خنشلة"},{code:41,name:"سوق أهراس"},{code:42,name:"تيبازة"},{code:43,name:"ميلة"},{code:44,name:"عين الدفلى"},{code:45,name:"النعامة"},{code:46,name:"عين تموشنت"},{code:47,name:"غرداية"},{code:48,name:"غليزان"},{code:49,name:"المنيعة"},{code:50,name:"المغير"},{code:51,name:"أولاد جلال"},{code:52,name:"برج باجي مختار"},{code:53,name:"بني عباس"},{code:54,name:"تيميمون"},{code:55,name:"توقرت"},{code:56,name:"جانت"},{code:57,name:"عين صالح"},{code:58,name:"عين قزام"}],Y={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},X=({order:e,isOpen:r,onClose:l})=>{const[i,d]=s.useState({}),c=q(),{toast:o}=t();s.useEffect(()=>{e&&d({customer_name:e.customer_name,customer_phone:e.customer_phone,wilaya_name:e.wilaya_name,wilaya_code:e.wilaya_code,address:e.address,delivery_type:e.delivery_type,send_from_store:e.send_from_store,notes:e.notes,total:e.total,subtotal:e.subtotal,delivery_price:e.delivery_price})},[e]);const u=e=>{const{name:t,value:a}=e.target;d(e=>({...e,[t]:a}))},m=(e,t)=>{d(a=>({...a,[e]:t}))};return n.jsx(D,{open:r,onOpenChange:l,children:n.jsxs(F,{className:"sm:max-w-[425px]",children:[n.jsx(R,{children:n.jsxs(P,{children:["Edit Order ",e?.order_number]})}),n.jsxs("div",{className:"grid gap-4 py-4",children:[n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"customer_name",className:"text-right",children:"Customer Name"}),n.jsx($,{id:"customer_name",name:"customer_name",value:i.customer_name||"",onChange:u,className:"col-span-3"})]}),n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"customer_phone",className:"text-right",children:"Customer Phone"}),n.jsx($,{id:"customer_phone",name:"customer_phone",value:i.customer_phone||"",onChange:u,className:"col-span-3"})]}),n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"wilaya_name",className:"text-right",children:"Wilaya"}),n.jsxs(v,{name:"wilaya_name",value:i.wilaya_name||"",onValueChange:e=>{const t=J.find(t=>t.name===e);t&&d(e=>({...e,wilaya_name:t.name,wilaya_code:t.code}))},children:[n.jsx(g,{className:"col-span-3",children:n.jsx(j,{placeholder:"Select Wilaya"})}),n.jsx(y,{children:J.map(e=>n.jsx(w,{value:e.name,children:e.name},e.code))})]})]}),n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"address",className:"text-right",children:"Address"}),n.jsx($,{id:"address",name:"address",value:i.address||"",onChange:u,className:"col-span-3"})]}),n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"delivery_type",className:"text-right",children:"Delivery Type"}),n.jsxs(v,{name:"delivery_type",value:i.delivery_type||"",onValueChange:e=>m("delivery_type",e),children:[n.jsx(g,{className:"col-span-3",children:n.jsx(j,{placeholder:"Select delivery type"})}),n.jsx(y,{children:Object.keys(Y).map(e=>n.jsx(w,{value:e,children:Y[e]},e))})]})]}),n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"send_from_store",className:"text-right",children:"Store"}),n.jsxs(v,{name:"send_from_store",value:i.send_from_store||"",onValueChange:e=>m("send_from_store",e),children:[n.jsx(g,{className:"col-span-3",children:n.jsx(j,{placeholder:"Select store"})}),n.jsxs(y,{children:[n.jsx(w,{value:"laghouat",children:"Laghouat"}),n.jsx(w,{value:"aflou",children:"Aflou"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[n.jsx(N,{htmlFor:"notes",className:"text-right",children:"Notes"}),n.jsx($,{id:"notes",name:"notes",value:i.notes||"",onChange:u,className:"col-span-3"})]})]}),n.jsxs(V,{onClick:async()=>{if(e&&e.id)try{await c.mutateAsync({id:e.id,data:i}),o({title:"Order Updated",description:`Order ${e.order_number} has been updated.`}),l()}catch(t){o({title:"Update Failed",description:"An error occurred while updating the order.",variant:"destructive"})}},disabled:c.isPending,children:[c.isPending?n.jsx(a,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(z,{className:"w-4 h-4 mr-2"}),"Save changes"]})]})})};var ee=.999,te=/[\\\/_+.#"@\[\(\{&]/,ae=/[\\\/_+.#"@\[\(\{&]/g,re=/[\s-]/,se=/[\s-]/g;function ne(e,t,a,r,s,n,l){if(n===t.length)return s===e.length?1:.99;var i=`${s},${n}`;if(void 0!==l[i])return l[i];for(var d,c,o,u,m=r.charAt(n),h=a.indexOf(m,s),p=0;h>=0;)(d=ne(e,t,a,r,h+1,n+1,l))>p&&(h===s?d*=1:te.test(e.charAt(h-1))?(d*=.8,(o=e.slice(s,h-1).match(ae))&&s>0&&(d*=Math.pow(ee,o.length))):re.test(e.charAt(h-1))?(d*=.9,(u=e.slice(s,h-1).match(se))&&s>0&&(d*=Math.pow(ee,u.length))):(d*=.17,s>0&&(d*=Math.pow(ee,h-s))),e.charAt(h)!==t.charAt(n)&&(d*=.9999)),(d<.1&&a.charAt(h-1)===r.charAt(n+1)||r.charAt(n+1)===r.charAt(n)&&a.charAt(h-1)!==r.charAt(n))&&(.1*(c=ne(e,t,a,r,h+1,n+2,l))>d&&(d=.1*c)),d>p&&(p=d),h=a.indexOf(m,h+1);return l[i]=p,p}function le(e){return e.toLowerCase().replace(se," ")}function ie(e,t,a){return ne(e=a&&a.length>0?""+(e+" "+a.join(" ")):e,t,le(e),le(t),0,0,{})}var de='[cmdk-group=""]',ce='[cmdk-group-items=""]',oe='[cmdk-item=""]',ue=`${oe}:not([aria-disabled="true"])`,me="cmdk-item-select",he="data-value",pe=(e,t,a)=>ie(e,t,a),fe=s.createContext(void 0),xe=()=>s.useContext(fe),ve=s.createContext(void 0),ge=()=>s.useContext(ve),je=s.createContext(void 0),ye=s.forwardRef((e,t)=>{let a=Pe(()=>{var t,a;return{search:"",value:null!=(a=null!=(t=e.value)?t:e.defaultValue)?a:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),r=Pe(()=>new Set),n=Pe(()=>new Map),d=Pe(()=>new Map),c=Pe(()=>new Set),o=Fe(e),{label:u,children:m,value:h,onValueChange:p,filter:f,shouldFilter:x,loop:v,disablePointerSelection:g=!1,vimBindings:j=!0,...y}=e,w=l(),_=l(),N=l(),b=s.useRef(null),C=Oe();Re(()=>{if(void 0!==h){let e=h.trim();a.current.value=e,k.emit()}},[h]),Re(()=>{C(6,F)},[]);let k=s.useMemo(()=>({subscribe:e=>(c.current.add(e),()=>c.current.delete(e)),snapshot:()=>a.current,setState:(e,t,r)=>{var s,n,l,i;if(!Object.is(a.current[e],t)){if(a.current[e]=t,"search"===e)D(),A(),C(1,I);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(N);e?e.focus():null==(s=document.getElementById(w))||s.focus()}if(C(7,()=>{var e;a.current.selectedItemId=null==(e=R())?void 0:e.id,k.emit()}),r||C(5,F),void 0!==(null==(n=o.current)?void 0:n.value)){let e=null!=t?t:"";return void(null==(i=(l=o.current).onValueChange)||i.call(l,e))}}k.emit()}},emit:()=>{c.current.forEach(e=>e())}}),[]),S=s.useMemo(()=>({value:(e,t,r)=>{var s;t!==(null==(s=d.current.get(e))?void 0:s.value)&&(d.current.set(e,{value:t,keywords:r}),a.current.filtered.items.set(e,E(t,r)),C(2,()=>{A(),k.emit()}))},item:(e,t)=>(r.current.add(e),t&&(n.current.has(t)?n.current.get(t).add(e):n.current.set(t,new Set([e]))),C(3,()=>{D(),A(),a.current.value||I(),k.emit()}),()=>{d.current.delete(e),r.current.delete(e),a.current.filtered.items.delete(e);let t=R();C(4,()=>{D(),(null==t?void 0:t.getAttribute("id"))===e&&I(),k.emit()})}),group:e=>(n.current.has(e)||n.current.set(e,new Set),()=>{d.current.delete(e),n.current.delete(e)}),filter:()=>o.current.shouldFilter,label:u||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:w,inputId:N,labelId:_,listInnerRef:b}),[]);function E(e,t){var r,s;let n=null!=(s=null==(r=o.current)?void 0:r.filter)?s:pe;return e?n(e,a.current.search,t):0}function A(){if(!a.current.search||!1===o.current.shouldFilter)return;let e=a.current.filtered.items,t=[];a.current.filtered.groups.forEach(a=>{let r=n.current.get(a),s=0;r.forEach(t=>{let a=e.get(t);s=Math.max(a,s)}),t.push([a,s])});let r=b.current;P().sort((t,a)=>{var r,s;let n=t.getAttribute("id"),l=a.getAttribute("id");return(null!=(r=e.get(l))?r:0)-(null!=(s=e.get(n))?s:0)}).forEach(e=>{let t=e.closest(ce);t?t.appendChild(e.parentElement===t?e:e.closest(`${ce} > *`)):r.appendChild(e.parentElement===r?e:e.closest(`${ce} > *`))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let a=null==(t=b.current)?void 0:t.querySelector(`${de}[${he}="${encodeURIComponent(e[0])}"]`);null==a||a.parentElement.appendChild(a)})}function I(){let e=P().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(he);k.setState("value",t||void 0)}function D(){var e,t,s,l;if(!a.current.search||!1===o.current.shouldFilter)return void(a.current.filtered.count=r.current.size);a.current.filtered.groups=new Set;let i=0;for(let n of r.current){let r=E(null!=(t=null==(e=d.current.get(n))?void 0:e.value)?t:"",null!=(l=null==(s=d.current.get(n))?void 0:s.keywords)?l:[]);a.current.filtered.items.set(n,r),r>0&&i++}for(let[r,d]of n.current)for(let e of d)if(a.current.filtered.items.get(e)>0){a.current.filtered.groups.add(r);break}a.current.filtered.count=i}function F(){var e,t,a;let r=R();r&&((null==(e=r.parentElement)?void 0:e.firstChild)===r&&(null==(a=null==(t=r.closest(de))?void 0:t.querySelector('[cmdk-group-heading=""]'))||a.scrollIntoView({block:"nearest"})),r.scrollIntoView({block:"nearest"}))}function R(){var e;return null==(e=b.current)?void 0:e.querySelector(`${oe}[aria-selected="true"]`)}function P(){var e;return Array.from((null==(e=b.current)?void 0:e.querySelectorAll(ue))||[])}function L(e){let t=P()[e];t&&k.setState("value",t.getAttribute(he))}function M(e){var t;let a=R(),r=P(),s=r.findIndex(e=>e===a),n=r[s+e];null!=(t=o.current)&&t.loop&&(n=s+e<0?r[r.length-1]:s+e===r.length?r[0]:r[s+e]),n&&k.setState("value",n.getAttribute(he))}function O(e){let t,a=R(),r=null==a?void 0:a.closest(de);for(;r&&!t;)r=e>0?Ie(r,de):De(r,de),t=null==r?void 0:r.querySelector(ue);t?k.setState("value",t.getAttribute(he)):M(e)}let V=()=>L(P().length-1),$=e=>{e.preventDefault(),e.metaKey?V():e.altKey?O(1):M(1)},q=e=>{e.preventDefault(),e.metaKey?L(0):e.altKey?O(-1):M(-1)};return s.createElement(i.div,{ref:t,tabIndex:-1,...y,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=y.onKeyDown)||t.call(y,e);let a=e.nativeEvent.isComposing||229===e.keyCode;if(!e.defaultPrevented&&!a)switch(e.key){case"n":case"j":j&&e.ctrlKey&&$(e);break;case"ArrowDown":$(e);break;case"p":case"k":j&&e.ctrlKey&&q(e);break;case"ArrowUp":q(e);break;case"Home":e.preventDefault(),L(0);break;case"End":e.preventDefault(),V();break;case"Enter":{e.preventDefault();let t=R();if(t){let e=new Event(me);t.dispatchEvent(e)}}}}},s.createElement("label",{"cmdk-label":"",htmlFor:S.inputId,id:S.labelId,style:$e},u),Ve(e,e=>s.createElement(ve.Provider,{value:k},s.createElement(fe.Provider,{value:S},e))))}),we=s.forwardRef((e,t)=>{var a,r;let n=l(),d=s.useRef(null),c=s.useContext(je),o=xe(),u=Fe(e),h=null!=(r=null==(a=u.current)?void 0:a.forceMount)?r:null==c?void 0:c.forceMount;Re(()=>{if(!h)return o.item(n,null==c?void 0:c.id)},[h]);let p=Me(n,d,[e.value,e.children,d],e.keywords),f=ge(),x=Le(e=>e.value&&e.value===p.current),v=Le(e=>!(!h&&!1!==o.filter())||(!e.search||e.filtered.items.get(n)>0));function g(){var e,t;j(),null==(t=(e=u.current).onSelect)||t.call(e,p.current)}function j(){f.setState("value",p.current,!0)}if(s.useEffect(()=>{let t=d.current;if(t&&!e.disabled)return t.addEventListener(me,g),()=>t.removeEventListener(me,g)},[v,e.onSelect,e.disabled]),!v)return null;let{disabled:y,value:w,onSelect:_,forceMount:N,keywords:b,...C}=e;return s.createElement(i.div,{ref:m(d,t),...C,id:n,"cmdk-item":"",role:"option","aria-disabled":!!y,"aria-selected":!!x,"data-disabled":!!y,"data-selected":!!x,onPointerMove:y||o.getDisablePointerSelection()?void 0:j,onClick:y?void 0:g},e.children)}),_e=s.forwardRef((e,t)=>{let{heading:a,children:r,forceMount:n,...d}=e,c=l(),o=s.useRef(null),u=s.useRef(null),h=l(),p=xe(),f=Le(e=>!(!n&&!1!==p.filter())||(!e.search||e.filtered.groups.has(c)));Re(()=>p.group(c),[]),Me(c,o,[e.value,e.heading,u]);let x=s.useMemo(()=>({id:c,forceMount:n}),[n]);return s.createElement(i.div,{ref:m(o,t),...d,"cmdk-group":"",role:"presentation",hidden:!f||void 0},a&&s.createElement("div",{ref:u,"cmdk-group-heading":"","aria-hidden":!0,id:h},a),Ve(e,e=>s.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?h:void 0},s.createElement(je.Provider,{value:x},e))))}),Ne=s.forwardRef((e,t)=>{let{alwaysRender:a,...r}=e,n=s.useRef(null),l=Le(e=>!e.search);return a||l?s.createElement(i.div,{ref:m(n,t),...r,"cmdk-separator":"",role:"separator"}):null}),be=s.forwardRef((e,t)=>{let{onValueChange:a,...r}=e,n=null!=e.value,l=ge(),d=Le(e=>e.search),c=Le(e=>e.selectedItemId),o=xe();return s.useEffect(()=>{null!=e.value&&l.setState("search",e.value)},[e.value]),s.createElement(i.input,{ref:t,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":o.listId,"aria-labelledby":o.labelId,"aria-activedescendant":c,id:o.inputId,type:"text",value:n?e.value:d,onChange:e=>{n||l.setState("search",e.target.value),null==a||a(e.target.value)}})}),Ce=s.forwardRef((e,t)=>{let{children:a,label:r="Suggestions",...n}=e,l=s.useRef(null),d=s.useRef(null),c=Le(e=>e.selectedItemId),o=xe();return s.useEffect(()=>{if(d.current&&l.current){let e,t=d.current,a=l.current,r=new ResizeObserver(()=>{e=requestAnimationFrame(()=>{let e=t.offsetHeight;a.style.setProperty("--cmdk-list-height",e.toFixed(1)+"px")})});return r.observe(t),()=>{cancelAnimationFrame(e),r.unobserve(t)}}},[]),s.createElement(i.div,{ref:m(l,t),...n,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":c,"aria-label":r,id:o.listId},Ve(e,e=>s.createElement("div",{ref:m(d,o.listInnerRef),"cmdk-list-sizer":""},e)))}),ke=s.forwardRef((e,t)=>{let{open:a,onOpenChange:r,overlayClassName:n,contentClassName:l,container:i,...m}=e;return s.createElement(d,{open:a,onOpenChange:r},s.createElement(c,{container:i},s.createElement(o,{"cmdk-overlay":"",className:n}),s.createElement(u,{"aria-label":e.label,"cmdk-dialog":"",className:l},s.createElement(ye,{ref:t,...m}))))}),Se=s.forwardRef((e,t)=>Le(e=>0===e.filtered.count)?s.createElement(i.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Ee=s.forwardRef((e,t)=>{let{progress:a,children:r,label:n="Loading...",...l}=e;return s.createElement(i.div,{ref:t,...l,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},Ve(e,e=>s.createElement("div",{"aria-hidden":!0},e)))}),Ae=Object.assign(ye,{List:Ce,Item:we,Input:be,Group:_e,Separator:Ne,Dialog:ke,Empty:Se,Loading:Ee});function Ie(e,t){let a=e.nextElementSibling;for(;a;){if(a.matches(t))return a;a=a.nextElementSibling}}function De(e,t){let a=e.previousElementSibling;for(;a;){if(a.matches(t))return a;a=a.previousElementSibling}}function Fe(e){let t=s.useRef(e);return Re(()=>{t.current=e}),t}var Re="undefined"==typeof window?s.useEffect:s.useLayoutEffect;function Pe(e){let t=s.useRef();return void 0===t.current&&(t.current=e()),t}function Le(e){let t=ge(),a=()=>e(t.snapshot());return s.useSyncExternalStore(t.subscribe,a,a)}function Me(e,t,a,r=[]){let n=s.useRef(),l=xe();return Re(()=>{var s;let i=(()=>{var e;for(let t of a){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():n.current}})(),d=r.map(e=>e.trim());l.value(e,i,d),null==(s=t.current)||s.setAttribute(he,i),n.current=i}),n}var Oe=()=>{let[e,t]=s.useState(),a=Pe(()=>new Map);return Re(()=>{a.current.forEach(e=>e()),a.current=new Map},[e]),(e,r)=>{a.current.set(e,r),t({})}};function Ve({asChild:e,children:t},a){return e&&s.isValidElement(t)?s.cloneElement(function(e){let t=e.type;return"function"==typeof t?t(e.props):"render"in t?t.render(e.props):e}(t),{ref:t.ref},a(t.props.children)):a(t)}var $e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const qe=s.forwardRef(({className:e,...t},a)=>n.jsx(Ae,{ref:a,className:r("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));qe.displayName=Ae.displayName;const We=s.forwardRef(({className:e,...t},a)=>n.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[n.jsx(B,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),n.jsx(Ae.Input,{ref:a,className:r("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));We.displayName=Ae.Input.displayName;const ze=s.forwardRef(({className:e,...t},a)=>n.jsx(Ae.List,{ref:a,className:r("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));ze.displayName=Ae.List.displayName;const Be=s.forwardRef((e,t)=>n.jsx(Ae.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));Be.displayName=Ae.Empty.displayName;const He=s.forwardRef(({className:e,...t},a)=>n.jsx(Ae.Group,{ref:a,className:r("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));He.displayName=Ae.Group.displayName;s.forwardRef(({className:e,...t},a)=>n.jsx(Ae.Separator,{ref:a,className:r("-mx-1 h-px bg-border",e),...t})).displayName=Ae.Separator.displayName;const Ke=s.forwardRef(({className:e,...t},a)=>n.jsx(Ae.Item,{ref:a,className:r("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...t}));Ke.displayName=Ae.Item.displayName;const Ze={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},Te=({onAddProduct:e,products:t})=>{const[a,r]=s.useState(null),[l,i]=s.useState(1),[d,c]=s.useState(void 0),[o,u]=s.useState(""),m=x(o,300),{data:h}=H({searchQuery:m,pageSize:100}),p=h?.data||[];s.useEffect(()=>{a&&a.weights&&a.weights.length>0?c(a.weights[0].id):c(void 0)},[a]);return n.jsxs(D,{children:[n.jsx(O,{asChild:!0,children:n.jsxs(V,{variant:"outline",className:"w-full",children:[n.jsx(Z,{className:"w-4 h-4 mr-2"}),"Add Product"]})}),n.jsxs(F,{className:"max-w-2xl",children:[n.jsxs(R,{children:[n.jsx(P,{children:"Add Product to Order"}),n.jsx(L,{children:"Search for a product and add it to the order with a specified quantity and weight."})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx("div",{children:n.jsxs(qe,{children:[n.jsx(We,{placeholder:"Search for a product...",value:o,onValueChange:u}),n.jsxs(ze,{children:[n.jsx(Be,{children:"No products found."}),n.jsx(He,{children:p.map(e=>n.jsxs(Ke,{onSelect:()=>r(e),children:[e.name_ar," (",e.name_fr,")"]},e.id))})]})]})}),a&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("img",{src:a.image||"/placeholder.svg",alt:a.name_fr,className:"w-20 h-20 rounded-md object-cover"}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold",children:a.name_ar}),n.jsx("p",{className:"text-sm text-muted-foreground",children:a.name_fr})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"quantity",children:"Quantity"}),n.jsx($,{id:"quantity",type:"number",min:"1",value:l,onChange:e=>i(parseInt(e.target.value)||1)})]}),a.weights&&a.weights.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"weight",children:"Weight"}),n.jsxs(v,{value:d,onValueChange:c,children:[n.jsx(g,{children:n.jsx(j,{placeholder:"Select weight"})}),n.jsx(y,{children:a.weights.map(e=>n.jsxs(w,{value:e.id,children:[e.weight," - ",e.price," DZD"]},e.id))})]})]}),n.jsx(V,{onClick:()=>{a&&(e(a,l,d),r(null),i(1),c(void 0),u(""))},className:"w-full",children:"Add to Order"})]})]})]})]})},Ge=({isOpen:e,onClose:r})=>{const[l,i]=s.useState({customer_name:"",customer_phone:"",wilaya_name:"",wilaya_code:0,status:"new",delivery_type:"home",send_from_store:"laghouat",total:0,subtotal:0,delivery_price:0,is_manual:!0}),[d,c]=s.useState([]),o=W(),{toast:u}=t(),{data:m}=H({pageSize:1e3}),h=m?.data||[],{data:p,isLoading:f}=S(),{data:x,isLoading:_}=E(l.wilaya_code,l.delivery_type);s.useEffect(()=>{const e=d.reduce((e,t)=>e+(t.total_price||0),0),t=x?.price??0,a=e+t;i(r=>({...r,subtotal:e,delivery_price:t,total:a}))},[d,x]);const b=e=>{const{name:t,value:a}=e.target;i(e=>({...e,[t]:a}))},C=(e,t)=>{if("wilaya_name"===e){const e=t.split(" - ");if(e.length>=2){const t=parseInt(e[0],10),a=e.slice(1).join(" - ");i(e=>({...e,wilaya_name:a,wilaya_code:t}))}}else i(a=>({...a,[e]:t}))};return n.jsx(D,{open:e,onOpenChange:r,children:n.jsxs(F,{className:"max-w-4xl",children:[n.jsxs(R,{children:[n.jsx(P,{children:"Create New Order"}),n.jsx(L,{children:"Fill in the customer information and add products to create a new order."})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 py-4 max-h-[70vh] overflow-y-auto pr-4",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"font-semibold",children:"Customer Information"}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"customer_name",children:"Customer Name"}),n.jsx($,{id:"customer_name",name:"customer_name",value:l.customer_name||"",onChange:b})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"customer_phone",children:"Customer Phone"}),n.jsx($,{id:"customer_phone",name:"customer_phone",type:"tel",value:l.customer_phone||"",onChange:e=>{const{name:t,value:a}=e.target,r=a.replace(/\D/g,"");i(e=>({...e,[t]:r}))}})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"wilaya_name",children:"Wilaya"}),n.jsxs(v,{name:"wilaya_name",value:l.wilaya_code?`${l.wilaya_code.toString().padStart(2,"0")} - ${l.wilaya_name}`:"",onValueChange:e=>C("wilaya_name",e),disabled:f,children:[n.jsx(g,{children:n.jsx(j,{placeholder:f?"Loading Wilayas...":"Select Wilaya"})}),n.jsx(y,{children:p?.map(e=>n.jsx(w,{value:e,children:e},e))})]})]}),"home"===l.delivery_type&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"address",children:"Address"}),n.jsx($,{id:"address",name:"address",value:l.address||"",onChange:b})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"delivery_type",children:"Delivery Type"}),n.jsxs(v,{name:"delivery_type",value:l.delivery_type,onValueChange:e=>C("delivery_type",e),children:[n.jsx(g,{children:n.jsx(j,{})}),n.jsx(y,{children:Object.keys(Ze).map(e=>n.jsx(w,{value:e,children:Ze[e]},e))})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"send_from_store",children:"Store"}),n.jsxs(v,{name:"send_from_store",value:l.send_from_store,onValueChange:e=>C("send_from_store",e),children:[n.jsx(g,{children:n.jsx(j,{})}),n.jsxs(y,{children:[n.jsx(w,{value:"laghouat",children:"Laghouat"}),n.jsx(w,{value:"aflou",children:"Aflou"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"notes",children:"Notes"}),n.jsx($,{id:"notes",name:"notes",value:l.notes||"",onChange:b})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"font-semibold",children:"Order Items"}),n.jsx(Te,{onAddProduct:(e,t,a)=>{let r=e.price,s=null,n=null;if(a){const t=e.weights?.find(e=>e.id===a);t&&(r=t.price,s=t.weight,n=t.id)}const l={product_id:e.id,quantity:t,unit_price:r,total_price:r*t,product_name_ar:e.name_ar,product_name_fr:e.name_fr,weight:s,product_weight_id:n};c(e=>[...e,l]),u({title:"Product Added",description:`${e.name_ar} was added to the order.`})},products:h}),n.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-2",children:[0===d.length&&n.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No products added yet."}),d.map((e,t)=>(h.find(t=>t.id===e.product_id),n.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md border",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-medium",children:e.product_name_ar}),n.jsx("p",{className:"text-sm text-muted-foreground",children:e.product_name_fr}),e.weight&&n.jsxs("p",{className:"text-xs text-muted-foreground",children:["Weight: ",e.weight]})]}),n.jsx($,{type:"number",min:"1",value:e.quantity,onChange:e=>((e,t)=>{const a=[...d],r=a[e];Object.assign(r,t),r.total_price=(r.unit_price||0)*(r.quantity||0),c(a)})(t,{quantity:parseInt(e.target.value)||1}),className:"w-20"}),n.jsxs("p",{className:"w-24 text-right",children:[e.total_price?.toLocaleString()," DZD"]}),n.jsx(V,{variant:"ghost",size:"icon",onClick:()=>(e=>{c(t=>t.filter((t,a)=>a!==e))})(t),children:n.jsx(K,{className:"w-4 h-4 text-destructive"})})]},t)))]}),d.length>0&&n.jsxs("div",{className:"pt-4 border-t space-y-2",children:[l.wilaya_name&&n.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[n.jsx("span",{children:"Wilaya"}),n.jsx("span",{children:l.wilaya_name})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Subtotal"}),n.jsxs("span",{children:[l.subtotal?.toLocaleString()," DZD"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Delivery"}),n.jsx("span",{children:_?n.jsx(a,{className:"w-4 h-4 animate-spin"}):`${l.delivery_price?.toLocaleString()} DZD`})]}),n.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[n.jsx("span",{children:"Total"}),n.jsx("span",{children:_?n.jsx(a,{className:"w-4 h-4 animate-spin"}):`${l.total?.toLocaleString()} DZD`})]})]})]})]}),n.jsx(M,{children:n.jsxs(V,{onClick:async()=>{try{if(!l.customer_name||!l.customer_phone||!l.wilaya_name||"home"===l.delivery_type&&!l.address)return void u({title:"Validation Error",description:"Please fill in all customer details.",variant:"destructive"});if(0===d.length)return void u({title:"Validation Error",description:"Please add at least one product to the order.",variant:"destructive"});const e={...l,customer_name:l.customer_name,customer_phone:l.customer_phone,wilaya_name:l.wilaya_name,items:d};await o.mutateAsync(e),u({title:"Order Created",description:`New order for ${l.customer_name} created successfully.`}),r(),c([]),i({customer_name:"",customer_phone:"",wilaya_name:"",wilaya_code:0,status:"new",delivery_type:"home",send_from_store:"laghouat",total:0,subtotal:0,delivery_price:0,is_manual:!0})}catch(e){u({title:"Creation Failed",description:"An error occurred while creating the order.",variant:"destructive"})}},disabled:o.isPending||_,className:"w-full md:w-auto",children:[o.isPending?n.jsx(a,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(z,{className:"w-4 h-4 mr-2"}),"Create Order"]})})]})})};export{Ge as C,X as E,G as F,Q as O,T as a,U as u};
