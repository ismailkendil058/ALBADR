import{j as e}from"./ui-vendor-CbTtZHsW.js";import{a as s}from"./react-vendor-1XlI0agO.js";import{u as a,b as r,c as t}from"./query-vendor-DL9dZapS.js";import{c as n,s as l,b as i,L as c}from"./index-BWpasF73.js";import{a as o,C as d}from"./card-PHeom2L9.js";import{B as m}from"./button-D-ffmNcE.js";import{I as u}from"./input-m9ePOgnC.js";import{L as p}from"./label-Cu_4ZZv9.js";import{T as h,a as x,b as g,c as y}from"./tabs-C1oEotoe.js";import{D as j,a as f,b as v,c as N,d as w}from"./dialog-DGWZHKxT.js";import{A as b,a as C,b as S,c as M,d as q,e as k,f as A,g as E}from"./alert-dialog-DJdR3Bek.js";import{P as F}from"./plus-CCAUwyXe.js";import{U as P}from"./users-BYzRP1wH.js";import{U as L}from"./user-D-Czru7T.js";import{P as K}from"./phone-CN7aDeEm.js";import{T as z}from"./trash-2-B78Q9GXL.js";const Q=n("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),_=n("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),D=n("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const T=()=>{const{employees:n,isLoading:T,createEmployee:U,updateEmployee:$,deleteEmployee:I}=function(){const e=a(),s=r({queryKey:["employees"],queryFn:async()=>{const{data:e,error:s}=await l.from("employees").select("*").order("created_at",{ascending:!1});if(s)throw s;return e}}),n=t({mutationFn:async e=>{const{data:s,error:a}=await l.from("employees").insert([e]).select().single();if(a)throw a;return s},onSuccess:()=>{e.invalidateQueries({queryKey:["employees"]})}}),i=t({mutationFn:async({id:e,...s})=>{const{data:a,error:r}=await l.from("employees").update(s).eq("id",e).select().single();if(r)throw r;return a},onSuccess:()=>{e.invalidateQueries({queryKey:["employees"]})}}),c=t({mutationFn:async e=>{const{error:s}=await l.from("employees").delete().eq("id",e);if(s)throw s;return e},onSuccess:()=>{e.invalidateQueries({queryKey:["employees"]})}});return{employees:s.data??[],isLoading:s.isLoading,error:s.error,createEmployee:n,updateEmployee:i,deleteEmployee:c}}(),{managers:O,isLoading:V,createManager:B,updateManager:G,deleteManager:J}=function(){const e=a(),s=r({queryKey:["managers"],queryFn:async()=>{try{const{data:e,error:s}=await l.from("managers").select("*").order("created_at",{ascending:!1});if(s)throw s;return e}catch(e){throw e}}}),n=t({mutationFn:async e=>{const{data:s,error:a}=await l.from("managers").insert([e]).select().single();if(a)throw a;return s},onSuccess:()=>{e.invalidateQueries({queryKey:["managers"]})}}),i=t({mutationFn:async({id:e,...s})=>{const{data:a,error:r}=await l.from("managers").update(s).eq("id",e).select().single();if(r)throw r;return a},onSuccess:()=>{e.invalidateQueries({queryKey:["managers"]})}}),c=t({mutationFn:async e=>{const{error:s}=await l.from("managers").delete().eq("id",e);if(s)throw s;return e},onSuccess:()=>{e.invalidateQueries({queryKey:["managers"]})}});return{managers:s.data??[],isLoading:s.isLoading,error:s.error,createManager:n,updateManager:i,deleteManager:c}}(),{toast:H}=i(),[R,W]=s.useState(!1),[X,Y]=s.useState(!1),[Z,ee]=s.useState(null),[se,ae]=s.useState("employee"),[re,te]=s.useState("employee"),[ne,le]=s.useState({name:"",phone:"",password:""}),ie=T||V,ce=n,oe=O,de=e=>{ae(e),ee(null),le({name:"",phone:"",password:""}),W(!0)},me=({user:s,type:a})=>e.jsx(o,{className:"hover:shadow-md transition-shadow",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-3 rounded-full "+("manager"===a?"bg-purple-100":"bg-primary/10"),children:e.jsx(D,{className:"w-6 h-6 "+("manager"===a?"text-purple-600":"text-primary")})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>((e,s)=>{ae(s),ee(e),le({name:e.name,phone:e.phone,password:e.password||""}),W(!0)})(s,a),children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{ae(a),ee(s),Y(!0)},children:e.jsx(z,{className:"w-4 h-4"})})]})]}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:s.name}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-3.5 h-3.5"})," ",s.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-3.5 h-3.5"})," ",s.password?"••••••••":"No password"]})]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Access Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee and manager accounts and dashboard access"})]}),e.jsxs(h,{value:re,onValueChange:te,className:"w-full",children:[e.jsxs(x,{className:"grid w-full grid-cols-2",children:[e.jsx(g,{value:"employee",children:"Employees"}),e.jsx(g,{value:"manager",children:"Managers"})]}),e.jsxs(y,{value:"employee",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Employee Accounts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage warehouse and delivery staff"})]}),e.jsxs(m,{onClick:()=>de("employee"),className:"gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," Add Employee"]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ie?Array.from({length:3}).map((s,a)=>e.jsx(o,{className:"animate-pulse",children:e.jsx(d,{className:"p-6 h-32 bg-muted/20"})},a)):ce.length>0?ce.map(s=>e.jsx(me,{user:s,type:"employee"},s.id)):e.jsxs("div",{className:"col-span-full py-20 text-center bg-muted/20 rounded-xl border-2 border-dashed",children:[e.jsx(P,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4 opacity-20"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No employee accounts created yet"}),e.jsx(m,{variant:"outline",className:"mt-4",onClick:()=>de("employee"),children:"Create your first employee"})]})})]}),e.jsxs(y,{value:"manager",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Manager Accounts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage manager dashboard access"})]}),e.jsxs(m,{onClick:()=>de("manager"),className:"gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," Create Manager"]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ie?Array.from({length:3}).map((s,a)=>e.jsx(o,{className:"animate-pulse",children:e.jsx(d,{className:"p-6 h-32 bg-muted/20"})},a)):oe.length>0?oe.map(s=>e.jsx(me,{user:s,type:"manager"},s.id)):e.jsxs("div",{className:"col-span-full py-20 text-center bg-muted/20 rounded-xl border-2 border-dashed",children:[e.jsx(P,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4 opacity-20"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No manager accounts created yet"}),e.jsx(m,{variant:"outline",className:"mt-4",onClick:()=>de("manager"),children:"Create your first manager"})]})})]})]}),e.jsx(j,{open:R,onOpenChange:W,children:e.jsxs(f,{className:"sm:max-w-[425px]",children:[e.jsx(v,{children:e.jsx(N,{children:Z?"Edit "+("manager"===se?"Manager":"Employee"):`New ${"manager"===se?"Manager":"Employee"} Account`})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{"manager"===se?Z?(await G.mutateAsync({id:Z.id,name:ne.name,phone:ne.phone,password:ne.password,is_active:!("is_active"in Z)||Z.is_active}),H({title:"Success",description:"Manager updated successfully."})):(await B.mutateAsync({name:ne.name,phone:ne.phone,password:ne.password,is_active:!0}),H({title:"Success",description:"Manager created successfully."})):Z?(await $.mutateAsync({id:Z.id,name:ne.name,phone:ne.phone,password:ne.password}),H({title:"Success",description:"Employee updated successfully."})):(await U.mutateAsync({name:ne.name,phone:ne.phone,password:ne.password}),H({title:"Success",description:"Employee created successfully."})),W(!1)}catch(s){H({title:"Error",description:s.message||`Failed to save ${se}.`,variant:"destructive"})}},className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"name",value:ne.name,onChange:e=>le({...ne,name:e.target.value}),placeholder:"Name",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"phone",value:ne.phone,onChange:e=>le({...ne,phone:e.target.value}),placeholder:"0xxxxxxxxx",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"password",children:"Login Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"password",type:"text",value:ne.password,onChange:e=>le({...ne,password:e.target.value}),placeholder:"Set password",className:"pl-10",required:!0})]})]}),e.jsxs(w,{className:"pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsxs(m,{type:"submit",disabled:U.isPending||$.isPending||B.isPending||G.isPending,children:[(U.isPending||$.isPending||B.isPending||G.isPending)&&e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}),Z?"Save Changes":"Create Account"]})]})]})]})}),e.jsx(b,{open:X,onOpenChange:Y,children:e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(M,{children:"Are you sure?"}),e.jsxs(q,{children:["This will permanently delete the account for ",e.jsx("strong",{children:Z?.name}),". They will lose access to the ","manager"===se?"manager":"employee"," dashboard immediately."]})]}),e.jsxs(k,{children:[e.jsx(A,{children:"Cancel"}),e.jsx(E,{onClick:async()=>{if(Z)try{"manager"===se?await J.mutateAsync(Z.id):await I.mutateAsync(Z.id),H({title:"Success",description:("manager"===se?"Manager":"Employee")+" deleted successfully."}),Y(!1)}catch(e){H({title:"Error",description:e.message||`Failed to delete ${se}.`,variant:"destructive"})}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Account"})]})]})})]})};export{T as default};
