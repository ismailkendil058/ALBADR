import{c as ge,r as n,j as e,e as Ae,a as ce,P as T,w as ae,i as G}from"./index-CzubCIAQ.js";import{a as Xe,C as Ye}from"./card-laboSzSy.js";import{C as et,u as tt}from"./use-debounce-gqjLm0b-.js";import{S as L,a as $,b as V,c as W,d as O}from"./select-BP9hra2E.js";import{B as at}from"./badge-Bi3gZxY0.js";import{L as k}from"./label-DyR_ZUp8.js";import{T as rt}from"./truck-C6lO2hhn.js";import{B as st}from"./building-2-CJMCjh2e.js";import{S as nt,u as lt,e as it}from"./useTariffs-D_sTwP4q.js";import{f as ct}from"./format-CuvDg6tx.js";import{p as ot}from"./date-range-picker-CzKR9nwd.js";import{D as ye,a as je,b as we,c as _e,R as dt,P as ut,O as mt,C as ht,i as Oe,d as pt,j as ft}from"./dialog-DaqzuSbj.js";import{B as re}from"./button-mNsHMIkq.js";import{I as A}from"./input-ahHenGQ4.js";import{l as xt,u as vt}from"./useOrders-BOqVdsRA.js";import{S as Me}from"./save-CEUlqW7q.js";import{u as U}from"./Combination-Cz0VTwcJ.js";import{S as gt}from"./search-Dw77sz4D.js";import{d as Le}from"./useProducts-C81J7_oK.js";import{T as yt}from"./trash-2-CCtYTIZv.js";const jt=ge("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);const ha=ge("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);const pa=ge("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),me=768;function fa(){const[t,s]=n.useState(void 0);return n.useEffect(()=>{const a=window.matchMedia(`(max-width: ${me-1}px)`),i=()=>{s(window.innerWidth<me)};return a.addEventListener("change",i),s(window.innerWidth<me),()=>a.removeEventListener("change",i)},[]),!!t}const xa=({order:t,isSelected:s,onSelect:a,onViewDetails:i,onStatusChange:l,statusLabels:c,statusColors:h,deliveryLabels:p})=>e.jsx(Xe,{className:`mb-4 ${t.is_manual?"bg-red-50/50":""}`,children:e.jsxs(Ye,{className:"p-4 space-y-3 cursor-pointer",onClick:()=>i(t),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",onClick:v=>v.stopPropagation(),children:[e.jsx(et,{checked:s,onCheckedChange:()=>a(t.id)}),e.jsxs("span",{className:"font-mono text-sm font-semibold",children:["#",t.order_number]})]}),e.jsx(at,{className:`text-xs ${h[t.status]}`,children:c[t.status]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-2 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(k,{className:"text-muted-foreground",children:"Customer"}),e.jsx("p",{className:"font-medium",children:t.customer_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.customer_phone})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(k,{className:"text-muted-foreground",children:"Total"}),e.jsxs("p",{className:"font-semibold",children:[t.total.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(k,{className:"text-muted-foreground",children:"Delivery"}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.delivery_type==="home"&&e.jsx(rt,{className:"w-4 h-4"}),t.delivery_type==="bureau"&&e.jsx(st,{className:"w-4 h-4"}),t.delivery_type==="pickup"&&e.jsx(nt,{className:"w-4 h-4"}),e.jsx("span",{children:p[t.delivery_type]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(k,{className:"text-muted-foreground",children:"Store"}),e.jsx("p",{className:"capitalize",children:t.send_from_store})]}),e.jsxs("div",{className:"space-y-1 col-span-2",children:[e.jsx(k,{className:"text-muted-foreground",children:"Date"}),e.jsx("p",{className:"text-xs",children:ct(ot(t.created_at),"dd/MM/yyyy HH:mm")})]})]}),e.jsx("div",{className:"flex justify-between items-center pt-3 border-t",children:e.jsxs(L,{value:t.status,onValueChange:v=>l(t.id,v),onClick:v=>v.stopPropagation(),children:[e.jsx($,{className:`w-[120px] h-8 text-xs border ${h[t.status]}`,children:e.jsx(V,{})}),e.jsx(W,{children:Object.keys(c).map(v=>e.jsx(O,{value:v,children:c[v]},v))})]})})]})}),Ee=[{code:1,name:"أدرار"},{code:2,name:"الشلف"},{code:3,name:"الأغواط"},{code:4,name:"أم البواقي"},{code:5,name:"باتنة"},{code:6,name:"بجاية"},{code:7,name:"بسكرة"},{code:8,name:"بشار"},{code:9,name:"البليدة"},{code:10,name:"البويرة"},{code:11,name:"تمنراست"},{code:12,name:"تبسة"},{code:13,name:"تلمسان"},{code:14,name:"تيارت"},{code:15,name:"تيزي وزو"},{code:16,name:"الجزائر"},{code:17,name:"الجلفة"},{code:18,name:"جيجل"},{code:19,name:"سطيف"},{code:20,name:"سعيدة"},{code:21,name:"سكيكدة"},{code:22,name:"سيدي بلعباس"},{code:23,name:"عنابة"},{code:24,name:"قالمة"},{code:25,name:"قسنطينة"},{code:26,name:"المدية"},{code:27,name:"مستغانم"},{code:28,name:"المسيلة"},{code:29,name:"معسكر"},{code:30,name:"ورقلة"},{code:31,name:"وهران"},{code:32,name:"البيض"},{code:33,name:"إليزي"},{code:34,name:"برج بوعريريج"},{code:35,name:"بومرداس"},{code:36,name:"الطارف"},{code:37,name:"تندوف"},{code:38,name:"تيسمسيلت"},{code:39,name:"الوادي"},{code:40,name:"خنشلة"},{code:41,name:"سوق أهراس"},{code:42,name:"تيبازة"},{code:43,name:"ميلة"},{code:44,name:"عين الدفلى"},{code:45,name:"النعامة"},{code:46,name:"عين تموشنت"},{code:47,name:"غرداية"},{code:48,name:"غليزان"},{code:49,name:"المنيعة"},{code:50,name:"المغير"},{code:51,name:"أولاد جلال"},{code:52,name:"برج باجي مختار"},{code:53,name:"بني عباس"},{code:54,name:"تيميمون"},{code:55,name:"توقرت"},{code:56,name:"جانت"},{code:57,name:"عين صالح"},{code:58,name:"عين قزام"}],De={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},va=({order:t,isOpen:s,onClose:a})=>{const[i,l]=n.useState({}),c=xt(),{toast:h}=Ae();n.useEffect(()=>{t&&l({customer_name:t.customer_name,customer_phone:t.customer_phone,wilaya_name:t.wilaya_name,wilaya_code:t.wilaya_code,address:t.address,delivery_type:t.delivery_type,send_from_store:t.send_from_store,notes:t.notes,total:t.total,subtotal:t.subtotal,delivery_price:t.delivery_price})},[t]);const p=m=>{const{name:y,value:_}=m.target;l(S=>({...S,[y]:_}))},v=(m,y)=>{l(_=>({..._,[m]:y}))},d=async()=>{if(!(!t||!t.id))try{await c.mutateAsync({id:t.id,data:i}),h({title:"Order Updated",description:`Order ${t.order_number} has been updated.`}),a()}catch(m){console.error("Failed to update order:",m),h({title:"Update Failed",description:"An error occurred while updating the order.",variant:"destructive"})}};return e.jsx(ye,{open:s,onOpenChange:a,children:e.jsxs(je,{className:"sm:max-w-[425px]",children:[e.jsx(we,{children:e.jsxs(_e,{children:["Edit Order ",t?.order_number]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"customer_name",className:"text-right",children:"Customer Name"}),e.jsx(A,{id:"customer_name",name:"customer_name",value:i.customer_name||"",onChange:p,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"customer_phone",className:"text-right",children:"Customer Phone"}),e.jsx(A,{id:"customer_phone",name:"customer_phone",value:i.customer_phone||"",onChange:p,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"wilaya_name",className:"text-right",children:"Wilaya"}),e.jsxs(L,{name:"wilaya_name",value:i.wilaya_name||"",onValueChange:m=>{const y=Ee.find(_=>_.name===m);y&&l(_=>({..._,wilaya_name:y.name,wilaya_code:y.code}))},children:[e.jsx($,{className:"col-span-3",children:e.jsx(V,{placeholder:"Select Wilaya"})}),e.jsx(W,{children:Ee.map(m=>e.jsx(O,{value:m.name,children:m.name},m.code))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(A,{id:"address",name:"address",value:i.address||"",onChange:p,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"delivery_type",className:"text-right",children:"Delivery Type"}),e.jsxs(L,{name:"delivery_type",value:i.delivery_type||"",onValueChange:m=>v("delivery_type",m),children:[e.jsx($,{className:"col-span-3",children:e.jsx(V,{placeholder:"Select delivery type"})}),e.jsx(W,{children:Object.keys(De).map(m=>e.jsx(O,{value:m,children:De[m]},m))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"send_from_store",className:"text-right",children:"Store"}),e.jsxs(L,{name:"send_from_store",value:i.send_from_store||"",onValueChange:m=>v("send_from_store",m),children:[e.jsx($,{className:"col-span-3",children:e.jsx(V,{placeholder:"Select store"})}),e.jsxs(W,{children:[e.jsx(O,{value:"laghouat",children:"Laghouat"}),e.jsx(O,{value:"aflou",children:"Aflou"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(k,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx(A,{id:"notes",name:"notes",value:i.notes||"",onChange:p,className:"col-span-3"})]})]}),e.jsxs(re,{onClick:d,disabled:c.isPending,children:[c.isPending?e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Save changes"]})]})})};var Ie=1,wt=.9,_t=.8,bt=.17,he=.1,pe=.999,Nt=.9999,Ct=.99,St=/[\\\/_+.#"@\[\(\{&]/,kt=/[\\\/_+.#"@\[\(\{&]/g,Et=/[\s-]/,$e=/[\s-]/g;function xe(t,s,a,i,l,c,h){if(c===s.length)return l===t.length?Ie:Ct;var p=`${l},${c}`;if(h[p]!==void 0)return h[p];for(var v=i.charAt(c),d=a.indexOf(v,l),m=0,y,_,S,b;d>=0;)y=xe(t,s,a,i,d+1,c+1,h),y>m&&(d===l?y*=Ie:St.test(t.charAt(d-1))?(y*=_t,S=t.slice(l,d-1).match(kt),S&&l>0&&(y*=Math.pow(pe,S.length))):Et.test(t.charAt(d-1))?(y*=wt,b=t.slice(l,d-1).match($e),b&&l>0&&(y*=Math.pow(pe,b.length))):(y*=bt,l>0&&(y*=Math.pow(pe,d-l))),t.charAt(d)!==s.charAt(c)&&(y*=Nt)),(y<he&&a.charAt(d-1)===i.charAt(c+1)||i.charAt(c+1)===i.charAt(c)&&a.charAt(d-1)!==i.charAt(c))&&(_=xe(t,s,a,i,d+1,c+2,h),_*he>y&&(y=_*he)),y>m&&(m=y),d=a.indexOf(v,d+1);return h[p]=m,m}function Re(t){return t.toLowerCase().replace($e," ")}function Dt(t,s,a){return t=a&&a.length>0?`${t+" "+a.join(" ")}`:t,xe(t,s,Re(t),Re(s),0,0,{})}var te='[cmdk-group=""]',fe='[cmdk-group-items=""]',It='[cmdk-group-heading=""]',Ve='[cmdk-item=""]',Pe=`${Ve}:not([aria-disabled="true"])`,ve="cmdk-item-select",H="data-value",Rt=(t,s,a)=>Dt(t,s,a),We=n.createContext(void 0),se=()=>n.useContext(We),qe=n.createContext(void 0),be=()=>n.useContext(qe),Te=n.createContext(void 0),Be=n.forwardRef((t,s)=>{let a=Z(()=>{var r,x;return{search:"",value:(x=(r=t.value)!=null?r:t.defaultValue)!=null?x:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),i=Z(()=>new Set),l=Z(()=>new Map),c=Z(()=>new Map),h=Z(()=>new Set),p=Ke(t),{label:v,children:d,value:m,onValueChange:y,filter:_,shouldFilter:S,loop:b,disablePointerSelection:Q=!1,vimBindings:R=!0,...K}=t,J=U(),ne=U(),X=U(),o=n.useRef(null),f=Tt();B(()=>{if(m!==void 0){let r=m.trim();a.current.value=r,g.emit()}},[m]),B(()=>{f(6,le)},[]);let g=n.useMemo(()=>({subscribe:r=>(h.current.add(r),()=>h.current.delete(r)),snapshot:()=>a.current,setState:(r,x,j)=>{var u,w,C,I;if(!Object.is(a.current[r],x)){if(a.current[r]=x,r==="search")F(),M(),f(1,Y);else if(r==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let E=document.getElementById(X);E?E.focus():(u=document.getElementById(J))==null||u.focus()}if(f(7,()=>{var E;a.current.selectedItemId=(E=z())==null?void 0:E.id,g.emit()}),j||f(5,le),((w=p.current)==null?void 0:w.value)!==void 0){let E=x??"";(I=(C=p.current).onValueChange)==null||I.call(C,E);return}}g.emit()}},emit:()=>{h.current.forEach(r=>r())}}),[]),N=n.useMemo(()=>({value:(r,x,j)=>{var u;x!==((u=c.current.get(r))==null?void 0:u.value)&&(c.current.set(r,{value:x,keywords:j}),a.current.filtered.items.set(r,P(x,j)),f(2,()=>{M(),g.emit()}))},item:(r,x)=>(i.current.add(r),x&&(l.current.has(x)?l.current.get(x).add(r):l.current.set(x,new Set([r]))),f(3,()=>{F(),M(),a.current.value||Y(),g.emit()}),()=>{c.current.delete(r),i.current.delete(r),a.current.filtered.items.delete(r);let j=z();f(4,()=>{F(),j?.getAttribute("id")===r&&Y(),g.emit()})}),group:r=>(l.current.has(r)||l.current.set(r,new Set),()=>{c.current.delete(r),l.current.delete(r)}),filter:()=>p.current.shouldFilter,label:v||t["aria-label"],getDisablePointerSelection:()=>p.current.disablePointerSelection,listId:J,inputId:X,labelId:ne,listInnerRef:o}),[]);function P(r,x){var j,u;let w=(u=(j=p.current)==null?void 0:j.filter)!=null?u:Rt;return r?w(r,a.current.search,x):0}function M(){if(!a.current.search||p.current.shouldFilter===!1)return;let r=a.current.filtered.items,x=[];a.current.filtered.groups.forEach(u=>{let w=l.current.get(u),C=0;w.forEach(I=>{let E=r.get(I);C=Math.max(E,C)}),x.push([u,C])});let j=o.current;ee().sort((u,w)=>{var C,I;let E=u.getAttribute("id"),ie=w.getAttribute("id");return((C=r.get(ie))!=null?C:0)-((I=r.get(E))!=null?I:0)}).forEach(u=>{let w=u.closest(fe);w?w.appendChild(u.parentElement===w?u:u.closest(`${fe} > *`)):j.appendChild(u.parentElement===j?u:u.closest(`${fe} > *`))}),x.sort((u,w)=>w[1]-u[1]).forEach(u=>{var w;let C=(w=o.current)==null?void 0:w.querySelector(`${te}[${H}="${encodeURIComponent(u[0])}"]`);C?.parentElement.appendChild(C)})}function Y(){let r=ee().find(j=>j.getAttribute("aria-disabled")!=="true"),x=r?.getAttribute(H);g.setState("value",x||void 0)}function F(){var r,x,j,u;if(!a.current.search||p.current.shouldFilter===!1){a.current.filtered.count=i.current.size;return}a.current.filtered.groups=new Set;let w=0;for(let C of i.current){let I=(x=(r=c.current.get(C))==null?void 0:r.value)!=null?x:"",E=(u=(j=c.current.get(C))==null?void 0:j.keywords)!=null?u:[],ie=P(I,E);a.current.filtered.items.set(C,ie),ie>0&&w++}for(let[C,I]of l.current)for(let E of I)if(a.current.filtered.items.get(E)>0){a.current.filtered.groups.add(C);break}a.current.filtered.count=w}function le(){var r,x,j;let u=z();u&&(((r=u.parentElement)==null?void 0:r.firstChild)===u&&((j=(x=u.closest(te))==null?void 0:x.querySelector(It))==null||j.scrollIntoView({block:"nearest"})),u.scrollIntoView({block:"nearest"}))}function z(){var r;return(r=o.current)==null?void 0:r.querySelector(`${Ve}[aria-selected="true"]`)}function ee(){var r;return Array.from(((r=o.current)==null?void 0:r.querySelectorAll(Pe))||[])}function de(r){let x=ee()[r];x&&g.setState("value",x.getAttribute(H))}function ue(r){var x;let j=z(),u=ee(),w=u.findIndex(I=>I===j),C=u[w+r];(x=p.current)!=null&&x.loop&&(C=w+r<0?u[u.length-1]:w+r===u.length?u[0]:u[w+r]),C&&g.setState("value",C.getAttribute(H))}function Ne(r){let x=z(),j=x?.closest(te),u;for(;j&&!u;)j=r>0?Wt(j,te):qt(j,te),u=j?.querySelector(Pe);u?g.setState("value",u.getAttribute(H)):ue(r)}let Ce=()=>de(ee().length-1),Se=r=>{r.preventDefault(),r.metaKey?Ce():r.altKey?Ne(1):ue(1)},ke=r=>{r.preventDefault(),r.metaKey?de(0):r.altKey?Ne(-1):ue(-1)};return n.createElement(T.div,{ref:s,tabIndex:-1,...K,"cmdk-root":"",onKeyDown:r=>{var x;(x=K.onKeyDown)==null||x.call(K,r);let j=r.nativeEvent.isComposing||r.keyCode===229;if(!(r.defaultPrevented||j))switch(r.key){case"n":case"j":{R&&r.ctrlKey&&Se(r);break}case"ArrowDown":{Se(r);break}case"p":case"k":{R&&r.ctrlKey&&ke(r);break}case"ArrowUp":{ke(r);break}case"Home":{r.preventDefault(),de(0);break}case"End":{r.preventDefault(),Ce();break}case"Enter":{r.preventDefault();let u=z();if(u){let w=new Event(ve);u.dispatchEvent(w)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:N.inputId,id:N.labelId,style:Kt},v),oe(t,r=>n.createElement(qe.Provider,{value:g},n.createElement(We.Provider,{value:N},r))))}),Pt=n.forwardRef((t,s)=>{var a,i;let l=U(),c=n.useRef(null),h=n.useContext(Te),p=se(),v=Ke(t),d=(i=(a=v.current)==null?void 0:a.forceMount)!=null?i:h?.forceMount;B(()=>{if(!d)return p.item(l,h?.id)},[d]);let m=ze(l,c,[t.value,t.children,c],t.keywords),y=be(),_=q(f=>f.value&&f.value===m.current),S=q(f=>d||p.filter()===!1?!0:f.search?f.filtered.items.get(l)>0:!0);n.useEffect(()=>{let f=c.current;if(!(!f||t.disabled))return f.addEventListener(ve,b),()=>f.removeEventListener(ve,b)},[S,t.onSelect,t.disabled]);function b(){var f,g;Q(),(g=(f=v.current).onSelect)==null||g.call(f,m.current)}function Q(){y.setState("value",m.current,!0)}if(!S)return null;let{disabled:R,value:K,onSelect:J,forceMount:ne,keywords:X,...o}=t;return n.createElement(T.div,{ref:ae(c,s),...o,id:l,"cmdk-item":"",role:"option","aria-disabled":!!R,"aria-selected":!!_,"data-disabled":!!R,"data-selected":!!_,onPointerMove:R||p.getDisablePointerSelection()?void 0:Q,onClick:R?void 0:b},t.children)}),Ft=n.forwardRef((t,s)=>{let{heading:a,children:i,forceMount:l,...c}=t,h=U(),p=n.useRef(null),v=n.useRef(null),d=U(),m=se(),y=q(S=>l||m.filter()===!1?!0:S.search?S.filtered.groups.has(h):!0);B(()=>m.group(h),[]),ze(h,p,[t.value,t.heading,v]);let _=n.useMemo(()=>({id:h,forceMount:l}),[l]);return n.createElement(T.div,{ref:ae(p,s),...c,"cmdk-group":"",role:"presentation",hidden:y?void 0:!0},a&&n.createElement("div",{ref:v,"cmdk-group-heading":"","aria-hidden":!0,id:d},a),oe(t,S=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?d:void 0},n.createElement(Te.Provider,{value:_},S))))}),At=n.forwardRef((t,s)=>{let{alwaysRender:a,...i}=t,l=n.useRef(null),c=q(h=>!h.search);return!a&&!c?null:n.createElement(T.div,{ref:ae(l,s),...i,"cmdk-separator":"",role:"separator"})}),Ot=n.forwardRef((t,s)=>{let{onValueChange:a,...i}=t,l=t.value!=null,c=be(),h=q(d=>d.search),p=q(d=>d.selectedItemId),v=se();return n.useEffect(()=>{t.value!=null&&c.setState("search",t.value)},[t.value]),n.createElement(T.input,{ref:s,...i,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":v.listId,"aria-labelledby":v.labelId,"aria-activedescendant":p,id:v.inputId,type:"text",value:l?t.value:h,onChange:d=>{l||c.setState("search",d.target.value),a?.(d.target.value)}})}),Mt=n.forwardRef((t,s)=>{let{children:a,label:i="Suggestions",...l}=t,c=n.useRef(null),h=n.useRef(null),p=q(d=>d.selectedItemId),v=se();return n.useEffect(()=>{if(h.current&&c.current){let d=h.current,m=c.current,y,_=new ResizeObserver(()=>{y=requestAnimationFrame(()=>{let S=d.offsetHeight;m.style.setProperty("--cmdk-list-height",S.toFixed(1)+"px")})});return _.observe(d),()=>{cancelAnimationFrame(y),_.unobserve(d)}}},[]),n.createElement(T.div,{ref:ae(c,s),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":p,"aria-label":i,id:v.listId},oe(t,d=>n.createElement("div",{ref:ae(h,v.listInnerRef),"cmdk-list-sizer":""},d)))}),Lt=n.forwardRef((t,s)=>{let{open:a,onOpenChange:i,overlayClassName:l,contentClassName:c,container:h,...p}=t;return n.createElement(dt,{open:a,onOpenChange:i},n.createElement(ut,{container:h},n.createElement(mt,{"cmdk-overlay":"",className:l}),n.createElement(ht,{"aria-label":t.label,"cmdk-dialog":"",className:c},n.createElement(Be,{ref:s,...p}))))}),$t=n.forwardRef((t,s)=>q(a=>a.filtered.count===0)?n.createElement(T.div,{ref:s,...t,"cmdk-empty":"",role:"presentation"}):null),Vt=n.forwardRef((t,s)=>{let{progress:a,children:i,label:l="Loading...",...c}=t;return n.createElement(T.div,{ref:s,...c,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},oe(t,h=>n.createElement("div",{"aria-hidden":!0},h)))}),D=Object.assign(Be,{List:Mt,Item:Pt,Input:Ot,Group:Ft,Separator:At,Dialog:Lt,Empty:$t,Loading:Vt});function Wt(t,s){let a=t.nextElementSibling;for(;a;){if(a.matches(s))return a;a=a.nextElementSibling}}function qt(t,s){let a=t.previousElementSibling;for(;a;){if(a.matches(s))return a;a=a.previousElementSibling}}function Ke(t){let s=n.useRef(t);return B(()=>{s.current=t}),s}var B=typeof window>"u"?n.useEffect:n.useLayoutEffect;function Z(t){let s=n.useRef();return s.current===void 0&&(s.current=t()),s}function q(t){let s=be(),a=()=>t(s.snapshot());return n.useSyncExternalStore(s.subscribe,a,a)}function ze(t,s,a,i=[]){let l=n.useRef(),c=se();return B(()=>{var h;let p=(()=>{var d;for(let m of a){if(typeof m=="string")return m.trim();if(typeof m=="object"&&"current"in m)return m.current?(d=m.current.textContent)==null?void 0:d.trim():l.current}})(),v=i.map(d=>d.trim());c.value(t,p,v),(h=s.current)==null||h.setAttribute(H,p),l.current=p}),l}var Tt=()=>{let[t,s]=n.useState(),a=Z(()=>new Map);return B(()=>{a.current.forEach(i=>i()),a.current=new Map},[t]),(i,l)=>{a.current.set(i,l),s({})}};function Bt(t){let s=t.type;return typeof s=="function"?s(t.props):"render"in s?s.render(t.props):t}function oe({asChild:t,children:s},a){return t&&n.isValidElement(s)?n.cloneElement(Bt(s),{ref:s.ref},a(s.props.children)):a(s)}var Kt={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const He=n.forwardRef(({className:t,...s},a)=>e.jsx(D,{ref:a,className:G("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...s}));He.displayName=D.displayName;const Ze=n.forwardRef(({className:t,...s},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(gt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(D.Input,{ref:a,className:G("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...s})]}));Ze.displayName=D.Input.displayName;const Ue=n.forwardRef(({className:t,...s},a)=>e.jsx(D.List,{ref:a,className:G("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...s}));Ue.displayName=D.List.displayName;const Ge=n.forwardRef((t,s)=>e.jsx(D.Empty,{ref:s,className:"py-6 text-center text-sm",...t}));Ge.displayName=D.Empty.displayName;const Qe=n.forwardRef(({className:t,...s},a)=>e.jsx(D.Group,{ref:a,className:G("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...s}));Qe.displayName=D.Group.displayName;const zt=n.forwardRef(({className:t,...s},a)=>e.jsx(D.Separator,{ref:a,className:G("-mx-1 h-px bg-border",t),...s}));zt.displayName=D.Separator.displayName;const Je=n.forwardRef(({className:t,...s},a)=>e.jsx(D.Item,{ref:a,className:G("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...s}));Je.displayName=D.Item.displayName;const Fe={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},Ht=({onAddProduct:t,products:s})=>{const[a,i]=n.useState(null),[l,c]=n.useState(1),[h,p]=n.useState(void 0),[v,d]=n.useState(""),m=tt(v,300),{data:y}=Le({searchQuery:m,pageSize:100}),_=y?.data||[];n.useEffect(()=>{a&&a.weights&&a.weights.length>0?p(a.weights[0].id):p(void 0)},[a]);const S=()=>{a&&(t(a,l,h),i(null),c(1),p(void 0),d(""))};return e.jsxs(ye,{children:[e.jsx(ft,{asChild:!0,children:e.jsxs(re,{variant:"outline",className:"w-full",children:[e.jsx(jt,{className:"w-4 h-4 mr-2"}),"Add Product"]})}),e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(we,{children:[e.jsx(_e,{children:"Add Product to Order"}),e.jsx(Oe,{children:"Search for a product and add it to the order with a specified quantity and weight."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsxs(He,{children:[e.jsx(Ze,{placeholder:"Search for a product...",value:v,onValueChange:d}),e.jsxs(Ue,{children:[e.jsx(Ge,{children:"No products found."}),e.jsx(Qe,{children:_.map(b=>e.jsxs(Je,{onSelect:()=>i(b),children:[b.name_ar," (",b.name_fr,")"]},b.id))})]})]})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:a.image||"/placeholder.svg",alt:a.name_fr,className:"w-20 h-20 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.name_ar}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.name_fr})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"quantity",children:"Quantity"}),e.jsx(A,{id:"quantity",type:"number",min:"1",value:l,onChange:b=>c(parseInt(b.target.value)||1)})]}),a.weights&&a.weights.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"weight",children:"Weight"}),e.jsxs(L,{value:h,onValueChange:p,children:[e.jsx($,{children:e.jsx(V,{placeholder:"Select weight"})}),e.jsx(W,{children:a.weights.map(b=>e.jsxs(O,{value:b.id,children:[b.weight," - ",b.price," DZD"]},b.id))})]})]}),e.jsx(re,{onClick:S,className:"w-full",children:"Add to Order"})]})]})]})]})},ga=({isOpen:t,onClose:s})=>{const[a,i]=n.useState({customer_name:"",customer_phone:"",wilaya_name:"",wilaya_code:0,status:"new",delivery_type:"home",send_from_store:"laghouat",total:0,subtotal:0,delivery_price:0,is_manual:!0}),[l,c]=n.useState([]),h=vt(),{toast:p}=Ae(),{data:v}=Le({pageSize:1e3}),d=v?.data||[],{data:m,isLoading:y}=lt(),{data:_,isLoading:S}=it(a.wilaya_code,a.delivery_type);n.useEffect(()=>{const o=l.reduce((N,P)=>N+(P.total_price||0),0),f=_?.price??0,g=o+f;i(N=>({...N,subtotal:o,delivery_price:f,total:g}))},[l,_]);const b=o=>{const{name:f,value:g}=o.target;i(N=>({...N,[f]:g}))},Q=o=>{const{name:f,value:g}=o.target,N=g.replace(/\D/g,"");i(P=>({...P,[f]:N}))},R=(o,f)=>{if(o==="wilaya_name"){const g=f.split(" - ");if(g.length>=2){const N=parseInt(g[0],10),P=g.slice(1).join(" - ");i(M=>({...M,wilaya_name:P,wilaya_code:N}))}}else i(g=>({...g,[o]:f}))},K=(o,f,g)=>{let N=o.price,P=null,M=null;if(g){const F=o.weights?.find(le=>le.id===g);F&&(N=F.price,P=F.weight,M=F.id)}const Y={product_id:o.id,quantity:f,unit_price:N,total_price:N*f,product_name_ar:o.name_ar,product_name_fr:o.name_fr,weight:P,product_weight_id:M};c(F=>[...F,Y]),p({title:"Product Added",description:`${o.name_ar} was added to the order.`})},J=(o,f)=>{const g=[...l],N=g[o];Object.assign(N,f),N.total_price=(N.unit_price||0)*(N.quantity||0),c(g)},ne=o=>{c(f=>f.filter((g,N)=>N!==o))},X=async()=>{try{if(!a.customer_name||!a.customer_phone||!a.wilaya_name||a.delivery_type==="home"&&!a.address){p({title:"Validation Error",description:"Please fill in all customer details.",variant:"destructive"});return}if(l.length===0){p({title:"Validation Error",description:"Please add at least one product to the order.",variant:"destructive"});return}const o={...a,customer_name:a.customer_name,customer_phone:a.customer_phone,wilaya_name:a.wilaya_name,items:l};await h.mutateAsync(o),p({title:"Order Created",description:`New order for ${a.customer_name} created successfully.`}),s(),c([]),i({customer_name:"",customer_phone:"",wilaya_name:"",wilaya_code:0,status:"new",delivery_type:"home",send_from_store:"laghouat",total:0,subtotal:0,delivery_price:0,is_manual:!0})}catch(o){console.error("Failed to create order:",o),p({title:"Creation Failed",description:"An error occurred while creating the order.",variant:"destructive"})}};return e.jsx(ye,{open:t,onOpenChange:s,children:e.jsxs(je,{className:"max-w-4xl",children:[e.jsxs(we,{children:[e.jsx(_e,{children:"Create New Order"}),e.jsx(Oe,{children:"Fill in the customer information and add products to create a new order."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 py-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"customer_name",children:"Customer Name"}),e.jsx(A,{id:"customer_name",name:"customer_name",value:a.customer_name||"",onChange:b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"customer_phone",children:"Customer Phone"}),e.jsx(A,{id:"customer_phone",name:"customer_phone",type:"tel",value:a.customer_phone||"",onChange:Q})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"wilaya_name",children:"Wilaya"}),e.jsxs(L,{name:"wilaya_name",value:a.wilaya_code?`${a.wilaya_code.toString().padStart(2,"0")} - ${a.wilaya_name}`:"",onValueChange:o=>R("wilaya_name",o),disabled:y,children:[e.jsx($,{children:e.jsx(V,{placeholder:y?"Loading Wilayas...":"Select Wilaya"})}),e.jsx(W,{children:m?.map(o=>e.jsx(O,{value:o,children:o},o))})]})]}),a.delivery_type==="home"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"address",children:"Address"}),e.jsx(A,{id:"address",name:"address",value:a.address||"",onChange:b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"delivery_type",children:"Delivery Type"}),e.jsxs(L,{name:"delivery_type",value:a.delivery_type,onValueChange:o=>R("delivery_type",o),children:[e.jsx($,{children:e.jsx(V,{})}),e.jsx(W,{children:Object.keys(Fe).map(o=>e.jsx(O,{value:o,children:Fe[o]},o))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"send_from_store",children:"Store"}),e.jsxs(L,{name:"send_from_store",value:a.send_from_store,onValueChange:o=>R("send_from_store",o),children:[e.jsx($,{children:e.jsx(V,{})}),e.jsxs(W,{children:[e.jsx(O,{value:"laghouat",children:"Laghouat"}),e.jsx(O,{value:"aflou",children:"Aflou"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"notes",children:"Notes"}),e.jsx(A,{id:"notes",name:"notes",value:a.notes||"",onChange:b})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Order Items"}),e.jsx(Ht,{onAddProduct:K,products:d}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-2",children:[l.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No products added yet."}),l.map((o,f)=>(d.find(g=>g.id===o.product_id),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:o.product_name_ar}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.product_name_fr}),o.weight&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Weight: ",o.weight]})]}),e.jsx(A,{type:"number",min:"1",value:o.quantity,onChange:g=>J(f,{quantity:parseInt(g.target.value)||1}),className:"w-20"}),e.jsxs("p",{className:"w-24 text-right",children:[o.total_price?.toLocaleString()," DZD"]}),e.jsx(re,{variant:"ghost",size:"icon",onClick:()=>ne(f),children:e.jsx(yt,{className:"w-4 h-4 text-destructive"})})]},f)))]}),l.length>0&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[a.wilaya_name&&e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Wilaya"}),e.jsx("span",{children:a.wilaya_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[a.subtotal?.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery"}),e.jsx("span",{children:S?e.jsx(ce,{className:"w-4 h-4 animate-spin"}):`${a.delivery_price?.toLocaleString()} DZD`})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:S?e.jsx(ce,{className:"w-4 h-4 animate-spin"}):`${a.total?.toLocaleString()} DZD`})]})]})]})]}),e.jsx(pt,{children:e.jsxs(re,{onClick:X,disabled:h.isPending||S,className:"w-full md:w-auto",children:[h.isPending?e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Create Order"]})})]})})};export{ga as C,va as E,pa as F,xa as O,ha as a,fa as u};
