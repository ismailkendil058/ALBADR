import{c as C,n as P,s as h,e as L,r as x,j as e,a as T}from"./index-CzubCIAQ.js";import{u as z,a as v}from"./useMutation-CjuJ8xHN.js";import{a as A,C as D}from"./card-laboSzSy.js";import{B as i}from"./button-mNsHMIkq.js";import{I as N}from"./input-ahHenGQ4.js";import{L as w}from"./label-DyR_ZUp8.js";import{D as K,a as O,b as Q,c as M,d as I}from"./dialog-DaqzuSbj.js";import{A as U,a as B,b as H,c as _,d as R,e as V,f as G,g as J}from"./alert-dialog-BdudfyX6.js";import{P as W}from"./plus-BzMTRC6J.js";import{T as X}from"./trash-2-CCtYTIZv.js";import{P as E}from"./phone-DI7nenCY.js";import{U as Y}from"./users-dPI_qkbq.js";import{U as Z}from"./user-D3WssAfL.js";import"./Combination-Cz0VTwcJ.js";const S=C("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);const $=C("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const ee=C("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function se(){const n=P(),c=z({queryKey:["employees"],queryFn:async()=>{const{data:a,error:t}=await h.from("employees").select("*").order("created_at",{ascending:!1});if(t)throw t;return a}}),d=v({mutationFn:async a=>{const{data:t,error:r}=await h.from("employees").insert([a]).select().single();if(r)throw r;return t},onSuccess:()=>{n.invalidateQueries({queryKey:["employees"]})}}),m=v({mutationFn:async({id:a,...t})=>{const{data:r,error:p}=await h.from("employees").update(t).eq("id",a).select().single();if(p)throw p;return r},onSuccess:()=>{n.invalidateQueries({queryKey:["employees"]})}}),y=v({mutationFn:async a=>{const{error:t}=await h.from("employees").delete().eq("id",a);if(t)throw t;return a},onSuccess:()=>{n.invalidateQueries({queryKey:["employees"]})}});return{employees:c.data??[],isLoading:c.isLoading,error:c.error,createEmployee:d,updateEmployee:m,deleteEmployee:y}}const ye=()=>{const{employees:n,isLoading:c,createEmployee:d,updateEmployee:m,deleteEmployee:y}=se(),{toast:a}=L(),[t,r]=x.useState(!1),[p,g]=x.useState(!1),[o,j]=x.useState(null),[l,u]=x.useState({name:"",phone:"",password:""}),b=()=>{j(null),u({name:"",phone:"",password:""}),r(!0)},k=s=>{j(s),u({name:s.name,phone:s.phone,password:s.password||""}),r(!0)},F=async s=>{s.preventDefault();try{o?(await m.mutateAsync({id:o.id,name:l.name,phone:l.phone,password:l.password}),a({title:"Success",description:"Employee updated successfully."})):(await d.mutateAsync(l),a({title:"Success",description:"Employee created successfully."})),r(!1)}catch(f){a({title:"Error",description:f.message||"Failed to save employee.",variant:"destructive"})}},q=async()=>{if(o)try{await y.mutateAsync(o.id),a({title:"Success",description:"Employee deleted successfully."}),g(!1)}catch(s){a({title:"Error",description:s.message||"Failed to delete employee.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Access Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employee accounts and dashboard access"})]}),e.jsxs(i,{onClick:b,className:"gap-2",children:[e.jsx(W,{className:"w-4 h-4"})," Add Employee Account"]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[c?Array.from({length:3}).map((s,f)=>e.jsx(A,{className:"animate-pulse",children:e.jsx(D,{className:"p-6 h-32 bg-muted/20"})},f)):n.map(s=>e.jsx(A,{className:"hover:shadow-md transition-shadow",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-primary/10 p-3 rounded-full",children:e.jsx(ee,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>k(s),children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{j(s),g(!0)},children:e.jsx(X,{className:"w-4 h-4"})})]})]}),e.jsx("h3",{className:"font-bold text-lg mb-1",children:s.name}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-3.5 h-3.5"})," ",s.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-3.5 h-3.5"})," ",s.password?"••••••••":"No password"]})]})]})},s.id)),!c&&n.length===0&&e.jsxs("div",{className:"col-span-full py-20 text-center bg-muted/20 rounded-xl border-2 border-dashed",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4 opacity-20"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No employee accounts created yet"}),e.jsx(i,{variant:"outline",className:"mt-4",onClick:b,children:"Create your first account"})]})]}),e.jsx(K,{open:t,onOpenChange:r,children:e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsx(Q,{children:e.jsx(M,{children:o?"Edit Account":"New Employee Account"})}),e.jsxs("form",{onSubmit:F,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"name",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(N,{id:"name",value:l.name,onChange:s=>u({...l,name:s.target.value}),placeholder:"Employee Name",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(N,{id:"phone",value:l.phone,onChange:s=>u({...l,phone:s.target.value}),placeholder:"0xxxxxxxxx",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"password",children:"Login Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(N,{id:"password",type:"text",value:l.password,onChange:s=>u({...l,password:s.target.value}),placeholder:"Set password",className:"pl-10",required:!0})]})]}),e.jsxs(I,{className:"pt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(i,{type:"submit",disabled:d.isPending||m.isPending,children:[(d.isPending||m.isPending)&&e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),o?"Save Changes":"Create Account"]})]})]})]})}),e.jsx(U,{open:p,onOpenChange:g,children:e.jsxs(B,{children:[e.jsxs(H,{children:[e.jsx(_,{children:"Are you sure?"}),e.jsxs(R,{children:["This will permanently delete the account for ",e.jsx("strong",{children:o?.name}),". They will lose access to the employee dashboard immediately."]})]}),e.jsxs(V,{children:[e.jsx(G,{children:"Cancel"}),e.jsx(J,{onClick:q,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Account"})]})]})})]})};export{ye as default};
