import{c as z,f as ae,e as le,b as ie,r as u,j as e,L as B}from"./index-CzubCIAQ.js";import{T as y,H as b,F as j}from"./Footer-CilkyfpT.js";import{B as C}from"./button-mNsHMIkq.js";import{I as P}from"./input-ahHenGQ4.js";import{u as de,P as oe,a as ne,b as ce,C as me}from"./useOrders-BOqVdsRA.js";import{S as F,a as W,b as q,c as O,d as R}from"./select-BP9hra2E.js";import{S as p}from"./skeleton-C3xq-Qfc.js";import{u as xe,a as ue,S as _}from"./useTariffs-D_sTwP4q.js";import{C as pe}from"./chevron-left-BGd0fdBh.js";import{T as E}from"./truck-C6lO2hhn.js";import{B as H}from"./building-2-CJMCjh2e.js";import{M as he}from"./map-pin-DhvFFu32.js";import{P as fe}from"./package-B-BPs0An.js";import{P as ye}from"./phone-DI7nenCY.js";import{a as V}from"./ar-DZ-CkRZwayx.js";import{s as be,f as D}from"./format-CuvDg6tx.js";import"./useCategories-Cm_Vywgk.js";import"./useMutation-CjuJ8xHN.js";import"./trash-2-CCtYTIZv.js";import"./plus-BzMTRC6J.js";import"./search-Dw77sz4D.js";import"./shopping-cart-D5pO5u7i.js";import"./menu-D5TOuNLq.js";import"./chevron-down-BXaytb_p.js";import"./mail-EpMK5nIF.js";import"./chevron-right-DG9mifTY.js";import"./Combination-Cz0VTwcJ.js";const je=z("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const Ne=z("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),N=[{id:"laghouat",name:"Laghouat",nameAr:"الأغواط",wilaya:"الأغواط",phone:"0555 123 456",address:"شارع الأمير عبد القادر، الأغواط"},{id:"aflou",name:"Aflou",nameAr:"أفلو",wilaya:"الأغواط",phone:"0555 789 012",address:"حي النصر، أفلو"}],Ge=()=>{const U=ae(),{toast:i}=le(),{items:v,totalPrice:g,clearCart:Z,isLoading:G}=ie(),[A,w]=u.useState(!1),[$,J]=u.useState(!1),[h,K]=u.useState(null),k=de(),[s,o]=u.useState({firstName:"",phone:"",wilaya:"",deliveryMethod:"home",address:"",selectedStore:"",pickupDate:void 0}),{data:L,isLoading:I}=xe(),Q=s.wilaya?parseInt(s.wilaya.split(" - ")[0],10):void 0,{data:f,isLoading:c,isError:X}=ue(Q),l=u.useMemo(()=>{if(!f)return{home:null,bureau:null,homeStore:"laghouat",bureauStore:"laghouat"};const r=f.map(t=>({price:t.home_price,store:t.store})).filter(t=>t.price!==null),S=f.map(t=>({price:t.bureau_price,store:t.store})).filter(t=>t.price!==null),d=r.length>0?r.reduce((t,x)=>t.price<x.price?t:x):null,m=S.length>0?S.reduce((t,x)=>t.price<x.price?t:x):null;return{home:d?.price||null,bureau:m?.price||null,homeStore:d?.store||"laghouat",bureauStore:m?.store||"laghouat"}},[f]),M=u.useMemo(()=>s.deliveryMethod==="pickup"||c?0:s.deliveryMethod==="home"?l.home??0:s.deliveryMethod==="bureau"?l.bureau??0:0,[s.deliveryMethod,l,c]),T=g+M,n=N.find(r=>r.id===s.selectedStore),Y=u.useMemo(()=>be(new Date),[]),ee=async r=>{if(r.preventDefault(),!s.firstName||!s.phone){i({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!/^\d+$/.test(s.phone)){i({title:"خطأ",description:"رقم الهاتف يجب أن يحتوي على أرقام فقط",variant:"destructive"});return}if(s.deliveryMethod!=="pickup"&&!s.wilaya){i({title:"خطأ",description:"يرجى اختيار الولاية",variant:"destructive"});return}if(s.deliveryMethod==="home"&&!s.address){i({title:"خطأ",description:"يرجى إدخال عنوان التوصيل",variant:"destructive"});return}if(s.deliveryMethod==="pickup"&&!s.selectedStore){i({title:"خطأ",description:"يرجى اختيار المتجر",variant:"destructive"});return}if(s.deliveryMethod==="pickup"&&!s.pickupDate){i({title:"خطأ",description:"يرجى اختيار تاريخ الاستلام",variant:"destructive"});return}if(s.deliveryMethod!=="pickup"&&(c||X)){i({title:"خطأ",description:"جاري حساب سعر التوصيل. يرجى المحاولة مرة أخرى.",variant:"destructive"});return}w(!0);try{let d=null,m=null;if(s.deliveryMethod==="pickup"&&n){const a=L?.find(te=>te.includes(n.wilaya));a&&(d=parseInt(a.split(" - ")[0],10),m=a.split(" - ")[1])}else s.wilaya&&(d=parseInt(s.wilaya.split(" - ")[0],10),m=s.wilaya.split(" - ")[1]);if(d===null||m===null){i({title:"خطأ",description:"تعذر تحديد معلومات الولاية. يرجى التحقق من تحديد الولاية أو المتجر بشكل صحيح.",variant:"destructive"}),w(!1);return}let t;s.deliveryMethod==="pickup"?t=s.selectedStore:s.deliveryMethod==="home"?t=l.homeStore:t=l.bureauStore;const x={customer_name:s.firstName,customer_phone:s.phone,wilaya_code:d,wilaya_name:m,address:s.deliveryMethod==="home"?s.address:null,delivery_type:s.deliveryMethod,delivery_price:M,subtotal:g,total:T,status:"new",send_from_store:t,notes:s.deliveryMethod==="pickup"&&s.pickupDate?`Pickup on: ${D(s.pickupDate,"yyyy-MM-dd")}`:null},se=v.map(a=>({product_id:a.product.id,product_name_ar:a.product.nameAr||a.product.nameFr||"Unnamed Product (AR)",product_name_fr:a.product.nameFr||a.product.nameAr||"Unnamed Product (FR)",quantity:a.quantity,unit_price:a.product.price,weight:a.selectedWeight?.weight||null,total_price:a.product.price*a.quantity})),re=await k.mutateAsync({...x,items:se});J(!0),K(re.order_number),Z(),i({title:"نجاح",description:"تم تأكيد طلبك بنجاح!",variant:"success"})}catch(d){console.error("Order submission error:",d),i({title:"خطأ",description:`فشل تأكيد الطلب: ${d.message||"حدث خطأ غير معروف"}`,variant:"destructive"})}finally{w(!1)}};return G?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(y,{}),e.jsx(b,{}),e.jsx("main",{className:"flex-1 container py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(p,{className:"h-48 w-full"}),e.jsx(p,{className:"h-32 w-full"}),e.jsx(p,{className:"h-64 w-full"}),e.jsx(p,{className:"h-12 w-full"})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(p,{className:"h-96 w-full"})})]})}),e.jsx(j,{})]}):v.length===0&&!$?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(y,{}),e.jsx(b,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-arabic-display mb-4",children:"سلة التسوق فارغة"}),e.jsx(B,{to:"/",className:"text-primary hover:underline font-body",children:"العودة للتسوق"})]})}),e.jsx(j,{})]}):$?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(y,{}),e.jsx(b,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ne,{className:"w-10 h-10 text-green-600"})}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-arabic-display font-bold text-secondary mb-4",children:["تم تأكيد طلبك بنجاح! ",h&&`(رقم الطلب: ${h})`]}),e.jsxs("p",{className:"text-muted-foreground font-body mb-6",children:["شكراً لك على طلبك ",s.wilaya&&`لولاية ${s.wilaya.split(" - ")[1]}`,". سنتواصل معك قريباً لتأكيد التفاصيل.",h&&` رقم طلبك هو: ${h}.`]}),e.jsx(C,{onClick:()=>U("/"),className:"font-body",children:"العودة للرئيسية"})]})}),e.jsx(j,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(y,{}),e.jsx(b,{}),e.jsxs("main",{className:"flex-1",children:[e.jsx("div",{className:"bg-muted/50 py-3",children:e.jsx("div",{className:"container",children:e.jsxs("nav",{className:"flex items-center gap-2 text-sm font-body text-muted-foreground",children:[e.jsx(B,{to:"/",className:"hover:text-primary transition-colors",children:"الرئيسية"}),e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-foreground",children:"تأكيد الطلب"})]})})}),e.jsx("section",{className:"py-8 md:py-12",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-arabic-display font-bold text-secondary mb-8",children:"تأكيد الطلب"}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border",children:[e.jsx("h2",{className:"text-xl font-arabic font-semibold mb-4",children:"معلومات الزبون"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["الاسم ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsx(P,{type:"text",value:s.firstName,onChange:r=>o({...s,firstName:r.target.value}),placeholder:"أدخل اسمك",required:!0,className:"font-body"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["رقم الهاتف ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsx(P,{type:"tel",value:s.phone,onChange:r=>o({...s,phone:r.target.value}),placeholder:"0555 123 456",required:!0,className:"font-body",dir:"ltr"})]})]})]}),s.deliveryMethod!=="pickup"&&e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border",children:[e.jsxs("h2",{className:"text-xl font-arabic font-semibold mb-4",children:["الولاية ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsxs(F,{value:s.wilaya,onValueChange:r=>o({...s,wilaya:r}),disabled:I,children:[e.jsx(W,{className:"w-full font-body",children:e.jsx(q,{placeholder:I?"جاري تحميل الولايات...":"اختر الولاية"})}),e.jsx(O,{className:"max-h-[300px]",children:L?.map(r=>e.jsx(R,{value:r,className:"font-body",children:r},r))})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border",children:[e.jsx("h2",{className:"text-xl font-arabic font-semibold mb-4",children:"طريقة التوصيل"}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>o({...s,deliveryMethod:"home",selectedStore:""}),className:`p-4 rounded-lg border-2 transition-all text-right ${s.deliveryMethod==="home"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx(E,{className:`w-8 h-8 mb-2 ${s.deliveryMethod==="home"?"text-primary":"text-muted-foreground"}`}),e.jsx("h3",{className:"font-arabic font-semibold",children:"توصيل للمنزل"}),e.jsx("p",{className:"text-sm text-muted-foreground font-body",children:"Livraison à domicile"}),s.wilaya&&l.home!==null&&!c?e.jsxs("p",{className:"text-primary font-bold mt-2",dir:"ltr",children:[l.home," د.ج ",e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",N.find(r=>r.id===l.homeStore)?.nameAr,")"]})]}):e.jsx("p",{className:"text-muted-foreground font-body mt-2",children:c?"جاري الحساب...":"اختر الولاية"})]}),e.jsxs("button",{type:"button",onClick:()=>o({...s,deliveryMethod:"bureau",address:"",selectedStore:""}),className:`p-4 rounded-lg border-2 transition-all text-right ${s.deliveryMethod==="bureau"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx(H,{className:`w-8 h-8 mb-2 ${s.deliveryMethod==="bureau"?"text-primary":"text-muted-foreground"}`}),e.jsx("h3",{className:"font-arabic font-semibold",children:"مكتب التوصيل"}),e.jsx("p",{className:"text-sm text-muted-foreground font-body",children:"Bureau"}),s.wilaya&&l.bureau!==null&&!c?e.jsxs("p",{className:"text-primary font-bold mt-2",dir:"ltr",children:[l.bureau," د.ج ",e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",N.find(r=>r.id===l.bureauStore)?.nameAr,")"]})]}):e.jsx("p",{className:"text-muted-foreground font-body mt-2",children:c?"جاري الحساب...":"اختر الولاية"})]}),e.jsxs("button",{type:"button",onClick:()=>o({...s,deliveryMethod:"pickup",address:"",wilaya:""}),className:`p-4 rounded-lg border-2 transition-all text-right ${s.deliveryMethod==="pickup"?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx(_,{className:`w-8 h-8 mb-2 ${s.deliveryMethod==="pickup"?"text-primary":"text-muted-foreground"}`}),e.jsx("h3",{className:"font-arabic font-semibold",children:"استلام من المتجر"}),e.jsx("p",{className:"text-sm text-muted-foreground font-body",children:"Retrait en magasin"}),e.jsx("p",{className:"text-green-600 font-bold mt-2",children:"مجاني"})]})]}),s.deliveryMethod==="home"&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["العنوان الكامل ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsx(P,{type:"text",value:s.address,onChange:r=>o({...s,address:r.target.value}),placeholder:"الحي، الشارع، رقم المنزل...",required:!0,className:"font-body"})]}),s.deliveryMethod==="pickup"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["اختر المتجر ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsxs(F,{value:s.selectedStore,onValueChange:r=>o({...s,selectedStore:r}),children:[e.jsx(W,{className:"w-full font-body",children:e.jsx(q,{placeholder:"اختر المتجر"})}),e.jsx(O,{children:N.map(r=>e.jsxs(R,{value:r.id,className:"font-body",children:[r.name," - ",r.nameAr]},r.id))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-body text-sm mb-2",children:["تاريخ الاستلام ",e.jsx("span",{className:"text-primary",children:"*"})]}),e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(C,{type:"button",variant:"outline",className:`w-full justify-between font-body ${s.pickupDate?"":"text-muted-foreground"}`,children:[e.jsx("span",{children:s.pickupDate?D(s.pickupDate,"PPP",{locale:V}):"اختر تاريخ الاستلام"}),e.jsx(je,{className:"h-4 w-4 opacity-50"})]})}),e.jsx(ce,{className:"w-auto p-0",align:"start",children:e.jsx(me,{mode:"single",selected:s.pickupDate,onSelect:r=>o({...s,pickupDate:r}),disabled:r=>r<Y,initialFocus:!0,className:"p-3 pointer-events-auto"})})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground font-body",children:"يمكنك اختيار تاريخ الاستلام المناسب لك."})]}),n&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h4",{className:"font-arabic font-semibold text-secondary",children:"معلومات المتجر"}),e.jsx("span",{className:"bg-green-100 text-green-700 text-xs font-body px-2 py-1 rounded-full",children:"بدون مصاريف توصيل"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"font-body",children:n.nameAr})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsxs("span",{className:"font-body text-muted-foreground",children:["ولاية ",n.wilaya]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-body text-muted-foreground",dir:"ltr",children:n.phone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-body text-muted-foreground",children:"استلام شخصي من المتجر"})]})]})]})]})]}),e.jsx(C,{type:"submit",size:"lg",className:"w-full font-body text-lg",disabled:A||k.isPending,children:A||k.isPending?"جاري تأكيد الطلب...":"تأكيد الطلب"})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-card rounded-xl p-6 border border-border sticky top-24",children:[e.jsx("h2",{className:"text-xl font-arabic font-semibold mb-4",children:"ملخص الطلب"}),e.jsx("div",{className:"space-y-4 mb-6",children:v.map(r=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:r.product.image,alt:r.product.nameAr,className:"w-16 h-16 rounded-lg object-cover",decoding:"async"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-arabic text-sm font-medium line-clamp-1",children:r.product.nameAr}),e.jsxs("p",{className:"text-xs text-muted-foreground font-body",children:["الكمية: ",r.quantity]}),e.jsxs("p",{className:"text-primary font-semibold text-sm",dir:"ltr",children:[r.product.price*r.quantity," د.ج"]})]})]},r.selectedWeight?`${r.product.id}-${r.selectedWeight.id}`:r.product.id))}),e.jsxs("div",{className:"border-t border-border pt-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.deliveryMethod==="home"&&e.jsx(E,{className:"w-4 h-4 text-primary"}),s.deliveryMethod==="bureau"&&e.jsx(H,{className:"w-4 h-4 text-primary"}),s.deliveryMethod==="pickup"&&e.jsx(_,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-body text-sm",children:[s.deliveryMethod==="home"&&"توصيل للمنزل",s.deliveryMethod==="bureau"&&"مكتب التوصيل",s.deliveryMethod==="pickup"&&"استلام من المتجر"]})]}),s.deliveryMethod==="pickup"?e.jsxs("div",{className:"mr-6 space-y-1",children:[n&&e.jsx("p",{className:"text-xs text-muted-foreground font-body",children:n.nameAr}),s.pickupDate&&e.jsxs("p",{className:"text-xs text-muted-foreground font-body",children:["تاريخ الاستلام: ",D(s.pickupDate,"PPP",{locale:V})]})]}):s.wilaya&&e.jsx("div",{className:"mr-6 space-y-1",children:e.jsxs("p",{className:"text-xs text-muted-foreground font-body",children:["الولاية: ",s.wilaya.split(" - ")[1]]})})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between font-body",children:[e.jsx("span",{className:"text-muted-foreground",children:"المجموع الفرعي"}),e.jsxs("span",{dir:"ltr",children:[g," د.ج"]})]}),e.jsxs("div",{className:"flex justify-between font-body",children:[e.jsx("span",{className:"text-muted-foreground",children:"التوصيل"}),s.deliveryMethod==="pickup"?e.jsx("span",{className:"text-green-600 font-semibold",children:"مجاني"}):e.jsxs("span",{dir:"ltr",children:[M," د.ج"]})]}),e.jsxs("div",{className:"flex justify-between font-arabic font-bold text-lg pt-2 border-t border-border",children:[e.jsx("span",{children:"المجموع الكلي"}),e.jsxs("span",{className:"text-primary",dir:"ltr",children:[T," د.ج"]})]})]})]})})]})]})})]}),e.jsx(j,{})]})};export{Ge as default};
