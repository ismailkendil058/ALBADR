import{j as e}from"./ui-vendor-CbTtZHsW.js";import{a as r}from"./react-vendor-1XlI0agO.js";import{a as t,C as s}from"./card-PHeom2L9.js";import{B as a}from"./button-D-ffmNcE.js";import{S as l}from"./skeleton-BZOrIP_J.js";import{p as o,D as i}from"./date-range-picker-DBY0j15P.js";import{b as d}from"./index-BWpasF73.js";import{e as n,g as c,a as m,F as u,D as x,R as h,A as f,X as p,Y as g,T as j,b as v,P as y,c as b,C as N,d as k}from"./AreaChart-BSj-QKRs.js";import{s as w,c as R,e as C,d as S,i as $}from"./useOrders-Bo6usLWA.js";import{d as D}from"./useProducts-Dd0Ob86o.js";import{S as M}from"./shopping-cart-D1jdCj2s.js";import{T as O}from"./trending-up-CNC4WCOF.js";import{T as _}from"./truck-B8PAd3Dr.js";import{s as L,f as F}from"./format-v08Horlk.js";import"./query-vendor-DL9dZapS.js";import"./FileSaver.min-CmnGXiS0.js";import"./chevron-right-DqnxfF0a.js";import"./chevron-left-CZa2LEKQ.js";const B={primary:"hsl(220, 70%, 50%)",secondary:"hsl(160, 60%, 45%)",tertiary:"hsl(30, 80%, 55%)",quaternary:"hsl(280, 65%, 60%)",quinary:"hsl(340, 75%, 55%)"},A=()=>{const{toast:t}=d(),[s,l]=r.useState("7d"),[A,P]=r.useState(new Date),[q,E]=r.useState({from:new Date,to:new Date}),{from:V,to:Z}=r.useMemo(()=>{const e=new Date;let r,t;switch(s){case"7d":default:return r=w(e,6),t=e,{from:L(r),to:n(t)};case"month":return r=R(e),t=C(e),{from:L(r),to:n(t)};case"custom":return r=q?.from,t=q?.to,{from:r?L(r):void 0,to:t?n(t):void 0}}},[s,q]),{data:G=[],isLoading:W}=S(V,Z),{data:Y=[],isLoading:H}=D(),X=r.useMemo(()=>{const e=G.filter(e=>"canceled"!==e.status),r=G.length,t=e.reduce((e,r)=>"returned"===r.status?e-Number(r.tariff_retour_price||0):e+Number(r.subtotal),0),s=e.length>0?Math.round(t/e.length):0,a={home:G.filter(e=>"home"===e.delivery_type).length,bureau:G.filter(e=>"bureau"===e.delivery_type).length,pickup:G.filter(e=>"pickup"===e.delivery_type).length},l={laghouat:G.filter(e=>"laghouat"===e.send_from_store).length,aflou:G.filter(e=>"aflou"===e.send_from_store).length},o=a.home+a.bureau,i=r>0?Math.round(a.pickup/r*100):0,d=r>0?Math.round(o/r*100):0,n=G.filter(e=>"confirmed"===e.status||"delivered"===e.status),c=n.filter(e=>"delivered"===e.status).length,m=n.length,u=m>0?c/m*100:0,x={new:G.filter(e=>"new"===e.status).length,confirmed:G.filter(e=>"confirmed"===e.status).length,delivered:G.filter(e=>"delivered"===e.status).length,returned:G.filter(e=>"returned"===e.status).length},h=G.filter(e=>"confirmed"===e.status||"returned"===e.status);return{totalOrders:r,totalRevenue:t,averageOrderValue:s,ordersByDelivery:a,ordersByStore:l,pickupRatio:i,deliveryRatio:d,confirmedToDeliveredSuccessRate:u,deliveredFromConfirmed:c,totalConfirmedPotential:m,orderStatusBreakdown:x,returnedFromConfirmed:h.filter(e=>"returned"===e.status).length,totalConfirmedForReturnRatio:h.length}},[G]),I=r.useMemo(()=>{const e=G.filter(e=>"canceled"!==e.status);if(V&&Z&&$(V,Z)){const r=Array.from({length:24},(e,r)=>({label:`${String(r).padStart(2,"0")}:00`,orders:0,revenue:0}));return e.forEach(e=>{const t=o(e.created_at);if($(t,V)){const s=c(t);r[s].orders+=1,r[s].revenue+="returned"===e.status?-Number(e.tariff_retour_price||0):Number(e.subtotal)}}),r}if(V&&Z){return m({start:V,end:Z}).map(r=>{const t=e.filter(e=>$(o(e.created_at),r));return{label:F(r,"MMM dd"),orders:t.length,revenue:t.reduce((e,r)=>e+("returned"===r.status?-Number(r.tariff_retour_price||0):Number(r.subtotal)),0)}})}return[]},[G,V,Z]),J=[{name:"Home",value:X.ordersByDelivery.home,color:B.primary},{name:"Bureau",value:X.ordersByDelivery.bureau,color:B.secondary},{name:"Pickup",value:X.ordersByDelivery.pickup,color:B.tertiary}].filter(e=>e.value>0),Q=[{name:"Laghouat",value:X.ordersByStore.laghouat,color:B.primary},{name:"Aflou",value:X.ordersByStore.aflou,color:B.tertiary}].filter(e=>e.value>0),U=[{name:"Delivered",value:X.deliveredFromConfirmed,color:B.secondary},{name:"Pending Delivery",value:X.totalConfirmedPotential-X.deliveredFromConfirmed,color:B.tertiary}].filter(e=>e.value>0),ee=[{name:"New",value:X.orderStatusBreakdown.new,color:B.primary},{name:"Confirmed",value:X.orderStatusBreakdown.confirmed,color:B.secondary},{name:"Delivered",value:X.orderStatusBreakdown.delivered,color:B.tertiary},{name:"Returned",value:X.orderStatusBreakdown.returned,color:B.quaternary}].filter(e=>e.value>0),re=[{name:"Returned",value:X.returnedFromConfirmed,color:B.quinary},{name:"Confirmed",value:X.totalConfirmedForReturnRatio-X.returnedFromConfirmed,color:B.secondary}].filter(e=>e.value>0),te=W||H;return e.jsxs("div",{className:"space-y-8 ltr",dir:"ltr",children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground tracking-tight",children:"Analytics Overview"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:q?.from&&q?.to?$(q.from,q.to)?F(q.from,"MMMM dd, yyyy"):`${F(q.from,"MMM dd, yyyy")} - ${F(q.to,"MMM dd, yyyy")}`:"Select a date range"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"inline-flex items-center rounded-lg border border-border bg-card p-1 gap-1",children:[e.jsx(a,{size:"sm",variant:"7d"===s?"default":"ghost",onClick:()=>{l("7d"),E(void 0)},className:"text-sm px-4",children:"7 Days"}),e.jsx(a,{size:"sm",variant:"month"===s?"default":"ghost",onClick:()=>{l("month"),E(void 0)},className:"text-sm px-4",children:"Month"}),e.jsx(a,{size:"sm",variant:"custom"===s?"default":"ghost",onClick:()=>{l("custom"),P(void 0)},className:"text-sm px-4",children:"Custom Range"})]}),"custom"===s&&e.jsx(i,{date:q,onSelect:e=>{E(e),e?.from&&e?.to?l("custom"):e?.from&&!e.to&&(E({from:e.from,to:e.from}),l("custom"))}}),e.jsx("div",{className:"ml-auto",children:e.jsxs(a,{variant:"default",size:"sm",onClick:()=>{if(0===G.length)return void t({title:"No data to export",description:"There are no metrics for the selected date range.",variant:"destructive"});const e=`Dashboard_Analytics_${V&&Z?`${F(V,"yyyy-MM-dd")}_to_${F(Z,"yyyy-MM-dd")}`:F(new Date,"yyyy-MM-dd")}`;k(X,I,{from:V,to:Z},e),t({title:"Export Complete",description:`Analytics report exported successfully as ${e}.xlsx`})},className:"gap-2 bg-emerald-600 hover:bg-emerald-700 text-white border-none shadow-sm",children:[e.jsx(u,{className:"w-4 h-4"}),"Export Excel"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(T,{title:"Total Orders",value:X.totalOrders,icon:M,loading:te}),e.jsx(T,{title:"Total Revenue",value:`${X.totalRevenue.toLocaleString()} DZD`,icon:x,loading:te}),e.jsx(T,{title:"Average Order Value",value:`${X.averageOrderValue.toLocaleString()} DZD`,icon:O,loading:te}),e.jsx(T,{title:"Pickup / Delivery",value:`${X.pickupRatio}% / ${X.deliveryRatio}%`,icon:_,loading:te,subtitle:"Pickup vs Delivery ratio"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(z,{title:"Orders Over Time",loading:te,children:I.length>0?e.jsx(h,{width:"100%",height:280,children:e.jsxs(f,{data:I,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorOrders",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:B.primary,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:B.primary,stopOpacity:0})]})}),e.jsx(p,{dataKey:"label",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12}}),e.jsx(g,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12}}),e.jsx(j,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(v,{type:"monotone",dataKey:"orders",stroke:B.primary,strokeWidth:2,fillOpacity:1,fill:"url(#colorOrders)"})]})}):e.jsx(K,{})}),e.jsx(z,{title:"Revenue Over Time",loading:te,children:I.length>0?e.jsx(h,{width:"100%",height:280,children:e.jsxs(f,{data:I,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:B.secondary,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:B.secondary,stopOpacity:0})]})}),e.jsx(p,{dataKey:"label",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12}}),e.jsx(g,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickFormatter:e=>`${(e/1e3).toFixed(0)}k`}),e.jsx(j,{formatter:e=>[`${e.toLocaleString()} DZD`,"Revenue"],contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(v,{type:"monotone",dataKey:"revenue",stroke:B.secondary,strokeWidth:2,fillOpacity:1,fill:"url(#colorRevenue)"})]})}):e.jsx(K,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(z,{title:"Orders by Delivery Type",loading:te,children:J.length>0?e.jsxs("div",{className:"flex flex-col items-center h-full",children:[e.jsx(h,{width:"100%",height:200,children:e.jsxs(y,{children:[e.jsx(b,{data:J,cx:"50%",cy:"50%",innerRadius:65,outerRadius:95,paddingAngle:3,dataKey:"value",labelLine:!1,label:({name:e,percent:r})=>`${e} ${(100*r).toFixed(0)}%`,children:J.map((r,t)=>e.jsx(N,{fill:r.color},`cell-${t}`))}),e.jsx(j,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2 mt-auto pt-4",children:J.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.name}),e.jsx("span",{className:"text-sm font-medium",children:r.value})]},t))})]}):e.jsx(K,{})}),e.jsx(z,{title:"Orders by Store",loading:te,children:Q.length>0?e.jsxs("div",{className:"flex flex-col items-center h-full",children:[e.jsx(h,{width:"100%",height:200,children:e.jsxs(y,{children:[e.jsx(b,{data:Q,cx:"50%",cy:"50%",innerRadius:65,outerRadius:95,paddingAngle:3,dataKey:"value",labelLine:!1,label:({name:e,percent:r})=>`${e} ${(100*r).toFixed(0)}%`,children:Q.map((r,t)=>e.jsx(N,{fill:r.color},`cell-${t}`))}),e.jsx(j,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2 mt-auto pt-4",children:Q.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.name}),e.jsx("span",{className:"text-sm font-medium",children:r.value})]},t))})]}):e.jsx(K,{})}),e.jsx(z,{title:"Total Orders Breakdown",loading:te,children:ee.length>0?e.jsxs("div",{className:"flex flex-col items-center h-full",children:[e.jsx(h,{width:"100%",height:200,children:e.jsxs(y,{children:[e.jsx(b,{data:ee,cx:"50%",cy:"50%",innerRadius:65,outerRadius:95,paddingAngle:3,dataKey:"value",labelLine:!1,label:({name:e,percent:r})=>`${e} ${(100*r).toFixed(0)}%`,children:ee.map((r,t)=>e.jsx(N,{fill:r.color},`cell-${t}`))}),e.jsx(j,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2 mt-auto pt-4",children:ee.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.name}),e.jsx("span",{className:"text-sm font-medium",children:r.value})]},t))})]}):e.jsx(K,{})}),e.jsx(z,{title:"Confirmed to Delivered Success Rate",loading:te,children:U.length>0?e.jsxs("div",{className:"flex flex-col items-center h-full",children:[e.jsx(h,{width:"100%",height:200,children:e.jsxs(y,{children:[e.jsx(b,{data:U,cx:"50%",cy:"50%",innerRadius:65,outerRadius:95,paddingAngle:3,dataKey:"value",labelLine:!1,label:({name:e,percent:r})=>`${e} ${(100*r).toFixed(0)}%`,children:U.map((r,t)=>e.jsx(N,{fill:r.color},`cell-${t}`))}),e.jsx(j,{formatter:(e,r)=>[`${e} Orders`,r],contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2 mt-auto pt-4",children:U.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.name}),e.jsx("span",{className:"text-sm font-medium",children:r.value})]},t))})]}):e.jsx(K,{})}),e.jsx(z,{title:"Confirmed/Returns Ratio",loading:te,children:re.length>0?e.jsxs("div",{className:"flex flex-col items-center h-full",children:[e.jsx(h,{width:"100%",height:200,children:e.jsxs(y,{children:[e.jsx(b,{data:re,cx:"50%",cy:"50%",innerRadius:65,outerRadius:95,paddingAngle:3,dataKey:"value",labelLine:!1,label:({name:e,percent:r})=>`${e} ${(100*r).toFixed(0)}%`,children:re.map((r,t)=>e.jsx(N,{fill:r.color},`cell-${t}`))}),e.jsx(j,{formatter:(e,r)=>[`${e} Orders`,r],contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2 mt-auto pt-4",children:re.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.name}),e.jsx("span",{className:"text-sm font-medium",children:r.value})]},t))})]}):e.jsx(K,{})})]})]})},T=({title:r,value:a,icon:o,loading:i,subtitle:d})=>e.jsx(t,{className:"border-border/50",children:e.jsx(s,{className:"p-6",children:i?e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{className:"h-4 w-24"}),e.jsx(l,{className:"h-8 w-32"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:r}),e.jsx(o,{className:"w-4 h-4 text-muted-foreground/60"})]}),e.jsx("p",{className:"text-2xl font-semibold tracking-tight",children:a}),d&&e.jsx("p",{className:"text-xs text-muted-foreground",children:d})]})})}),z=({title:r,subtitle:a,children:o,loading:i,icon:d})=>e.jsx(t,{className:"border-border/50",children:e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d,e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:r}),a&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a})]})]}),i?e.jsx("div",{className:"h-[220px] flex items-center justify-center",children:e.jsx(l,{className:"h-full w-full rounded-lg"})}):o]})}),K=()=>e.jsx("div",{className:"h-[220px] flex items-center justify-center text-sm text-muted-foreground",children:"No data available for this period"});export{A as default};
