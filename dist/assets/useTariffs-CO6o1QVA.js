import{c as e,s as r}from"./index-D1_jVxz0.js";import{R as a}from"./react-vendor-1XlI0agO.js";import{b as t,u as s,c as i}from"./query-vendor-DL9dZapS.js";const o=e("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);function c(e){return t({queryKey:["tariffs",e?.store,e?.isActive],queryFn:async()=>{let a=r.from("tariffs").select("*").order("wilaya_code",{ascending:!0});e?.store&&(a=a.eq("store",e.store)),void 0!==e?.isActive&&(a=a.eq("is_active",e.isActive));const{data:t,error:s}=await a;if(s)throw s;return t}})}function n(){const e=s();return i({mutationFn:async e=>{for(const a of e){const e={};void 0!==a.home_price&&(e.home_price=a.home_price),void 0!==a.bureau_price&&(e.bureau_price=a.bureau_price),void 0!==a.retour&&(e.retour=a.retour),void 0!==a.is_active&&(e.is_active=a.is_active);const{error:t}=await r.from("tariffs").update(e).eq("id",a.id);if(t)throw t}return e.length},onSuccess:()=>{e.invalidateQueries({queryKey:["tariffs"]})}})}function u(){const e=s();return i({mutationFn:async e=>{const{data:a,error:t}=await r.from("tariffs").select("id, wilaya_code, store");if(t)throw t;const s={successfulInserts:0,successfulUpdates:0,failedImports:[]};for(const i of e){const e=a.find(e=>e.wilaya_code===i.wilaya_code&&e.store===i.store),t={wilaya_code:i.wilaya_code,wilaya_name:i.wilaya_name,home_price:i.home_price,bureau_price:i.bureau_price,retour:i.retour,store:i.store};let o=null;if(e){const{error:a}=await r.from("tariffs").update(t).eq("id",e.id);o=a,a||s.successfulUpdates++}else{const{error:e}=await r.from("tariffs").insert(t);o=e,e||s.successfulInserts++}o&&s.failedImports.push({tariff:i,error:o.message})}return s},onSuccess:()=>{e.invalidateQueries({queryKey:["tariffs"]})}})}function f(e){return t({queryKey:["tariffs",e],queryFn:async()=>{if(!e)return null;const{data:a,error:t}=await r.from("tariffs").select("store, home_price, bureau_price").eq("wilaya_code",e).eq("is_active",!0);if(t)throw t;return a},enabled:!!e})}function d(e,a){return t({queryKey:["cheapest-delivery",e,a],queryFn:async()=>{if(!e||"pickup"===a)return{store:"laghouat",price:0};const{data:t,error:s}=await r.rpc("get_cheapest_store",{_wilaya_code:e,_delivery_type:a});if(s)throw s;return t?.[0]},enabled:!!e&&"pickup"!==a})}function p(){const{data:e=[],isLoading:r,error:t}=c({isActive:!0});return{data:a.useMemo(()=>{const r=new Map;return e.forEach(e=>{!r.has(e.wilaya_code)&&e.wilaya_name&&r.set(e.wilaya_code,`${e.wilaya_code.toString().padStart(2,"0")} - ${e.wilaya_name}`)}),Array.from(r.values()).sort((e,r)=>parseInt(e.split(" - ")[0],10)-parseInt(r.split(" - ")[0],10))},[e]),isLoading:r,error:t}}export{o as S,f as a,c as b,n as c,u as d,d as e,p as u};
