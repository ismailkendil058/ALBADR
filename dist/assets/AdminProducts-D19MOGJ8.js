import{j as e}from"./ui-vendor-CbTtZHsW.js";import{a as s}from"./react-vendor-1XlI0agO.js";import{S as a}from"./skeleton-6yxWGX1N.js";import{a as r,C as i}from"./card-Cczuk04M.js";import{B as t}from"./button-BaBzPPdN.js";import{I as l}from"./input-Cyy5VwgS.js";import{L as c}from"./label-Dtbf7Pbr.js";import{T as n}from"./textarea-O44Vt9Z2.js";import{u as d,S as o,C as m}from"./use-debounce-D4NJ8zY8.js";import{S as h,a as p,b as x,c as u,d as g}from"./select-BhMqPoNH.js";import{D as j,a as f,b as v,c as _,d as N}from"./dialog-BnEvN8u9.js";import{A as w,a as b,b as y,c as C,d as P,e as k,f as S,g as D}from"./alert-dialog-AZPmfsKc.js";import{B as F}from"./badge-sMWyZfAg.js";import{P as A,a as E,b as z,c as M,d as U,e as I}from"./pagination-DIcs9vkY.js";import{c as L,b as B,L as W,X as q,s as O}from"./index-D1_jVxz0.js";import{d as Z,f as T,g as V,h as $}from"./useProducts-C-FzGN4K.js";import{u as G}from"./useCategories-DFbTdWoi.js";import{P as J}from"./plus-HqHeUJWv.js";import{S as R}from"./search-B6TsrJyZ.js";import{P as K}from"./package-BY-qjQqh.js";import{T as Q}from"./trending-up-69ZK-Ugo.js";import{S as H}from"./square-pen-DKAJy3Tl.js";import{T as X}from"./trash-2-BNPyHnqR.js";import{I as Y}from"./image-ugoZQobq.js";import{U as ee}from"./upload-DM0s_sQW.js";import"./index-CBOS6VWY.js";import"./chevron-down-W51QyQCR.js";import"./chevron-left-B9kvwOhv.js";import"./chevron-right-DNnr06E4.js";import"./query-vendor-DL9dZapS.js";const se=L("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),ae=()=>{const[L,ae]=s.useState(1),[re,ie]=s.useState(""),te=d(re,500),{data:le,isLoading:ce}=Z({page:L,pageSize:8,searchQuery:te}),{data:ne=[],count:de=0}=le||{},{categories:oe=[]}=G(),me=T(),he=V(),pe=$(),[xe,ue]=s.useState(!1),[ge,je]=s.useState(null),[fe,ve]=s.useState(null),[_e,Ne]=s.useState(!1),[we,be]=s.useState(null),ye=s.useRef(null),{toast:Ce}=B(),[Pe,ke]=s.useState({name_ar:"",name_fr:"",price:"",category_id:"",description_ar:"",has_weight_options:!1,is_featured:!1,is_best_seller:!1,is_new:!1,is_promo:!1,image:"",original_price:""}),[Se,De]=s.useState([]);s.useEffect(()=>{ae(1)},[te]);const Fe=(e,s,a)=>{De(r=>r.map((r,i)=>i===e?{...r,[s]:"price"===s?parseFloat(a)||0:a}:r))},Ae=Math.ceil(de/8);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsxs("p",{className:"text-muted-foreground",children:["Manage store products (",de," total)"]})]}),e.jsxs(t,{onClick:()=>{je(null),ke({name_ar:"",name_fr:"",price:"",category_id:"",description_ar:"",has_weight_options:!1,is_featured:!1,is_best_seller:!1,is_new:!1,is_promo:!1,image:"",original_price:""}),De([]),be(null),ue(!0)},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Product"]})]}),e.jsx(r,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(l,{placeholder:"Search products...",value:re,onChange:e=>ie(e.target.value),className:"pl-10"})]})})}),ce?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:8}).map((s,r)=>e.jsx(a,{className:"h-96 w-full"},r))}):0===ne.length?e.jsx(r,{children:e.jsxs(i,{className:"py-12 text-center",children:[e.jsx(K,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No products found"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:ne.map(s=>e.jsxs(r,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square relative bg-muted",children:[e.jsx("img",{src:s.image||"/placeholder.svg",alt:s.name_ar,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[s.is_featured&&e.jsxs(F,{className:"bg-purple-100 text-purple-800",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Featured"]}),s.is_best_seller&&e.jsxs(F,{className:"bg-blue-100 text-blue-800",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"Best Seller"]})]})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"font-bold mb-1",dir:"rtl",children:s.name_ar}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.name_fr}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.price.toLocaleString()," DZD"]}),s.has_weight_options&&s.weights&&e.jsxs(F,{variant:"outline",className:"text-xs",children:[e.jsx(o,{className:"w-3 h-3 mr-1"}),s.weights.length," weights"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>(e=>{const s=ne.find(s=>s.id===e);s&&(je(e),ke({name_ar:s.name_ar,name_fr:s.name_fr,price:s.price.toString(),category_id:s.category_id||"",description_ar:s.description_ar||"",has_weight_options:s.has_weight_options||!1,is_featured:s.is_featured||!1,is_best_seller:s.is_best_seller||!1,is_new:s.is_new||!1,is_promo:s.is_promo||!1,image:s.image||"",original_price:s.original_price?.toString()||""}),De(s.weights?.map(e=>({id:e.id,weight:e.weight,price:e.price}))||[]),be(s.image||null),ue(!0))})(s.id),children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(t,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>ve(s.id),children:e.jsx(X,{className:"w-4 h-4"})})]})]})]},s.id))}),Ae>1&&e.jsx(A,{children:e.jsxs(E,{children:[e.jsx(z,{children:e.jsx(M,{href:"#",onClick:e=>{e.preventDefault(),ae(e=>Math.max(1,e-1))},className:1===L?"pointer-events-none text-muted-foreground":""})}),[...Array(Ae)].map((s,a)=>e.jsx(z,{children:e.jsx(U,{href:"#",onClick:e=>{e.preventDefault(),ae(a+1)},isActive:L===a+1,children:a+1})},a)),e.jsx(z,{children:e.jsx(I,{href:"#",onClick:e=>{e.preventDefault(),ae(e=>Math.min(Ae,e+1))},className:L===Ae?"pointer-events-none text-muted-foreground":""})})]})})]}),e.jsx(j,{open:xe,onOpenChange:ue,children:e.jsxs(f,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(v,{children:e.jsx(_,{children:ge?"Edit Product":"Add New Product"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Name (Arabic) *"}),e.jsx(l,{value:Pe.name_ar,onChange:e=>ke(s=>({...s,name_ar:e.target.value})),placeholder:"اسم المنتج",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Name (French) *"}),e.jsx(l,{value:Pe.name_fr,onChange:e=>ke(s=>({...s,name_fr:e.target.value})),placeholder:"Nom du produit"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Base Price (DZD) *"}),e.jsx(l,{type:"number",value:Pe.price,onChange:e=>ke(s=>({...s,price:e.target.value})),placeholder:"Enter price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Original Price (DZD)"}),e.jsx(l,{type:"number",value:Pe.original_price,onChange:e=>ke(s=>({...s,original_price:e.target.value})),placeholder:"For promotions"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Category"}),e.jsxs(h,{value:Pe.category_id,onValueChange:e=>ke(s=>({...s,category_id:e})),children:[e.jsx(p,{children:e.jsx(x,{placeholder:"Select category"})}),e.jsx(u,{children:oe.map(s=>e.jsx(g,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.name_ar}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s.name_fr})]})},s.id))})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Product Image"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-32 h-32 border-2 border-dashed border-border rounded-lg flex items-center justify-center bg-muted/50 overflow-hidden",children:we?e.jsx("img",{src:we,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(Y,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[e.jsx("input",{ref:ye,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(s)if(s.type.startsWith("image/"))if(s.size>5242880)Ce({title:"File too large",description:"Image must be less than 5MB",variant:"destructive"});else{Ne(!0);try{const e=s.name.split(".").pop(),a=`products/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${e}`}`,{error:r}=await O.storage.from("products").upload(a,s);if(r)throw r;const{data:{publicUrl:i}}=O.storage.from("products").getPublicUrl(a);ke(e=>({...e,image:i})),be(i),Ce({title:"Uploaded",description:"Image uploaded successfully"})}catch(a){Ce({title:"Upload failed",description:a.message||"Failed to upload image",variant:"destructive"})}finally{Ne(!1)}}else Ce({title:"Invalid file",description:"Please select an image file",variant:"destructive"})},className:"hidden"}),e.jsx(t,{type:"button",variant:"outline",size:"sm",onClick:()=>ye.current?.click(),disabled:_e,children:_e?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Upload Image"]})}),we&&e.jsxs(t,{type:"button",variant:"ghost",size:"sm",onClick:()=>{ke(e=>({...e,image:""})),be(null),ye.current&&(ye.current.value="")},className:"text-destructive hover:text-destructive",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Remove"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max 5MB, JPG/PNG/WebP"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Description (Arabic)"}),e.jsx(n,{value:Pe.description_ar,onChange:e=>ke(s=>({...s,description_ar:e.target.value})),placeholder:"وصف المنتج",rows:2,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Product Labels"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"featured",checked:Pe.is_featured,onCheckedChange:e=>ke(s=>({...s,is_featured:!!e}))}),e.jsxs("label",{htmlFor:"featured",className:"text-sm cursor-pointer flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4 text-purple-500"}),"Produit en Vedette"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"bestseller",checked:Pe.is_best_seller,onCheckedChange:e=>ke(s=>({...s,is_best_seller:!!e}))}),e.jsxs("label",{htmlFor:"bestseller",className:"text-sm cursor-pointer flex items-center gap-1",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-500"}),"Meilleures Ventes"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"new",checked:Pe.is_new,onCheckedChange:e=>ke(s=>({...s,is_new:!!e}))}),e.jsx("label",{htmlFor:"new",className:"text-sm cursor-pointer",children:"New Product"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"promo",checked:Pe.is_promo,onCheckedChange:e=>ke(s=>({...s,is_promo:!!e}))}),e.jsx("label",{htmlFor:"promo",className:"text-sm cursor-pointer",children:"Promotion"})]})]})]}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"hasWeights",checked:Pe.has_weight_options,onCheckedChange:e=>ke(s=>({...s,has_weight_options:!!e}))}),e.jsxs("label",{htmlFor:"hasWeights",className:"text-sm font-medium cursor-pointer flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"}),"Enable Weight Options"]})]}),Pe.has_weight_options&&e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:()=>De(e=>[...e,{weight:"",price:0}]),children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Add Weight"]})]}),Pe.has_weight_options&&e.jsxs("div",{className:"space-y-2",children:[0===Se.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:'No weights added. Click "Add Weight" to create weight options.'}),Se.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{placeholder:"e.g., 50g, 100g",value:s.weight,onChange:e=>Fe(a,"weight",e.target.value),className:"flex-1"}),e.jsx(l,{type:"number",placeholder:"Price",value:s.price||"",onChange:e=>Fe(a,"price",e.target.value),className:"w-28"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"DZD"}),e.jsx(t,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>De(s=>s.filter((s,a)=>a!==e)))(a),children:e.jsx(q,{className:"w-4 h-4 text-destructive"})})]},a))]})]})]}),e.jsxs(N,{children:[e.jsx(t,{variant:"outline",onClick:()=>ue(!1),children:"Cancel"}),e.jsxs(t,{onClick:async()=>{if(!Pe.name_ar||!Pe.name_fr||!Pe.price)return void Ce({title:"Error",description:"Please fill in all required fields",variant:"destructive"});const e=parseFloat(Pe.price);if(isNaN(e))return void Ce({title:"Error",description:"Please enter a valid price",variant:"destructive"});const s=Pe.original_price?parseFloat(Pe.original_price):null;if(!Pe.original_price||null!==s&&!isNaN(s))try{const a={name_ar:Pe.name_ar,name_fr:Pe.name_fr,price:e,category_id:Pe.category_id||null,description_ar:Pe.description_ar||null,has_weight_options:Pe.has_weight_options,is_featured:Pe.is_featured,is_best_seller:Pe.is_best_seller,is_new:Pe.is_new,is_promo:Pe.is_promo,image:Pe.image||null,original_price:s},r=Pe.has_weight_options?Se.filter(e=>e.weight).map((e,s)=>({weight:e.weight,price:e.price,sort_order:s})):[];ge?(await he.mutateAsync({id:ge,product:a,weights:r}),Ce({title:"Updated",description:"Product updated successfully"})):(await me.mutateAsync({product:a,weights:r}),Ce({title:"Added",description:"Product added successfully"})),ue(!1)}catch(a){Ce({title:"Error",description:"Failed to save product",variant:"destructive"})}else Ce({title:"Error",description:"Please enter a valid original price",variant:"destructive"})},disabled:me.isPending||he.isPending,children:[(me.isPending||he.isPending)&&e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),ge?"Update":"Add"," Product"]})]})]})}),e.jsx(w,{open:!!fe,onOpenChange:()=>ve(null),children:e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Delete Product"}),e.jsx(P,{children:"Are you sure you want to delete this product? This action cannot be undone."})]}),e.jsxs(k,{children:[e.jsx(S,{children:"Cancel"}),e.jsx(D,{onClick:async()=>{if(fe)try{await pe.mutateAsync(fe),Ce({title:"Deleted",description:"Product deleted successfully"}),ve(null)}catch(e){Ce({title:"Error",description:"Failed to delete product",variant:"destructive"})}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:pe.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Delete"})]})]})})]})};export{ae as default};
