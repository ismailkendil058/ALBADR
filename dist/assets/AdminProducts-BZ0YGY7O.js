import{c as me,r as c,e as he,j as e,a as A,X as V,s as $}from"./index-CzubCIAQ.js";import{S as pe}from"./skeleton-C3xq-Qfc.js";import{a as F,C as I}from"./card-laboSzSy.js";import{B as o}from"./button-mNsHMIkq.js";import{I as h}from"./input-ahHenGQ4.js";import{L as d}from"./label-DyR_ZUp8.js";import{T as ue}from"./textarea-H4h5319Y.js";import{u as ge,S as q,C as x}from"./use-debounce-gqjLm0b-.js";import{S as xe,a as fe,b as je,c as _e,d as ve}from"./select-BP9hra2E.js";import{D as Ne,a as we,b as be,c as ye,d as Pe}from"./dialog-DaqzuSbj.js";import{A as Ce,a as De,b as Se,c as ke,d as Ae,e as Fe,f as Ie,g as Ee}from"./alert-dialog-BdudfyX6.js";import{B as E}from"./badge-Bi3gZxY0.js";import{P as Ue,a as Me,b as U,c as We,d as Te,e as Le}from"./pagination-DyxH1k2Q.js";import{d as ze,f as Be,g as Oe,h as Ze}from"./useProducts-C81J7_oK.js";import{u as Qe}from"./useCategories-Cm_Vywgk.js";import{P as G}from"./plus-BzMTRC6J.js";import{S as Re}from"./search-Dw77sz4D.js";import{P as Ve}from"./package-B-BPs0An.js";import{T as H}from"./trending-up-BdF4kBHF.js";import{S as $e}from"./square-pen-DU_zNNOu.js";import{T as qe}from"./trash-2-CCtYTIZv.js";import{I as Ge}from"./image-HriddqiJ.js";import{U as He}from"./upload-BD50tocH.js";import"./Combination-Cz0VTwcJ.js";import"./chevron-down-BXaytb_p.js";import"./chevron-left-BGd0fdBh.js";import"./chevron-right-DG9mifTY.js";import"./useMutation-CjuJ8xHN.js";const J=me("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),M=8,ys=()=>{const[f,j]=c.useState(1),[W,X]=c.useState(""),T=ge(W,500),{data:K,isLoading:Y}=ze({page:f,pageSize:M,searchQuery:T}),{data:b=[],count:L=0}=K||{},{categories:ee=[]}=Qe(),y=Be(),P=Oe(),z=Ze(),[se,u]=c.useState(!1),[_,B]=c.useState(null),[C,D]=c.useState(null),[O,Z]=c.useState(!1),[S,v]=c.useState(null),N=c.useRef(null),{toast:l}=he(),[t,i]=c.useState({name_ar:"",name_fr:"",price:"",category_id:"",description_ar:"",has_weight_options:!1,is_featured:!1,is_best_seller:!1,is_new:!1,is_promo:!1,image:"",original_price:""}),[k,g]=c.useState([]);c.useEffect(()=>{j(1)},[T]);const ae=()=>{B(null),i({name_ar:"",name_fr:"",price:"",category_id:"",description_ar:"",has_weight_options:!1,is_featured:!1,is_best_seller:!1,is_new:!1,is_promo:!1,image:"",original_price:""}),g([]),v(null),u(!0)},te=s=>{const a=b.find(r=>r.id===s);a&&(B(s),i({name_ar:a.name_ar,name_fr:a.name_fr,price:a.price.toString(),category_id:a.category_id||"",description_ar:a.description_ar||"",has_weight_options:a.has_weight_options||!1,is_featured:a.is_featured||!1,is_best_seller:a.is_best_seller||!1,is_new:a.is_new||!1,is_promo:a.is_promo||!1,image:a.image||"",original_price:a.original_price?.toString()||""}),g(a.weights?.map(r=>({id:r.id,weight:r.weight,price:r.price}))||[]),v(a.image||null),u(!0))},re=async s=>{const a=s.target.files?.[0];if(a){if(!a.type.startsWith("image/")){l({title:"Invalid file",description:"Please select an image file",variant:"destructive"});return}if(a.size>5*1024*1024){l({title:"File too large",description:"Image must be less than 5MB",variant:"destructive"});return}Z(!0);try{const r=a.name.split(".").pop(),n=`products/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${r}`}`,{error:p}=await $.storage.from("products").upload(n,a);if(p)throw p;const{data:{publicUrl:R}}=$.storage.from("products").getPublicUrl(n);i(de=>({...de,image:R})),v(R),l({title:"Uploaded",description:"Image uploaded successfully"})}catch(r){console.error("Upload error:",r),l({title:"Upload failed",description:r.message||"Failed to upload image",variant:"destructive"})}finally{Z(!1)}}},ie=()=>{i(s=>({...s,image:""})),v(null),N.current&&(N.current.value="")},le=()=>g(s=>[...s,{weight:"",price:0}]),Q=(s,a,r)=>{g(m=>m.map((n,p)=>p===s?{...n,[a]:a==="price"?parseFloat(r)||0:r}:n))},ce=s=>g(a=>a.filter((r,m)=>m!==s)),ne=async()=>{if(!t.name_ar||!t.name_fr||!t.price){l({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}const s=parseFloat(t.price);if(isNaN(s)){l({title:"Error",description:"Please enter a valid price",variant:"destructive"});return}const a=t.original_price?parseFloat(t.original_price):null;if(t.original_price&&(a===null||isNaN(a))){l({title:"Error",description:"Please enter a valid original price",variant:"destructive"});return}try{const r={name_ar:t.name_ar,name_fr:t.name_fr,price:s,category_id:t.category_id||null,description_ar:t.description_ar||null,has_weight_options:t.has_weight_options,is_featured:t.is_featured,is_best_seller:t.is_best_seller,is_new:t.is_new,is_promo:t.is_promo,image:t.image||null,original_price:a},m=t.has_weight_options?k.filter(n=>n.weight).map((n,p)=>({weight:n.weight,price:n.price,sort_order:p})):[];_?(await P.mutateAsync({id:_,product:r,weights:m}),l({title:"Updated",description:"Product updated successfully"})):(await y.mutateAsync({product:r,weights:m}),l({title:"Added",description:"Product added successfully"})),u(!1)}catch{l({title:"Error",description:"Failed to save product",variant:"destructive"})}},oe=async()=>{if(C)try{await z.mutateAsync(C),l({title:"Deleted",description:"Product deleted successfully"}),D(null)}catch{l({title:"Error",description:"Failed to delete product",variant:"destructive"})}},w=Math.ceil(L/M);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsxs("p",{className:"text-muted-foreground",children:["Manage store products (",L," total)"]})]}),e.jsxs(o,{onClick:ae,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Add Product"]})]}),e.jsx(F,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search products...",value:W,onChange:s=>X(s.target.value),className:"pl-10"})]})})}),Y?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:M}).map((s,a)=>e.jsx(pe,{className:"h-96 w-full"},a))}):b.length===0?e.jsx(F,{children:e.jsxs(I,{className:"py-12 text-center",children:[e.jsx(Ve,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No products found"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:b.map(s=>e.jsxs(F,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square relative bg-muted",children:[e.jsx("img",{src:s.image||"/placeholder.svg",alt:s.name_ar,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[s.is_featured&&e.jsxs(E,{className:"bg-purple-100 text-purple-800",children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"Featured"]}),s.is_best_seller&&e.jsxs(E,{className:"bg-blue-100 text-blue-800",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Best Seller"]})]})]}),e.jsxs(I,{className:"p-4",children:[e.jsx("h3",{className:"font-bold mb-1",dir:"rtl",children:s.name_ar}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.name_fr}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.price.toLocaleString()," DZD"]}),s.has_weight_options&&s.weights&&e.jsxs(E,{variant:"outline",className:"text-xs",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),s.weights.length," weights"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>te(s.id),children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsx(o,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>D(s.id),children:e.jsx(qe,{className:"w-4 h-4"})})]})]})]},s.id))}),w>1&&e.jsx(Ue,{children:e.jsxs(Me,{children:[e.jsx(U,{children:e.jsx(We,{href:"#",onClick:s=>{s.preventDefault(),j(a=>Math.max(1,a-1))},className:f===1?"pointer-events-none text-muted-foreground":""})}),[...Array(w)].map((s,a)=>e.jsx(U,{children:e.jsx(Te,{href:"#",onClick:r=>{r.preventDefault(),j(a+1)},isActive:f===a+1,children:a+1})},a)),e.jsx(U,{children:e.jsx(Le,{href:"#",onClick:s=>{s.preventDefault(),j(a=>Math.min(w,a+1))},className:f===w?"pointer-events-none text-muted-foreground":""})})]})})]}),e.jsx(Ne,{open:se,onOpenChange:u,children:e.jsxs(we,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(be,{children:e.jsx(ye,{children:_?"Edit Product":"Add New Product"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name (Arabic) *"}),e.jsx(h,{value:t.name_ar,onChange:s=>i(a=>({...a,name_ar:s.target.value})),placeholder:"اسم المنتج",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name (French) *"}),e.jsx(h,{value:t.name_fr,onChange:s=>i(a=>({...a,name_fr:s.target.value})),placeholder:"Nom du produit"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Base Price (DZD) *"}),e.jsx(h,{type:"number",value:t.price,onChange:s=>i(a=>({...a,price:s.target.value})),placeholder:"Enter price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Original Price (DZD)"}),e.jsx(h,{type:"number",value:t.original_price,onChange:s=>i(a=>({...a,original_price:s.target.value})),placeholder:"For promotions"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Category"}),e.jsxs(xe,{value:t.category_id,onValueChange:s=>i(a=>({...a,category_id:s})),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Select category"})}),e.jsx(_e,{children:ee.map(s=>e.jsx(ve,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.name_ar}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s.name_fr})]})},s.id))})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{children:"Product Image"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-32 h-32 border-2 border-dashed border-border rounded-lg flex items-center justify-center bg-muted/50 overflow-hidden",children:S?e.jsx("img",{src:S,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(Ge,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:re,className:"hidden"}),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>N.current?.click(),disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Upload Image"]})}),S&&e.jsxs(o,{type:"button",variant:"ghost",size:"sm",onClick:ie,className:"text-destructive hover:text-destructive",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Remove"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max 5MB, JPG/PNG/WebP"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Description (Arabic)"}),e.jsx(ue,{value:t.description_ar,onChange:s=>i(a=>({...a,description_ar:s.target.value})),placeholder:"وصف المنتج",rows:2,dir:"rtl"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{children:"Product Labels"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{id:"featured",checked:t.is_featured,onCheckedChange:s=>i(a=>({...a,is_featured:!!s}))}),e.jsxs("label",{htmlFor:"featured",className:"text-sm cursor-pointer flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4 text-purple-500"}),"Produit en Vedette"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{id:"bestseller",checked:t.is_best_seller,onCheckedChange:s=>i(a=>({...a,is_best_seller:!!s}))}),e.jsxs("label",{htmlFor:"bestseller",className:"text-sm cursor-pointer flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4 text-blue-500"}),"Meilleures Ventes"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{id:"new",checked:t.is_new,onCheckedChange:s=>i(a=>({...a,is_new:!!s}))}),e.jsx("label",{htmlFor:"new",className:"text-sm cursor-pointer",children:"New Product"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{id:"promo",checked:t.is_promo,onCheckedChange:s=>i(a=>({...a,is_promo:!!s}))}),e.jsx("label",{htmlFor:"promo",className:"text-sm cursor-pointer",children:"Promotion"})]})]})]}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{id:"hasWeights",checked:t.has_weight_options,onCheckedChange:s=>i(a=>({...a,has_weight_options:!!s}))}),e.jsxs("label",{htmlFor:"hasWeights",className:"text-sm font-medium cursor-pointer flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Enable Weight Options"]})]}),t.has_weight_options&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:le,children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Add Weight"]})]}),t.has_weight_options&&e.jsxs("div",{className:"space-y-2",children:[k.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:'No weights added. Click "Add Weight" to create weight options.'}),k.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{placeholder:"e.g., 50g, 100g",value:s.weight,onChange:r=>Q(a,"weight",r.target.value),className:"flex-1"}),e.jsx(h,{type:"number",placeholder:"Price",value:s.price||"",onChange:r=>Q(a,"price",r.target.value),className:"w-28"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"DZD"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>ce(a),children:e.jsx(V,{className:"w-4 h-4 text-destructive"})})]},a))]})]})]}),e.jsxs(Pe,{children:[e.jsx(o,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(o,{onClick:ne,disabled:y.isPending||P.isPending,children:[(y.isPending||P.isPending)&&e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),_?"Update":"Add"," Product"]})]})]})}),e.jsx(Ce,{open:!!C,onOpenChange:()=>D(null),children:e.jsxs(De,{children:[e.jsxs(Se,{children:[e.jsx(ke,{children:"Delete Product"}),e.jsx(Ae,{children:"Are you sure you want to delete this product? This action cannot be undone."})]}),e.jsxs(Fe,{children:[e.jsx(Ie,{children:"Cancel"}),e.jsx(Ee,{onClick:oe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:z.isPending?e.jsx(A,{className:"w-4 h-4 animate-spin"}):"Delete"})]})]})})]})};export{ys as default};
