import{c as y,R as _,n as l,s as c}from"./index-DJa8JmTm.js";import{u as d,a as p}from"./useMutation-wRGvQ37d.js";const w=y("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);function h(e){return d({queryKey:["tariffs",e?.store,e?.isActive],queryFn:async()=>{let a=c.from("tariffs").select("*").order("wilaya_code",{ascending:!0});e?.store&&(a=a.eq("store",e.store)),e?.isActive!==void 0&&(a=a.eq("is_active",e.isActive));const{data:r,error:s}=await a;if(s)throw s;return r}})}function q(){const e=l();return p({mutationFn:async a=>{for(const r of a){const s={};r.home_price!==void 0&&(s.home_price=r.home_price),r.bureau_price!==void 0&&(s.bureau_price=r.bureau_price),r.retour!==void 0&&(s.retour=r.retour),r.is_active!==void 0&&(s.is_active=r.is_active);const{error:i}=await c.from("tariffs").update(s).eq("id",r.id);if(i)throw i}return a.length},onSuccess:()=>{e.invalidateQueries({queryKey:["tariffs"]})}})}function b(){const e=l();return p({mutationFn:async a=>{const{data:r,error:s}=await c.from("tariffs").select("id, wilaya_code, store");if(s)throw s;const i={successfulInserts:0,successfulUpdates:0,failedImports:[]};for(const t of a){const n=r.find(o=>o.wilaya_code===t.wilaya_code&&o.store===t.store),f={wilaya_code:t.wilaya_code,wilaya_name:t.wilaya_name,home_price:t.home_price,bureau_price:t.bureau_price,retour:t.retour,store:t.store};let u=null;if(n){const{error:o}=await c.from("tariffs").update(f).eq("id",n.id);u=o,o||i.successfulUpdates++}else{const{error:o}=await c.from("tariffs").insert(f);u=o,o||i.successfulInserts++}u&&i.failedImports.push({tariff:t,error:u.message})}return i},onSuccess:()=>{e.invalidateQueries({queryKey:["tariffs"]})}})}function A(e){return d({queryKey:["tariffs",e],queryFn:async()=>{if(!e)return null;const{data:a,error:r}=await c.from("tariffs").select("store, home_price, bureau_price").eq("wilaya_code",e).eq("is_active",!0);if(r)throw r;return a},enabled:!!e})}function g(e,a){return d({queryKey:["cheapest-delivery",e,a],queryFn:async()=>{if(!e||a==="pickup")return{store:"laghouat",price:0};const{data:r,error:s}=await c.rpc("get_cheapest_store",{_wilaya_code:e,_delivery_type:a});if(s)throw s;return r?.[0]},enabled:!!e&&a!=="pickup"})}function k(){const{data:e=[],isLoading:a,error:r}=h({isActive:!0});return{data:_.useMemo(()=>{const i=new Map;return e.forEach(t=>{!i.has(t.wilaya_code)&&t.wilaya_name&&i.set(t.wilaya_code,`${t.wilaya_code.toString().padStart(2,"0")} - ${t.wilaya_name}`)}),Array.from(i.values()).sort((t,n)=>{const f=parseInt(t.split(" - ")[0],10),u=parseInt(n.split(" - ")[0],10);return f-u})},[e]),isLoading:a,error:r}}export{w as S,A as a,h as b,q as c,b as d,g as e,k as u};
