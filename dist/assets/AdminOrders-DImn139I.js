import{j as e}from"./ui-vendor-CbTtZHsW.js";import{a as s}from"./react-vendor-1XlI0agO.js";import{S as a}from"./skeleton-6yxWGX1N.js";import{a as t,C as r}from"./card-Cczuk04M.js";import{B as l}from"./button-BaBzPPdN.js";import{I as i}from"./input-Cyy5VwgS.js";import{L as n}from"./label-Dtbf7Pbr.js";import{u as d,C as c,S as o}from"./use-debounce-D4NJ8zY8.js";import{S as m,a as h,b as x,c as u,d as j}from"./select-BhMqPoNH.js";import{D as p,a as f,b as g,c as v}from"./dialog-BnEvN8u9.js";import{A as N,a as y,b,c as w,d as _,e as C,f as S,g as D}from"./alert-dialog-AZPmfsKc.js";import{P as k,a as A,b as O,c as T,d as M,e as P}from"./pagination-DIcs9vkY.js";import{D as L,p as $}from"./date-range-picker-CVlBK6Rd.js";import{b as E,L as Q,X as I}from"./index-D1_jVxz0.js";import{f as Z,g as F,h as V,j as z,k as B}from"./useOrders-C_10zbcf.js";import{u as U,F as q,a as R,O as H,E as W,C as G}from"./CreateOrderDialog-CgBYffF0.js";import{T as J}from"./trash-2-BNPyHnqR.js";import{S as K}from"./search-B6TsrJyZ.js";import{P as Y}from"./plus-HqHeUJWv.js";import{P as X}from"./package-BY-qjQqh.js";import{T as ee}from"./truck-DV3Q0ieL.js";import{B as se}from"./building-2-CPys3uA1.js";import{S as ae}from"./useTariffs-CO6o1QVA.js";import{S as te}from"./square-pen-DKAJy3Tl.js";import{P as re}from"./phone-xXJ7ctl3.js";import{M as le}from"./map-pin-BnIo_9oq.js";import{f as ie}from"./format-v08Horlk.js";import"./index-CBOS6VWY.js";import"./chevron-down-W51QyQCR.js";import"./chevron-left-B9kvwOhv.js";import"./chevron-right-DNnr06E4.js";import"./query-vendor-DL9dZapS.js";import"./badge-sMWyZfAg.js";import"./save-Bu5et1U3.js";import"./useProducts-C-FzGN4K.js";const ne={new:"New",confirmed:"Confirmed",delivered:"Delivered",canceled:"Canceled",returned:"Returned"},de={new:"bg-amber-100 text-amber-800",confirmed:"bg-blue-100 text-blue-800",delivered:"bg-green-100 text-green-800",canceled:"bg-red-100 text-red-800",returned:"bg-purple-100 text-purple-800"},ce={home:"Home Delivery",bureau:"Bureau",pickup:"Pickup"},oe=()=>{const[oe,me]=s.useState(1),[he,xe]=s.useState({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),[ue,je]=s.useState(void 0),pe=d(he.searchQuery,500),{data:fe,isLoading:ge}=Z({page:oe,pageSize:20,searchQuery:pe,status:he.status,deliveryType:he.deliveryType,store:he.store,fromDate:ue?.from?ie(ue.from,"yyyy-MM-dd"):void 0,toDate:ue?.to?ie(ue.to,"yyyy-MM-dd"):void 0}),{data:ve=[],count:Ne=0}=fe||{},ye=U(),be=F(),we=V(),_e=z(),{toast:Ce}=E(),[Se,De]=s.useState(null),[ke,Ae]=s.useState(null),[Oe,Te]=s.useState(!1),[Me,Pe]=s.useState(!1),[Le,$e]=s.useState(!1),[Ee,Qe]=s.useState([]),[Ie,Ze]=s.useState(!1),[Fe,Ve]=s.useState(""),[ze,Be]=s.useState(!1),{refetch:Ue}=B({searchQuery:pe,status:he.status,deliveryType:he.deliveryType,store:he.store,fromDate:ue?.from?ie(ue.from,"yyyy-MM-dd"):void 0,toDate:ue?.to?ie(ue.to,"yyyy-MM-dd"):void 0}),qe=(e,s)=>{xe(a=>({...a,[e]:s}))},Re=s.useMemo(()=>{const e={...he};return delete e.searchQuery,Object.values(e).some(e=>"all"!==e&&""!==e)||ue?.from||ue?.to},[he,ue]);s.useEffect(()=>{me(1)},[pe,he.status,he.deliveryType,he.store,ue]),s.useEffect(()=>{!Le&&Re&&Ge()},[Le,Re]);const He=e=>{Qe(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},We=(e,s)=>{be.mutateAsync({id:e,status:s}),Ce({title:"Updated",description:`Order status changed to ${ne[s]}.`})},Ge=()=>{xe({searchQuery:"",status:"all",deliveryType:"all",store:"all"}),je(void 0)},Je=Math.ceil(Ne/20);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("p",{className:"text-muted-foreground",children:["Manage and track all ",Ne," orders"]})]}),Ee.length>0&&e.jsx(t,{className:"border-primary",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"font-medium",children:[Ee.length," orders selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{value:Fe,onValueChange:Ve,children:[e.jsx(h,{className:"w-full sm:w-[180px]",children:e.jsx(x,{placeholder:"Change status..."})}),e.jsx(u,{children:Object.keys(ne).map(s=>e.jsx(j,{value:s,children:ne[s]},s))})]}),Fe&&e.jsx(l,{onClick:()=>(async e=>{await we.mutateAsync({ids:Ee,status:e}),Ce({title:"Updated",description:`${Ee.length} orders updated.`}),Qe([]),Ve("")})(Fe),disabled:we.isPending,children:we.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Apply"}),e.jsxs(l,{variant:"destructive",onClick:()=>Ze(!0),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Delete"]}),e.jsx(l,{variant:"ghost",onClick:()=>Qe([]),children:e.jsx(I,{className:"w-4 h-4"})})]})]})})}),e.jsx(t,{children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search by order ID, customer name, or phone...",value:he.searchQuery,onChange:e=>qe("searchQuery",e.target.value),className:"pl-10"})]}),e.jsxs(l,{variant:Le?"secondary":"outline",onClick:()=>$e(!Le),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Filters",Re&&e.jsx("span",{className:"ml-2 w-2 h-2 bg-primary rounded-full"})]}),e.jsxs(l,{variant:"default",className:"bg-green-500 text-white hover:bg-green-600",onClick:async()=>{Be(!0);try{const{data:e}=await Ue();if(!e||0===e.length)return void Ce({title:"Export Failed",description:"No orders to export.",variant:"destructive"});let s=0;e.forEach(e=>{e.items&&e.items.length>s&&(s=e.items.length)});const a=["Order Number","Customer Name","Customer Phone","Wilaya","Address","Delivery Type","Store","Subtotal","Notes",...Array.from({length:s},(e,s)=>`Item ${s+1}`)],t=e.map(e=>{const a=[e.order_number,`"${e.customer_name}"`,e.customer_phone,e.wilaya_name,`"${e.address||""}"`,ce[e.delivery_type],e.send_from_store,e.subtotal,`"${e.notes||""}"`],t=(e.items||[]).map(e=>`"${e.product_name_fr||e.product_name_ar} (Qty: ${e.quantity}, Price: ${e.unit_price}, Weight: ${e.weight||"N/A"})"`);for(;t.length<s;)t.push("");return[...a,...t].join(",")}),r="\ufeff"+[a.join(","),...t].join("\n"),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),n=URL.createObjectURL(l);i.setAttribute("href",n),i.setAttribute("download",`orders_export_${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i),Ce({title:"Export Successful",description:`${e.length} orders have been exported.`})}catch(e){Ce({title:"Export Failed",description:"An error occurred while exporting orders.",variant:"destructive"})}finally{Be(!1)}},disabled:ze,children:[ze?e.jsx(Q,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(R,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(l,{variant:"default",onClick:()=>Pe(!0),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Create Order"]})]}),Le&&e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium mb-1.5 block",children:"Status"}),e.jsxs(m,{value:he.status,onValueChange:e=>qe("status",e),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(u,{children:[e.jsx(j,{value:"all",children:"All"}),Object.keys(ne).map(s=>e.jsx(j,{value:s,children:ne[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium mb-1.5 block",children:"Delivery"}),e.jsxs(m,{value:he.deliveryType,onValueChange:e=>qe("deliveryType",e),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(u,{children:[e.jsx(j,{value:"all",children:"All"}),Object.keys(ce).map(s=>e.jsx(j,{value:s,children:ce[s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium mb-1.5 block",children:"Store"}),e.jsxs(m,{value:he.store,onValueChange:e=>qe("store",e),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(u,{children:[e.jsx(j,{value:"all",children:"All"}),e.jsx(j,{value:"laghouat",children:"Laghouat"}),e.jsx(j,{value:"aflou",children:"Aflou"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[" ",e.jsx(n,{className:"text-sm font-medium mb-1.5 block",children:"Date Range"}),e.jsx(L,{date:ue,onSelect:e=>{je(e)}})]})]}),Re&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(l,{variant:"ghost",size:"sm",onClick:Ge,children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Clear Filters"]})})]})]})}),ye?e.jsxs("div",{className:"space-y-4",children:[ge?Array.from({length:10}).map((s,l)=>e.jsx(t,{children:e.jsx(r,{className:"p-4",children:e.jsx(a,{className:"h-32 w-full"})})},l)):ve.map(s=>e.jsx(H,{order:s,isSelected:Ee.includes(s.id),onSelect:He,onViewDetails:De,onStatusChange:We,statusLabels:ne,statusColors:de,deliveryLabels:ce},s.id)),0===ve.length&&!ge&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(X,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]}):e.jsx(t,{children:e.jsxs(r,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50 text-left",children:[e.jsx("th",{className:"p-3",children:e.jsx(c,{checked:Ee.length===ve.length&&ve.length>0,onCheckedChange:()=>{Ee.length===ve.length?Qe([]):Qe(ve.map(e=>e.id))}})}),e.jsx("th",{className:"p-3 font-medium",children:"Order #"}),e.jsx("th",{className:"p-3 font-medium",children:"Customer"}),e.jsx("th",{className:"p-3 font-medium",children:"Delivery"}),e.jsx("th",{className:"p-3 font-medium",children:"Store"}),e.jsx("th",{className:"p-3 font-medium",children:"Total"}),e.jsx("th",{className:"p-3 font-medium",children:"Status"}),e.jsx("th",{className:"p-3 font-medium",children:"Date"}),e.jsx("th",{className:"p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:ge?Array.from({length:10}).map((s,t)=>e.jsx("tr",{className:"border-b",children:e.jsx("td",{colSpan:10,className:"p-4",children:e.jsx(a,{className:"h-6 w-full"})})},t)):ve.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/30 cursor-pointer "+(s.is_manual?"bg-red-800/30":""),onClick:()=>De(s),children:[e.jsx("td",{className:"p-3",onClick:e=>e.stopPropagation(),children:e.jsx(c,{checked:Ee.includes(s.id),onCheckedChange:()=>He(s.id)})}),e.jsx("td",{className:"p-3 font-mono text-xs",children:s.order_number}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.customer_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.customer_phone})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:["home"===s.delivery_type&&e.jsx(ee,{className:"w-4 h-4"}),"bureau"===s.delivery_type&&e.jsx(se,{className:"w-4 h-4"}),"pickup"===s.delivery_type&&e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:ce[s.delivery_type]})]})}),e.jsx("td",{className:"p-3 capitalize",children:s.send_from_store}),e.jsxs("td",{className:"p-3 font-semibold",children:[s.total.toLocaleString()," DZD"]}),e.jsx("td",{className:"p-3",children:e.jsxs(m,{value:s.status,onValueChange:e=>We(s.id,e),onClick:e=>e.stopPropagation(),children:[e.jsx(h,{className:`w-[120px] h-8 text-xs border-0 ${de[s.status]}`,children:e.jsx(x,{})}),e.jsx(u,{children:Object.keys(ne).map(s=>e.jsx(j,{value:s,children:ne[s]},s))})]})}),e.jsx("td",{className:"p-3 text-xs",children:ie($(s.created_at),"dd/MM/yyyy HH:mm")}),e.jsx("td",{className:"p-3",onClick:e=>e.stopPropagation(),children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{Ae(s),Te(!0)},children:e.jsx(te,{className:"w-4 h-4"})})})]},s.id))})]})}),0===ve.length&&!ge&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(X,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})]})]})}),Je>1&&e.jsx(k,{children:e.jsxs(A,{className:"flex-wrap",children:[e.jsx(O,{children:e.jsx(T,{href:"#",onClick:e=>{e.preventDefault(),me(e=>Math.max(1,e-1))},className:1===oe?"pointer-events-none opacity-50":""})}),e.jsx("div",{className:"hidden sm:flex",children:[...Array(Je)].map((s,a)=>e.jsx(O,{children:e.jsx(M,{href:"#",onClick:e=>{e.preventDefault(),me(a+1)},isActive:oe===a+1,children:a+1})},a))}),e.jsx(O,{children:e.jsx(P,{href:"#",onClick:e=>{e.preventDefault(),me(e=>Math.min(Je,e+1))},className:oe===Je?"pointer-events-none opacity-50":""})})]})}),e.jsx(p,{open:!!Se,onOpenChange:()=>De(null),children:e.jsx(f,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:Se&&e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(v,{children:["Order Details - ",Se.order_number]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Customer Information"]}),e.jsx("p",{children:Se.customer_name}),e.jsx("p",{className:"text-muted-foreground",children:Se.customer_phone}),Se.customer_email&&e.jsx("p",{className:"text-muted-foreground",children:Se.customer_email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Delivery Information"]}),e.jsx("p",{children:Se.wilaya_name}),Se.address&&e.jsx("p",{className:"text-muted-foreground",children:Se.address}),e.jsxs("p",{className:"text-sm",children:["Type: ",ce[Se.delivery_type]]}),e.jsxs("p",{className:"text-sm",children:["Store: ",Se.send_from_store.charAt(0).toUpperCase()+Se.send_from_store.slice(1)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:Se.items.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg",children:["                      ",e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product_name_ar||s.product_name_fr||"No Product Name Available"}),s.weight&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(o,{className:"w-3 h-3"})," ",s.weight]}),s.product_name_ar&&s.product_name_fr&&s.product_name_ar!==s.product_name_fr&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.product_name_fr})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[s.total_price.toLocaleString()," DZD"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity," Ã— ",s.unit_price.toLocaleString()," DZD"]})]})]},a))})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:[Se.subtotal.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery"}),e.jsxs("span",{children:[Se.delivery_price.toLocaleString()," DZD"]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:[Se.total.toLocaleString()," DZD"]})]})]}),Se.notes&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm",children:Se.notes})]})]})]})})}),e.jsx(N,{open:Ie,onOpenChange:Ze,children:e.jsxs(y,{children:[e.jsxs(b,{children:[e.jsx(w,{children:"Delete Orders"}),e.jsxs(_,{children:["Are you sure you want to delete ",Ee.length," order(s)? This action cannot be undone."]})]}),e.jsxs(C,{children:[e.jsx(S,{children:"Cancel"}),e.jsx(D,{onClick:async()=>{await _e.mutateAsync(Ee),Ce({title:"Deleted",description:`${Ee.length} orders deleted.`}),Qe([]),Ze(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:_e.isPending?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):"Delete"})]})]})}),e.jsx(W,{order:ke,isOpen:Oe,onClose:()=>{Te(!1),Ae(null)}}),Me&&e.jsx(G,{isOpen:Me,onClose:()=>Pe(!1)})]})};export{oe as default};
