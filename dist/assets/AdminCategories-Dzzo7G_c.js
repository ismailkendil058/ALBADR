import{j as e}from"./ui-vendor-CbTtZHsW.js";import{a as s}from"./react-vendor-1XlI0agO.js";import{a,C as t}from"./card-Cczuk04M.js";import{B as r}from"./button-BaBzPPdN.js";import{I as i}from"./input-Cyy5VwgS.js";import{L as l}from"./label-Dtbf7Pbr.js";import{D as c,a as o,b as n,c as d,d as m}from"./dialog-BnEvN8u9.js";import{A as u,a as g,b as h,c as p,d as x,e as j,f,g as v}from"./alert-dialog-AZPmfsKc.js";import{b as y,L as N,X as b,s as C}from"./index-D1_jVxz0.js";import{u as w}from"./useCategories-DFbTdWoi.js";import{P as k}from"./plus-HqHeUJWv.js";import{S as F}from"./square-pen-DKAJy3Tl.js";import{T as A}from"./trash-2-BNPyHnqR.js";import{P as S}from"./package-BY-qjQqh.js";import{F as _}from"./folder-tree-OjNM9kgD.js";import{I as P}from"./image-ugoZQobq.js";import{U}from"./upload-DM0s_sQW.js";import"./query-vendor-DL9dZapS.js";const z=()=>{const{categories:z,isLoading:D,error:I,addCategory:$,updateCategory:E,deleteCategory:L}=w(),[q,M]=s.useState(!1),[T,B]=s.useState(null),[O,R]=s.useState(null),[J,K]=s.useState(""),[W,G]=s.useState(""),[H,Q]=s.useState(null),[V,X]=s.useState(!1),Y=s.useRef(null),{toast:Z}=y(),ee=()=>{B(null),K(""),G(""),Q(null),M(!0),Y.current&&(Y.current.value="")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Categories"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage product categories"})]}),e.jsxs(r,{onClick:ee,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Add Category"]})]}),D&&e.jsx("p",{children:"Loading categories..."}),I&&e.jsxs("p",{className:"text-destructive",children:["Error: ",I.message]}),!D&&!I&&z&&z.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:z.map(s=>e.jsxs(a,{className:"overflow-hidden group",children:[e.jsxs("div",{className:"aspect-video relative bg-muted",children:[e.jsx("img",{loading:"lazy",src:s.image||"/placeholder.svg",alt:s.name_fr,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(r,{variant:"outline",size:"icon",className:"bg-background/80 hover:bg-background",onClick:()=>(e=>{B(e),K(e.name_fr),G(e.name_ar),Q(e.image),M(!0),Y.current&&(Y.current.value="")})(s),children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"icon",className:"bg-background/80 hover:bg-background text-destructive hover:text-destructive",onClick:()=>R(s),children:e.jsx(A,{className:"w-4 h-4"})})]})]}),e.jsxs(t,{className:"p-4",children:[e.jsx("h3",{className:"font-bold",children:s.name_fr}),e.jsx("h3",{className:"font-bold text-right",dir:"rtl",children:s.name_ar}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"}),s.products[0]?.count||0," products"]})]})]},s.id))}),!D&&!I&&(!z||0===z.length)&&e.jsx(a,{children:e.jsxs(t,{className:"py-12 text-center",children:[e.jsx(_,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No categories yet"}),e.jsxs(r,{onClick:ee,className:"mt-4",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Add First Category"]})]})}),e.jsx(c,{open:q,onOpenChange:M,children:e.jsxs(o,{className:"max-w-md",children:[e.jsx(n,{children:e.jsx(d,{children:T?"Edit Category":"Add New Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"categoryNameFr",children:"Category Name (French)"}),e.jsx(i,{id:"categoryNameFr",value:J,onChange:e=>K(e.target.value),placeholder:"e.g., Spices"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"categoryNameAr",children:"Category Name (Arabic)"}),e.jsx(i,{id:"categoryNameAr",value:W,onChange:e=>G(e.target.value),placeholder:"e.g., بهارات",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{children:"Category Image"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-32 h-32 border-2 border-dashed rounded-lg flex items-center justify-center bg-muted/50 overflow-hidden",children:H?e.jsx("img",{src:H,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(P,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[e.jsx("input",{ref:Y,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(s)if(s.type.startsWith("image/"))if(s.size>5242880)Z({title:"File too large",description:"Image must be less than 5MB.",variant:"destructive"});else{X(!0);try{const e=s.name.split(".").pop(),a=`categories/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${e}`}`,{error:t}=await C.storage.from("catig").upload(a,s,{upsert:!0});if(t)throw t;const{data:{publicUrl:r}}=C.storage.from("catig").getPublicUrl(a);Q(r),Z({title:"Uploaded",description:"Image uploaded successfully."})}catch(a){Z({title:"Upload failed",description:a.message,variant:"destructive"})}finally{X(!1)}}else Z({title:"Invalid file",description:"Please select an image.",variant:"destructive"})},className:"hidden"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>Y.current?.click(),disabled:V,children:[V?e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(U,{className:"w-4 h-4 mr-2"}),V?"Uploading...":"Upload"]}),H&&e.jsxs(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>{Q(null),Y.current&&(Y.current.value="")},className:"text-destructive hover:text-destructive",children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"Remove"]})]})]})]})]}),e.jsxs(m,{className:"gap-2 sm:gap-0",children:[e.jsx(r,{variant:"outline",onClick:()=>M(!1),children:"Cancel"}),e.jsx(r,{onClick:async()=>{if(J.trim()&&W.trim())try{const e={name_fr:J.trim(),name_ar:W.trim(),image:H};T?(await E({id:T.id,updatedFields:e}),Z({title:"Updated",description:"Category updated successfully"})):(await $({...e,is_special:!1}),Z({title:"Added",description:"Category added successfully"})),M(!1)}catch(e){Z({title:"Error",description:e.message||"Failed to save category",variant:"destructive"})}else Z({title:"Error",description:"Please enter both French and Arabic category names",variant:"destructive"})},disabled:V,children:T?"Save Changes":"Add Category"})]})]})}),e.jsx(u,{open:!!O,onOpenChange:()=>R(null),children:e.jsxs(g,{children:[e.jsxs(h,{children:[e.jsx(p,{children:"Delete Category"}),e.jsx(x,{children:(O?.products[0]?.count||0)>0?`Cannot delete this category because it contains ${O?.products[0].count} products. Please move or delete them first.`:`Are you sure you want to delete "${O?.name_fr}"? This action cannot be undone.`})]}),e.jsxs(j,{className:"gap-2 sm:gap-0",children:[e.jsx(f,{children:"Cancel"}),0===(O?.products[0]?.count||0)&&e.jsx(v,{onClick:async()=>{if(O){if((O.products[0]?.count||0)>0)return Z({title:"Cannot Delete",description:"This category contains products. Please move products first.",variant:"destructive"}),void R(null);try{await L(O.id),Z({title:"Deleted",description:"Category deleted successfully"})}catch(e){Z({title:"Error",description:e.message||"Failed to delete category",variant:"destructive"})}R(null)}},className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{z as default};
